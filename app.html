<!doctype html>
<html class="bonito-fragment">
  <head>
    <script src="data:application/javascript;base64,Ly8gZGVuby1mbXQtaWdub3JlLWZpbGUKLy8gZGVuby1saW50LWlnbm9yZS1maWxlCi8vIFRoaXMgY29kZSB3YXMgYnVuZGxlZCB1c2luZyBgZGVubyBidW5kbGVgIGFuZCBpdCdzIG5vdCByZWNvbW1lbmRlZCB0byBlZGl0IGl0IG1hbnVhbGx5Cgp2YXIgRSA9IE9iamVjdC5jcmVhdGU7CnZhciBkID0gT2JqZWN0LmRlZmluZVByb3BlcnR5Owp2YXIgTCA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I7CnZhciBPID0gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXM7CnZhciBDID0gT2JqZWN0LmdldFByb3RvdHlwZU9mLCBBID0gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eTsKdmFyIGsgPSAobiwgZSk9PigpPT4oZSB8fCBuKChlID0gewogICAgICAgICAgICBleHBvcnRzOiB7fQogICAgICAgIH0pLmV4cG9ydHMsIGUpLCBlLmV4cG9ydHMpOwp2YXIgUCA9IChuLCBlLCB0LCBzKT0+ewogICAgaWYgKGUgJiYgdHlwZW9mIGUgPT0gIm9iamVjdCIgfHwgdHlwZW9mIGUgPT0gImZ1bmN0aW9uIikgZm9yIChsZXQgaSBvZiBPKGUpKSFBLmNhbGwobiwgaSkgJiYgaSAhPT0gdCAmJiBkKG4sIGksIHsKICAgICAgICBnZXQ6ICgpPT5lW2ldLAogICAgICAgIGVudW1lcmFibGU6ICEocyA9IEwoZSwgaSkpIHx8IHMuZW51bWVyYWJsZQogICAgfSk7CiAgICByZXR1cm4gbjsKfTsKdmFyIE4gPSAobiwgZSwgdCk9Pih0ID0gbiAhPSBudWxsID8gRShDKG4pKSA6IHt9LCBQKGUgfHwgIW4gfHwgIW4uX19lc01vZHVsZSA/IGQodCwgImRlZmF1bHQiLCB7CiAgICAgICAgdmFsdWU6IG4sCiAgICAgICAgZW51bWVyYWJsZTogITAKICAgIH0pIDogdCwgbikpOwp2YXIgbSA9IGsoKHEsIHgpPT57CiAgICAidXNlIHN0cmljdCI7CiAgICB2YXIgUyA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHksIGwgPSAifiI7CiAgICBmdW5jdGlvbiBfKCkge30KICAgIE9iamVjdC5jcmVhdGUgJiYgKF8ucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShudWxsKSwgbmV3IF8oKS5fX3Byb3RvX18gfHwgKGwgPSAhMSkpOwogICAgZnVuY3Rpb24gVChuLCBlLCB0KSB7CiAgICAgICAgdGhpcy5mbiA9IG4sIHRoaXMuY29udGV4dCA9IGUsIHRoaXMub25jZSA9IHQgfHwgITE7CiAgICB9CiAgICBmdW5jdGlvbiB3KG4sIGUsIHQsIHMsIGkpIHsKICAgICAgICBpZiAodHlwZW9mIHQgIT0gImZ1bmN0aW9uIikgdGhyb3cgbmV3IFR5cGVFcnJvcigiVGhlIGxpc3RlbmVyIG11c3QgYmUgYSBmdW5jdGlvbiIpOwogICAgICAgIHZhciB1ID0gbmV3IFQodCwgcyB8fCBuLCBpKSwgbyA9IGwgPyBsICsgZSA6IGU7CiAgICAgICAgcmV0dXJuIG4uX2V2ZW50c1tvXSA/IG4uX2V2ZW50c1tvXS5mbiA/IG4uX2V2ZW50c1tvXSA9IFsKICAgICAgICAgICAgbi5fZXZlbnRzW29dLAogICAgICAgICAgICB1CiAgICAgICAgXSA6IG4uX2V2ZW50c1tvXS5wdXNoKHUpIDogKG4uX2V2ZW50c1tvXSA9IHUsIG4uX2V2ZW50c0NvdW50KyspLCBuOwogICAgfQogICAgZnVuY3Rpb24geShuLCBlKSB7CiAgICAgICAgLS1uLl9ldmVudHNDb3VudCA9PT0gMCA/IG4uX2V2ZW50cyA9IG5ldyBfIDogZGVsZXRlIG4uX2V2ZW50c1tlXTsKICAgIH0KICAgIGZ1bmN0aW9uIGMoKSB7CiAgICAgICAgdGhpcy5fZXZlbnRzID0gbmV3IF8sIHRoaXMuX2V2ZW50c0NvdW50ID0gMDsKICAgIH0KICAgIGMucHJvdG90eXBlLmV2ZW50TmFtZXMgPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgZSA9IFtdLCB0LCBzOwogICAgICAgIGlmICh0aGlzLl9ldmVudHNDb3VudCA9PT0gMCkgcmV0dXJuIGU7CiAgICAgICAgZm9yKHMgaW4gdCA9IHRoaXMuX2V2ZW50cylTLmNhbGwodCwgcykgJiYgZS5wdXNoKGwgPyBzLnNsaWNlKDEpIDogcyk7CiAgICAgICAgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMgPyBlLmNvbmNhdChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKHQpKSA6IGU7CiAgICB9OwogICAgYy5wcm90b3R5cGUubGlzdGVuZXJzID0gZnVuY3Rpb24oZSkgewogICAgICAgIHZhciB0ID0gbCA/IGwgKyBlIDogZSwgcyA9IHRoaXMuX2V2ZW50c1t0XTsKICAgICAgICBpZiAoIXMpIHJldHVybiBbXTsKICAgICAgICBpZiAocy5mbikgcmV0dXJuIFsKICAgICAgICAgICAgcy5mbgogICAgICAgIF07CiAgICAgICAgZm9yKHZhciBpID0gMCwgdSA9IHMubGVuZ3RoLCBvID0gbmV3IEFycmF5KHUpOyBpIDwgdTsgaSsrKW9baV0gPSBzW2ldLmZuOwogICAgICAgIHJldHVybiBvOwogICAgfTsKICAgIGMucHJvdG90eXBlLmxpc3RlbmVyQ291bnQgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgdmFyIHQgPSBsID8gbCArIGUgOiBlLCBzID0gdGhpcy5fZXZlbnRzW3RdOwogICAgICAgIHJldHVybiBzID8gcy5mbiA/IDEgOiBzLmxlbmd0aCA6IDA7CiAgICB9OwogICAgYy5wcm90b3R5cGUuZW1pdCA9IGZ1bmN0aW9uKGUsIHQsIHMsIGksIHUsIG8pIHsKICAgICAgICB2YXIgYSA9IGwgPyBsICsgZSA6IGU7CiAgICAgICAgaWYgKCF0aGlzLl9ldmVudHNbYV0pIHJldHVybiAhMTsKICAgICAgICB2YXIgciA9IHRoaXMuX2V2ZW50c1thXSwgcCA9IGFyZ3VtZW50cy5sZW5ndGgsIGgsIGY7CiAgICAgICAgaWYgKHIuZm4pIHsKICAgICAgICAgICAgc3dpdGNoKHIub25jZSAmJiB0aGlzLnJlbW92ZUxpc3RlbmVyKGUsIHIuZm4sIHZvaWQgMCwgITApLCBwKXsKICAgICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gci5mbi5jYWxsKHIuY29udGV4dCksICEwOwogICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgICAgIHJldHVybiByLmZuLmNhbGwoci5jb250ZXh0LCB0KSwgITA7CiAgICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHIuZm4uY2FsbChyLmNvbnRleHQsIHQsIHMpLCAhMDsKICAgICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gci5mbi5jYWxsKHIuY29udGV4dCwgdCwgcywgaSksICEwOwogICAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgICAgICAgIHJldHVybiByLmZuLmNhbGwoci5jb250ZXh0LCB0LCBzLCBpLCB1KSwgITA7CiAgICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHIuZm4uY2FsbChyLmNvbnRleHQsIHQsIHMsIGksIHUsIG8pLCAhMDsKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IoZiA9IDEsIGggPSBuZXcgQXJyYXkocCAtIDEpOyBmIDwgcDsgZisrKWhbZiAtIDFdID0gYXJndW1lbnRzW2ZdOwogICAgICAgICAgICByLmZuLmFwcGx5KHIuY29udGV4dCwgaCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmFyIGIgPSByLmxlbmd0aCwgdjsKICAgICAgICAgICAgZm9yKGYgPSAwOyBmIDwgYjsgZisrKXN3aXRjaChyW2ZdLm9uY2UgJiYgdGhpcy5yZW1vdmVMaXN0ZW5lcihlLCByW2ZdLmZuLCB2b2lkIDAsICEwKSwgcCl7CiAgICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICAgICAgcltmXS5mbi5jYWxsKHJbZl0uY29udGV4dCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICAgICAgcltmXS5mbi5jYWxsKHJbZl0uY29udGV4dCwgdCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICAgICAgcltmXS5mbi5jYWxsKHJbZl0uY29udGV4dCwgdCwgcyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICAgICAgcltmXS5mbi5jYWxsKHJbZl0uY29udGV4dCwgdCwgcywgaSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIGlmICghaCkgZm9yKHYgPSAxLCBoID0gbmV3IEFycmF5KHAgLSAxKTsgdiA8IHA7IHYrKyloW3YgLSAxXSA9IGFyZ3VtZW50c1t2XTsKICAgICAgICAgICAgICAgICAgICByW2ZdLmZuLmFwcGx5KHJbZl0uY29udGV4dCwgaCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuICEwOwogICAgfTsKICAgIGMucHJvdG90eXBlLm9uID0gZnVuY3Rpb24oZSwgdCwgcykgewogICAgICAgIHJldHVybiB3KHRoaXMsIGUsIHQsIHMsICExKTsKICAgIH07CiAgICBjLnByb3RvdHlwZS5vbmNlID0gZnVuY3Rpb24oZSwgdCwgcykgewogICAgICAgIHJldHVybiB3KHRoaXMsIGUsIHQsIHMsICEwKTsKICAgIH07CiAgICBjLnByb3RvdHlwZS5yZW1vdmVMaXN0ZW5lciA9IGZ1bmN0aW9uKGUsIHQsIHMsIGkpIHsKICAgICAgICB2YXIgdSA9IGwgPyBsICsgZSA6IGU7CiAgICAgICAgaWYgKCF0aGlzLl9ldmVudHNbdV0pIHJldHVybiB0aGlzOwogICAgICAgIGlmICghdCkgcmV0dXJuIHkodGhpcywgdSksIHRoaXM7CiAgICAgICAgdmFyIG8gPSB0aGlzLl9ldmVudHNbdV07CiAgICAgICAgaWYgKG8uZm4pIG8uZm4gPT09IHQgJiYgKCFpIHx8IG8ub25jZSkgJiYgKCFzIHx8IG8uY29udGV4dCA9PT0gcykgJiYgeSh0aGlzLCB1KTsKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgZm9yKHZhciBhID0gMCwgciA9IFtdLCBwID0gby5sZW5ndGg7IGEgPCBwOyBhKyspKG9bYV0uZm4gIT09IHQgfHwgaSAmJiAhb1thXS5vbmNlIHx8IHMgJiYgb1thXS5jb250ZXh0ICE9PSBzKSAmJiByLnB1c2gob1thXSk7CiAgICAgICAgICAgIHIubGVuZ3RoID8gdGhpcy5fZXZlbnRzW3VdID0gci5sZW5ndGggPT09IDEgPyByWzBdIDogciA6IHkodGhpcywgdSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzOwogICAgfTsKICAgIGMucHJvdG90eXBlLnJlbW92ZUFsbExpc3RlbmVycyA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICB2YXIgdDsKICAgICAgICByZXR1cm4gZSA/ICh0ID0gbCA/IGwgKyBlIDogZSwgdGhpcy5fZXZlbnRzW3RdICYmIHkodGhpcywgdCkpIDogKHRoaXMuX2V2ZW50cyA9IG5ldyBfLCB0aGlzLl9ldmVudHNDb3VudCA9IDApLCB0aGlzOwogICAgfTsKICAgIGMucHJvdG90eXBlLm9mZiA9IGMucHJvdG90eXBlLnJlbW92ZUxpc3RlbmVyOwogICAgYy5wcm90b3R5cGUuYWRkTGlzdGVuZXIgPSBjLnByb3RvdHlwZS5vbjsKICAgIGMucHJlZml4ZWQgPSBsOwogICAgYy5FdmVudEVtaXR0ZXIgPSBjOwogICAgdHlwZW9mIHggPCAidSIgJiYgKHguZXhwb3J0cyA9IGMpOwp9KTsKdmFyIGcgPSBOKG0oKSwgMSk7CmcuZGVmYXVsdDsKdmFyIGV4cG9ydF9FdmVudEVtaXR0ZXIgPSBnLmRlZmF1bHQ7CnZhciB1ID0gY2xhc3MgZXh0ZW5kcyBFcnJvciB7CiAgICBjb25zdHJ1Y3RvcihlKXsKICAgICAgICBzdXBlcihlKSwgdGhpcy5uYW1lID0gIlRpbWVvdXRFcnJvciI7CiAgICB9Cn0sIGQxID0gY2xhc3MgZXh0ZW5kcyBFcnJvciB7CiAgICBjb25zdHJ1Y3RvcihlKXsKICAgICAgICBzdXBlcigpLCB0aGlzLm5hbWUgPSAiQWJvcnRFcnJvciIsIHRoaXMubWVzc2FnZSA9IGU7CiAgICB9Cn0sIEUxID0gKG4pPT5nbG9iYWxUaGlzLkRPTUV4Y2VwdGlvbiA9PT0gdm9pZCAwID8gbmV3IGQxKG4pIDogbmV3IERPTUV4Y2VwdGlvbihuKSwgcCA9IChuKT0+ewogICAgbGV0IGUgPSBuLnJlYXNvbiA9PT0gdm9pZCAwID8gRTEoIlRoaXMgb3BlcmF0aW9uIHdhcyBhYm9ydGVkLiIpIDogbi5yZWFzb247CiAgICByZXR1cm4gZSBpbnN0YW5jZW9mIEVycm9yID8gZSA6IEUxKGUpOwp9OwpmdW5jdGlvbiBUKG4sIGUpIHsKICAgIGxldCB7IG1pbGxpc2Vjb25kczogbyAsIGZhbGxiYWNrOiBmICwgbWVzc2FnZTogYSAsIGN1c3RvbVRpbWVyczogbSA9IHsKICAgICAgICBzZXRUaW1lb3V0LAogICAgICAgIGNsZWFyVGltZW91dAogICAgfSAgfSA9IGUsIGMsIGksIGwgPSBuZXcgUHJvbWlzZSgocywgcik9PnsKICAgICAgICBpZiAodHlwZW9mIG8gIT0gIm51bWJlciIgfHwgTWF0aC5zaWduKG8pICE9PSAxKSB0aHJvdyBuZXcgVHlwZUVycm9yKGBFeHBlY3RlZCBcYG1pbGxpc2Vjb25kc1xgIHRvIGJlIGEgcG9zaXRpdmUgbnVtYmVyLCBnb3QgXGAke299XGBgKTsKICAgICAgICBpZiAoZS5zaWduYWwpIHsKICAgICAgICAgICAgbGV0IHsgc2lnbmFsOiB0ICB9ID0gZTsKICAgICAgICAgICAgdC5hYm9ydGVkICYmIHIocCh0KSksIGkgPSAoKT0+ewogICAgICAgICAgICAgICAgcihwKHQpKTsKICAgICAgICAgICAgfSwgdC5hZGRFdmVudExpc3RlbmVyKCJhYm9ydCIsIGksIHsKICAgICAgICAgICAgICAgIG9uY2U6ICEwCiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBpZiAobyA9PT0gTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZKSB7CiAgICAgICAgICAgIG4udGhlbihzLCByKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBsZXQgYiA9IG5ldyB1OwogICAgICAgIGMgPSBtLnNldFRpbWVvdXQuY2FsbCh2b2lkIDAsICgpPT57CiAgICAgICAgICAgIGlmIChmKSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIHMoZigpKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKHQpIHsKICAgICAgICAgICAgICAgICAgICByKHQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHR5cGVvZiBuLmNhbmNlbCA9PSAiZnVuY3Rpb24iICYmIG4uY2FuY2VsKCksIGEgPT09ICExID8gcygpIDogYSBpbnN0YW5jZW9mIEVycm9yID8gcihhKSA6IChiLm1lc3NhZ2UgPSBhID8/IGBQcm9taXNlIHRpbWVkIG91dCBhZnRlciAke299IG1pbGxpc2Vjb25kc2AsIHIoYikpOwogICAgICAgIH0sIG8pLCAoYXN5bmMgKCk9PnsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHMoYXdhaXQgbik7CiAgICAgICAgICAgIH0gY2F0Y2ggKHQpIHsKICAgICAgICAgICAgICAgIHIodCk7CiAgICAgICAgICAgIH0KICAgICAgICB9KSgpOwogICAgfSkuZmluYWxseSgoKT0+ewogICAgICAgIGwuY2xlYXIoKSwgaSAmJiBlLnNpZ25hbCAmJiBlLnNpZ25hbC5yZW1vdmVFdmVudExpc3RlbmVyKCJhYm9ydCIsIGkpOwogICAgfSk7CiAgICByZXR1cm4gbC5jbGVhciA9ICgpPT57CiAgICAgICAgbS5jbGVhclRpbWVvdXQuY2FsbCh2b2lkIDAsIGMpLCBjID0gdm9pZCAwOwogICAgfSwgbDsKfQpmdW5jdGlvbiBhKHUsIHQsIGUpIHsKICAgIGxldCBpID0gMCwgcyA9IHUubGVuZ3RoOwogICAgZm9yKDsgcyA+IDA7KXsKICAgICAgICBsZXQgciA9IE1hdGgudHJ1bmMocyAvIDIpLCBuID0gaSArIHI7CiAgICAgICAgZSh1W25dLCB0KSA8PSAwID8gKGkgPSArK24sIHMgLT0gciArIDEpIDogcyA9IHI7CiAgICB9CiAgICByZXR1cm4gaTsKfQp2YXIgaCA9IGNsYXNzIHsKICAgICN0ID0gW107CiAgICBlbnF1ZXVlKHQsIGUpIHsKICAgICAgICBlID0gewogICAgICAgICAgICBwcmlvcml0eTogMCwKICAgICAgICAgICAgLi4uZQogICAgICAgIH07CiAgICAgICAgbGV0IGkgPSB7CiAgICAgICAgICAgIHByaW9yaXR5OiBlLnByaW9yaXR5LAogICAgICAgICAgICBpZDogZS5pZCwKICAgICAgICAgICAgcnVuOiB0CiAgICAgICAgfTsKICAgICAgICBpZiAodGhpcy5zaXplID09PSAwIHx8IHRoaXMuI3RbdGhpcy5zaXplIC0gMV0ucHJpb3JpdHkgPj0gZS5wcmlvcml0eSkgewogICAgICAgICAgICB0aGlzLiN0LnB1c2goaSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgbGV0IHMgPSBhKHRoaXMuI3QsIGksIChyLCBuKT0+bi5wcmlvcml0eSAtIHIucHJpb3JpdHkpOwogICAgICAgIHRoaXMuI3Quc3BsaWNlKHMsIDAsIGkpOwogICAgfQogICAgc2V0UHJpb3JpdHkodCwgZSkgewogICAgICAgIGxldCBpID0gdGhpcy4jdC5maW5kSW5kZXgoKHIpPT5yLmlkID09PSB0KTsKICAgICAgICBpZiAoaSA9PT0gLTEpIHRocm93IG5ldyBSZWZlcmVuY2VFcnJvcihgTm8gcHJvbWlzZSBmdW5jdGlvbiB3aXRoIHRoZSBpZCAiJHt0fSIgZXhpc3RzIGluIHRoZSBxdWV1ZS5gKTsKICAgICAgICBsZXQgW3NdID0gdGhpcy4jdC5zcGxpY2UoaSwgMSk7CiAgICAgICAgdGhpcy5lbnF1ZXVlKHMucnVuLCB7CiAgICAgICAgICAgIHByaW9yaXR5OiBlLAogICAgICAgICAgICBpZDogdAogICAgICAgIH0pOwogICAgfQogICAgZGVxdWV1ZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy4jdC5zaGlmdCgpPy5ydW47CiAgICB9CiAgICBmaWx0ZXIodCkgewogICAgICAgIHJldHVybiB0aGlzLiN0LmZpbHRlcigoZSk9PmUucHJpb3JpdHkgPT09IHQucHJpb3JpdHkpLm1hcCgoZSk9PmUucnVuKTsKICAgIH0KICAgIGdldCBzaXplKCkgewogICAgICAgIHJldHVybiB0aGlzLiN0Lmxlbmd0aDsKICAgIH0KfTsKdmFyIGwgPSBjbGFzcyBleHRlbmRzIGV4cG9ydF9FdmVudEVtaXR0ZXIgewogICAgI3Q7CiAgICAjaDsKICAgICNuID0gMDsKICAgICNkOwogICAgI3U7CiAgICAjbSA9IDA7CiAgICAjaTsKICAgICNhOwogICAgI2U7CiAgICAjeTsKICAgICNyID0gMDsKICAgICNsOwogICAgI3M7CiAgICAjdjsKICAgICNnID0gMW47CiAgICB0aW1lb3V0OwogICAgY29uc3RydWN0b3IodCl7CiAgICAgICAgaWYgKHN1cGVyKCksIHQgPSB7CiAgICAgICAgICAgIGNhcnJ5b3ZlckNvbmN1cnJlbmN5Q291bnQ6ICExLAogICAgICAgICAgICBpbnRlcnZhbENhcDogTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZLAogICAgICAgICAgICBpbnRlcnZhbDogMCwKICAgICAgICAgICAgY29uY3VycmVuY3k6IE51bWJlci5QT1NJVElWRV9JTkZJTklUWSwKICAgICAgICAgICAgYXV0b1N0YXJ0OiAhMCwKICAgICAgICAgICAgcXVldWVDbGFzczogaCwKICAgICAgICAgICAgLi4udAogICAgICAgIH0sICEodHlwZW9mIHQuaW50ZXJ2YWxDYXAgPT0gIm51bWJlciIgJiYgdC5pbnRlcnZhbENhcCA+PSAxKSkgdGhyb3cgbmV3IFR5cGVFcnJvcihgRXhwZWN0ZWQgXGBpbnRlcnZhbENhcFxgIHRvIGJlIGEgbnVtYmVyIGZyb20gMSBhbmQgdXAsIGdvdCBcYCR7dC5pbnRlcnZhbENhcD8udG9TdHJpbmcoKSA/PyAiIn1cYCAoJHt0eXBlb2YgdC5pbnRlcnZhbENhcH0pYCk7CiAgICAgICAgaWYgKHQuaW50ZXJ2YWwgPT09IHZvaWQgMCB8fCAhKE51bWJlci5pc0Zpbml0ZSh0LmludGVydmFsKSAmJiB0LmludGVydmFsID49IDApKSB0aHJvdyBuZXcgVHlwZUVycm9yKGBFeHBlY3RlZCBcYGludGVydmFsXGAgdG8gYmUgYSBmaW5pdGUgbnVtYmVyID49IDAsIGdvdCBcYCR7dC5pbnRlcnZhbD8udG9TdHJpbmcoKSA/PyAiIn1cYCAoJHt0eXBlb2YgdC5pbnRlcnZhbH0pYCk7CiAgICAgICAgdGhpcy4jdCA9IHQuY2FycnlvdmVyQ29uY3VycmVuY3lDb3VudCwgdGhpcy4jaCA9IHQuaW50ZXJ2YWxDYXAgPT09IE51bWJlci5QT1NJVElWRV9JTkZJTklUWSB8fCB0LmludGVydmFsID09PSAwLCB0aGlzLiNkID0gdC5pbnRlcnZhbENhcCwgdGhpcy4jdSA9IHQuaW50ZXJ2YWwsIHRoaXMuI2UgPSBuZXcgdC5xdWV1ZUNsYXNzLCB0aGlzLiN5ID0gdC5xdWV1ZUNsYXNzLCB0aGlzLmNvbmN1cnJlbmN5ID0gdC5jb25jdXJyZW5jeSwgdGhpcy50aW1lb3V0ID0gdC50aW1lb3V0LCB0aGlzLiN2ID0gdC50aHJvd09uVGltZW91dCA9PT0gITAsIHRoaXMuI3MgPSB0LmF1dG9TdGFydCA9PT0gITE7CiAgICB9CiAgICBnZXQgI3AoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuI2ggfHwgdGhpcy4jbiA8IHRoaXMuI2Q7CiAgICB9CiAgICBnZXQgI1QoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuI3IgPCB0aGlzLiNsOwogICAgfQogICAgI0MoKSB7CiAgICAgICAgdGhpcy4jci0tLCB0aGlzLiNvKCksIHRoaXMuZW1pdCgibmV4dCIpOwogICAgfQogICAgI0UoKSB7CiAgICAgICAgdGhpcy4jdygpLCB0aGlzLiNJKCksIHRoaXMuI2EgPSB2b2lkIDA7CiAgICB9CiAgICBnZXQgI2IoKSB7CiAgICAgICAgbGV0IHQgPSBEYXRlLm5vdygpOwogICAgICAgIGlmICh0aGlzLiNpID09PSB2b2lkIDApIHsKICAgICAgICAgICAgbGV0IGUgPSB0aGlzLiNtIC0gdDsKICAgICAgICAgICAgaWYgKGUgPCAwKSB0aGlzLiNuID0gdGhpcy4jdCA/IHRoaXMuI3IgOiAwOwogICAgICAgICAgICBlbHNlIHJldHVybiB0aGlzLiNhID09PSB2b2lkIDAgJiYgKHRoaXMuI2EgPSBzZXRUaW1lb3V0KCgpPT57CiAgICAgICAgICAgICAgICB0aGlzLiNFKCk7CiAgICAgICAgICAgIH0sIGUpKSwgITA7CiAgICAgICAgfQogICAgICAgIHJldHVybiAhMTsKICAgIH0KICAgICNvKCkgewogICAgICAgIGlmICh0aGlzLiNlLnNpemUgPT09IDApIHJldHVybiB0aGlzLiNpICYmIGNsZWFySW50ZXJ2YWwodGhpcy4jaSksIHRoaXMuI2kgPSB2b2lkIDAsIHRoaXMuZW1pdCgiZW1wdHkiKSwgdGhpcy4jciA9PT0gMCAmJiB0aGlzLmVtaXQoImlkbGUiKSwgITE7CiAgICAgICAgaWYgKCF0aGlzLiNzKSB7CiAgICAgICAgICAgIGxldCB0ID0gIXRoaXMuI2I7CiAgICAgICAgICAgIGlmICh0aGlzLiNwICYmIHRoaXMuI1QpIHsKICAgICAgICAgICAgICAgIGxldCBlID0gdGhpcy4jZS5kZXF1ZXVlKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gZSA/ICh0aGlzLmVtaXQoImFjdGl2ZSIpLCBlKCksIHQgJiYgdGhpcy4jSSgpLCAhMCkgOiAhMTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gITE7CiAgICB9CiAgICAjSSgpIHsKICAgICAgICB0aGlzLiNoIHx8IHRoaXMuI2kgIT09IHZvaWQgMCB8fCAodGhpcy4jaSA9IHNldEludGVydmFsKCgpPT57CiAgICAgICAgICAgIHRoaXMuI3coKTsKICAgICAgICB9LCB0aGlzLiN1KSwgdGhpcy4jbSA9IERhdGUubm93KCkgKyB0aGlzLiN1KTsKICAgIH0KICAgICN3KCkgewogICAgICAgIHRoaXMuI24gPT09IDAgJiYgdGhpcy4jciA9PT0gMCAmJiB0aGlzLiNpICYmIChjbGVhckludGVydmFsKHRoaXMuI2kpLCB0aGlzLiNpID0gdm9pZCAwKSwgdGhpcy4jbiA9IHRoaXMuI3QgPyB0aGlzLiNyIDogMCwgdGhpcy4jYygpOwogICAgfQogICAgI2MoKSB7CiAgICAgICAgZm9yKDsgdGhpcy4jbygpOyk7CiAgICB9CiAgICBnZXQgY29uY3VycmVuY3koKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuI2w7CiAgICB9CiAgICBzZXQgY29uY3VycmVuY3kodCkgewogICAgICAgIGlmICghKHR5cGVvZiB0ID09ICJudW1iZXIiICYmIHQgPj0gMSkpIHRocm93IG5ldyBUeXBlRXJyb3IoYEV4cGVjdGVkIFxgY29uY3VycmVuY3lcYCB0byBiZSBhIG51bWJlciBmcm9tIDEgYW5kIHVwLCBnb3QgXGAke3R9XGAgKCR7dHlwZW9mIHR9KWApOwogICAgICAgIHRoaXMuI2wgPSB0LCB0aGlzLiNjKCk7CiAgICB9CiAgICBhc3luYyAjeCh0KSB7CiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChlLCBpKT0+ewogICAgICAgICAgICB0LmFkZEV2ZW50TGlzdGVuZXIoImFib3J0IiwgKCk9PnsKICAgICAgICAgICAgICAgIGkodC5yZWFzb24pOwogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICBvbmNlOiAhMAogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgIH0KICAgIHNldFByaW9yaXR5KHQsIGUpIHsKICAgICAgICB0aGlzLiNlLnNldFByaW9yaXR5KHQsIGUpOwogICAgfQogICAgYXN5bmMgYWRkKHQsIGUgPSB7fSkgewogICAgICAgIHJldHVybiBlLmlkID8/PSAodGhpcy4jZysrKS50b1N0cmluZygpLCBlID0gewogICAgICAgICAgICB0aW1lb3V0OiB0aGlzLnRpbWVvdXQsCiAgICAgICAgICAgIHRocm93T25UaW1lb3V0OiB0aGlzLiN2LAogICAgICAgICAgICAuLi5lCiAgICAgICAgfSwgbmV3IFByb21pc2UoKGksIHMpPT57CiAgICAgICAgICAgIHRoaXMuI2UuZW5xdWV1ZShhc3luYyAoKT0+ewogICAgICAgICAgICAgICAgdGhpcy4jcisrLCB0aGlzLiNuKys7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGUuc2lnbmFsPy50aHJvd0lmQWJvcnRlZCgpOwogICAgICAgICAgICAgICAgICAgIGxldCByID0gdCh7CiAgICAgICAgICAgICAgICAgICAgICAgIHNpZ25hbDogZS5zaWduYWwKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBlLnRpbWVvdXQgJiYgKHIgPSBUKFByb21pc2UucmVzb2x2ZShyKSwgewogICAgICAgICAgICAgICAgICAgICAgICBtaWxsaXNlY29uZHM6IGUudGltZW91dAogICAgICAgICAgICAgICAgICAgIH0pKSwgZS5zaWduYWwgJiYgKHIgPSBQcm9taXNlLnJhY2UoWwogICAgICAgICAgICAgICAgICAgICAgICByLAogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiN4KGUuc2lnbmFsKQogICAgICAgICAgICAgICAgICAgIF0pKTsKICAgICAgICAgICAgICAgICAgICBsZXQgbiA9IGF3YWl0IHI7CiAgICAgICAgICAgICAgICAgICAgaShuKSwgdGhpcy5lbWl0KCJjb21wbGV0ZWQiLCBuKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKHIpIHsKICAgICAgICAgICAgICAgICAgICBpZiAociBpbnN0YW5jZW9mIHUgJiYgIWUudGhyb3dPblRpbWVvdXQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaSgpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHMociksIHRoaXMuZW1pdCgiZXJyb3IiLCByKTsKICAgICAgICAgICAgICAgIH0gZmluYWxseXsKICAgICAgICAgICAgICAgICAgICB0aGlzLiNDKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIGUpLCB0aGlzLmVtaXQoImFkZCIpLCB0aGlzLiNvKCk7CiAgICAgICAgfSk7CiAgICB9CiAgICBhc3luYyBhZGRBbGwodCwgZSkgewogICAgICAgIHJldHVybiBQcm9taXNlLmFsbCh0Lm1hcChhc3luYyAoaSk9PnRoaXMuYWRkKGksIGUpKSk7CiAgICB9CiAgICBzdGFydCgpIHsKICAgICAgICByZXR1cm4gdGhpcy4jcyA/ICh0aGlzLiNzID0gITEsIHRoaXMuI2MoKSwgdGhpcykgOiB0aGlzOwogICAgfQogICAgcGF1c2UoKSB7CiAgICAgICAgdGhpcy4jcyA9ICEwOwogICAgfQogICAgY2xlYXIoKSB7CiAgICAgICAgdGhpcy4jZSA9IG5ldyB0aGlzLiN5OwogICAgfQogICAgYXN5bmMgb25FbXB0eSgpIHsKICAgICAgICB0aGlzLiNlLnNpemUgIT09IDAgJiYgYXdhaXQgdGhpcy4jZigiZW1wdHkiKTsKICAgIH0KICAgIGFzeW5jIG9uU2l6ZUxlc3NUaGFuKHQpIHsKICAgICAgICB0aGlzLiNlLnNpemUgPCB0IHx8IGF3YWl0IHRoaXMuI2YoIm5leHQiLCAoKT0+dGhpcy4jZS5zaXplIDwgdCk7CiAgICB9CiAgICBhc3luYyBvbklkbGUoKSB7CiAgICAgICAgdGhpcy4jciA9PT0gMCAmJiB0aGlzLiNlLnNpemUgPT09IDAgfHwgYXdhaXQgdGhpcy4jZigiaWRsZSIpOwogICAgfQogICAgYXN5bmMgI2YodCwgZSkgewogICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgoaSk9PnsKICAgICAgICAgICAgbGV0IHMgPSAoKT0+ewogICAgICAgICAgICAgICAgZSAmJiAhZSgpIHx8ICh0aGlzLm9mZih0LCBzKSwgaSgpKTsKICAgICAgICAgICAgfTsKICAgICAgICAgICAgdGhpcy5vbih0LCBzKTsKICAgICAgICB9KTsKICAgIH0KICAgIGdldCBzaXplKCkgewogICAgICAgIHJldHVybiB0aGlzLiNlLnNpemU7CiAgICB9CiAgICBzaXplQnkodCkgewogICAgICAgIHJldHVybiB0aGlzLiNlLmZpbHRlcih0KS5sZW5ndGg7CiAgICB9CiAgICBnZXQgcGVuZGluZygpIHsKICAgICAgICByZXR1cm4gdGhpcy4jcjsKICAgIH0KICAgIGdldCBpc1BhdXNlZCgpIHsKICAgICAgICByZXR1cm4gdGhpcy4jczsKICAgIH0KfTsKZnVuY3Rpb24gdXRmOENvdW50KHN0cikgewogICAgY29uc3Qgc3RyTGVuZ3RoID0gc3RyLmxlbmd0aDsKICAgIGxldCBieXRlTGVuZ3RoID0gMDsKICAgIGxldCBwb3MgPSAwOwogICAgd2hpbGUocG9zIDwgc3RyTGVuZ3RoKXsKICAgICAgICBsZXQgdmFsdWUgPSBzdHIuY2hhckNvZGVBdChwb3MrKyk7CiAgICAgICAgaWYgKCh2YWx1ZSAmIDB4ZmZmZmZmODApID09PSAwKSB7CiAgICAgICAgICAgIGJ5dGVMZW5ndGgrKzsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgfSBlbHNlIGlmICgodmFsdWUgJiAweGZmZmZmODAwKSA9PT0gMCkgewogICAgICAgICAgICBieXRlTGVuZ3RoICs9IDI7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKHZhbHVlID49IDB4ZDgwMCAmJiB2YWx1ZSA8PSAweGRiZmYpIHsKICAgICAgICAgICAgICAgIGlmIChwb3MgPCBzdHJMZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBleHRyYSA9IHN0ci5jaGFyQ29kZUF0KHBvcyk7CiAgICAgICAgICAgICAgICAgICAgaWYgKChleHRyYSAmIDB4ZmMwMCkgPT09IDB4ZGMwMCkgewogICAgICAgICAgICAgICAgICAgICAgICArK3BvczsKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSAoKHZhbHVlICYgMHgzZmYpIDw8IDEwKSArIChleHRyYSAmIDB4M2ZmKSArIDB4MTAwMDA7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgodmFsdWUgJiAweGZmZmYwMDAwKSA9PT0gMCkgewogICAgICAgICAgICAgICAgYnl0ZUxlbmd0aCArPSAzOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgYnl0ZUxlbmd0aCArPSA0OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIGJ5dGVMZW5ndGg7Cn0KZnVuY3Rpb24gdXRmOEVuY29kZUpzKHN0ciwgb3V0cHV0LCBvdXRwdXRPZmZzZXQpIHsKICAgIGNvbnN0IHN0ckxlbmd0aCA9IHN0ci5sZW5ndGg7CiAgICBsZXQgb2Zmc2V0ID0gb3V0cHV0T2Zmc2V0OwogICAgbGV0IHBvcyA9IDA7CiAgICB3aGlsZShwb3MgPCBzdHJMZW5ndGgpewogICAgICAgIGxldCB2YWx1ZSA9IHN0ci5jaGFyQ29kZUF0KHBvcysrKTsKICAgICAgICBpZiAoKHZhbHVlICYgMHhmZmZmZmY4MCkgPT09IDApIHsKICAgICAgICAgICAgb3V0cHV0W29mZnNldCsrXSA9IHZhbHVlOwogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9IGVsc2UgaWYgKCh2YWx1ZSAmIDB4ZmZmZmY4MDApID09PSAwKSB7CiAgICAgICAgICAgIG91dHB1dFtvZmZzZXQrK10gPSB2YWx1ZSA+PiA2ICYgMHgxZiB8IDB4YzA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKHZhbHVlID49IDB4ZDgwMCAmJiB2YWx1ZSA8PSAweGRiZmYpIHsKICAgICAgICAgICAgICAgIGlmIChwb3MgPCBzdHJMZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBleHRyYSA9IHN0ci5jaGFyQ29kZUF0KHBvcyk7CiAgICAgICAgICAgICAgICAgICAgaWYgKChleHRyYSAmIDB4ZmMwMCkgPT09IDB4ZGMwMCkgewogICAgICAgICAgICAgICAgICAgICAgICArK3BvczsKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSAoKHZhbHVlICYgMHgzZmYpIDw8IDEwKSArIChleHRyYSAmIDB4M2ZmKSArIDB4MTAwMDA7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgodmFsdWUgJiAweGZmZmYwMDAwKSA9PT0gMCkgewogICAgICAgICAgICAgICAgb3V0cHV0W29mZnNldCsrXSA9IHZhbHVlID4+IDEyICYgMHgwZiB8IDB4ZTA7CiAgICAgICAgICAgICAgICBvdXRwdXRbb2Zmc2V0KytdID0gdmFsdWUgPj4gNiAmIDB4M2YgfCAweDgwOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgb3V0cHV0W29mZnNldCsrXSA9IHZhbHVlID4+IDE4ICYgMHgwNyB8IDB4ZjA7CiAgICAgICAgICAgICAgICBvdXRwdXRbb2Zmc2V0KytdID0gdmFsdWUgPj4gMTIgJiAweDNmIHwgMHg4MDsKICAgICAgICAgICAgICAgIG91dHB1dFtvZmZzZXQrK10gPSB2YWx1ZSA+PiA2ICYgMHgzZiB8IDB4ODA7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgb3V0cHV0W29mZnNldCsrXSA9IHZhbHVlICYgMHgzZiB8IDB4ODA7CiAgICB9Cn0KY29uc3Qgc2hhcmVkVGV4dEVuY29kZXIgPSBuZXcgVGV4dEVuY29kZXIoKTsKZnVuY3Rpb24gdXRmOEVuY29kZVRFKHN0ciwgb3V0cHV0LCBvdXRwdXRPZmZzZXQpIHsKICAgIHNoYXJlZFRleHRFbmNvZGVyLmVuY29kZUludG8oc3RyLCBvdXRwdXQuc3ViYXJyYXkob3V0cHV0T2Zmc2V0KSk7Cn0KZnVuY3Rpb24gdXRmOEVuY29kZShzdHIsIG91dHB1dCwgb3V0cHV0T2Zmc2V0KSB7CiAgICBpZiAoc3RyLmxlbmd0aCA+IDUwKSB7CiAgICAgICAgdXRmOEVuY29kZVRFKHN0ciwgb3V0cHV0LCBvdXRwdXRPZmZzZXQpOwogICAgfSBlbHNlIHsKICAgICAgICB1dGY4RW5jb2RlSnMoc3RyLCBvdXRwdXQsIG91dHB1dE9mZnNldCk7CiAgICB9Cn0KZnVuY3Rpb24gdXRmOERlY29kZUpzKGJ5dGVzLCBpbnB1dE9mZnNldCwgYnl0ZUxlbmd0aCkgewogICAgbGV0IG9mZnNldCA9IGlucHV0T2Zmc2V0OwogICAgY29uc3QgZW5kID0gb2Zmc2V0ICsgYnl0ZUxlbmd0aDsKICAgIGNvbnN0IHVuaXRzID0gW107CiAgICBsZXQgcmVzdWx0ID0gIiI7CiAgICB3aGlsZShvZmZzZXQgPCBlbmQpewogICAgICAgIGNvbnN0IGJ5dGUxID0gYnl0ZXNbb2Zmc2V0KytdOwogICAgICAgIGlmICgoYnl0ZTEgJiAweDgwKSA9PT0gMCkgewogICAgICAgICAgICB1bml0cy5wdXNoKGJ5dGUxKTsKICAgICAgICB9IGVsc2UgaWYgKChieXRlMSAmIDB4ZTApID09PSAweGMwKSB7CiAgICAgICAgICAgIGNvbnN0IGJ5dGUyID0gYnl0ZXNbb2Zmc2V0KytdICYgMHgzZjsKICAgICAgICAgICAgdW5pdHMucHVzaCgoYnl0ZTEgJiAweDFmKSA8PCA2IHwgYnl0ZTIpOwogICAgICAgIH0gZWxzZSBpZiAoKGJ5dGUxICYgMHhmMCkgPT09IDB4ZTApIHsKICAgICAgICAgICAgY29uc3QgYnl0ZTIgPSBieXRlc1tvZmZzZXQrK10gJiAweDNmOwogICAgICAgICAgICBjb25zdCBieXRlMyA9IGJ5dGVzW29mZnNldCsrXSAmIDB4M2Y7CiAgICAgICAgICAgIHVuaXRzLnB1c2goKGJ5dGUxICYgMHgxZikgPDwgMTIgfCBieXRlMiA8PCA2IHwgYnl0ZTMpOwogICAgICAgIH0gZWxzZSBpZiAoKGJ5dGUxICYgMHhmOCkgPT09IDB4ZjApIHsKICAgICAgICAgICAgY29uc3QgYnl0ZTIgPSBieXRlc1tvZmZzZXQrK10gJiAweDNmOwogICAgICAgICAgICBjb25zdCBieXRlMyA9IGJ5dGVzW29mZnNldCsrXSAmIDB4M2Y7CiAgICAgICAgICAgIGNvbnN0IGJ5dGU0ID0gYnl0ZXNbb2Zmc2V0KytdICYgMHgzZjsKICAgICAgICAgICAgbGV0IHVuaXQgPSAoYnl0ZTEgJiAweDA3KSA8PCAweDEyIHwgYnl0ZTIgPDwgMHgwYyB8IGJ5dGUzIDw8IDB4MDYgfCBieXRlNDsKICAgICAgICAgICAgaWYgKHVuaXQgPiAweGZmZmYpIHsKICAgICAgICAgICAgICAgIHVuaXQgLT0gMHgxMDAwMDsKICAgICAgICAgICAgICAgIHVuaXRzLnB1c2godW5pdCA+Pj4gMTAgJiAweDNmZiB8IDB4ZDgwMCk7CiAgICAgICAgICAgICAgICB1bml0ID0gMHhkYzAwIHwgdW5pdCAmIDB4M2ZmOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHVuaXRzLnB1c2godW5pdCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdW5pdHMucHVzaChieXRlMSk7CiAgICAgICAgfQogICAgICAgIGlmICh1bml0cy5sZW5ndGggPj0gNDA5NikgewogICAgICAgICAgICByZXN1bHQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSguLi51bml0cyk7CiAgICAgICAgICAgIHVuaXRzLmxlbmd0aCA9IDA7CiAgICAgICAgfQogICAgfQogICAgaWYgKHVuaXRzLmxlbmd0aCA+IDApIHsKICAgICAgICByZXN1bHQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSguLi51bml0cyk7CiAgICB9CiAgICByZXR1cm4gcmVzdWx0Owp9CmNvbnN0IHNoYXJlZFRleHREZWNvZGVyID0gbmV3IFRleHREZWNvZGVyKCk7CmZ1bmN0aW9uIHV0ZjhEZWNvZGVURChieXRlcywgaW5wdXRPZmZzZXQsIGJ5dGVMZW5ndGgpIHsKICAgIGNvbnN0IHN0cmluZ0J5dGVzID0gYnl0ZXMuc3ViYXJyYXkoaW5wdXRPZmZzZXQsIGlucHV0T2Zmc2V0ICsgYnl0ZUxlbmd0aCk7CiAgICByZXR1cm4gc2hhcmVkVGV4dERlY29kZXIuZGVjb2RlKHN0cmluZ0J5dGVzKTsKfQpmdW5jdGlvbiB1dGY4RGVjb2RlKGJ5dGVzLCBpbnB1dE9mZnNldCwgYnl0ZUxlbmd0aCkgewogICAgaWYgKGJ5dGVMZW5ndGggPiAyMDApIHsKICAgICAgICByZXR1cm4gdXRmOERlY29kZVREKGJ5dGVzLCBpbnB1dE9mZnNldCwgYnl0ZUxlbmd0aCk7CiAgICB9IGVsc2UgewogICAgICAgIHJldHVybiB1dGY4RGVjb2RlSnMoYnl0ZXMsIGlucHV0T2Zmc2V0LCBieXRlTGVuZ3RoKTsKICAgIH0KfQpjbGFzcyBFeHREYXRhIHsKICAgIGNvbnN0cnVjdG9yKHR5cGUsIGRhdGEpewogICAgICAgIHRoaXMudHlwZSA9IHR5cGU7CiAgICAgICAgdGhpcy5kYXRhID0gZGF0YTsKICAgIH0KfQpjbGFzcyBEZWNvZGVFcnJvciBleHRlbmRzIEVycm9yIHsKICAgIGNvbnN0cnVjdG9yKG1lc3NhZ2UpewogICAgICAgIHN1cGVyKG1lc3NhZ2UpOwogICAgICAgIGNvbnN0IHByb3RvID0gT2JqZWN0LmNyZWF0ZShEZWNvZGVFcnJvci5wcm90b3R5cGUpOwogICAgICAgIE9iamVjdC5zZXRQcm90b3R5cGVPZih0aGlzLCBwcm90byk7CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsICJuYW1lIiwgewogICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgICAgICAgIGVudW1lcmFibGU6IGZhbHNlLAogICAgICAgICAgICB2YWx1ZTogRGVjb2RlRXJyb3IubmFtZQogICAgICAgIH0pOwogICAgfQp9CmNvbnN0IFVJTlQzMl9NQVggPSA0Mjk0OTY3Mjk1OwpmdW5jdGlvbiBzZXRVaW50NjQodmlldywgb2Zmc2V0LCB2YWx1ZSkgewogICAgY29uc3QgaGlnaCA9IHZhbHVlIC8gNDI5NDk2NzI5NjsKICAgIGNvbnN0IGxvdyA9IHZhbHVlOwogICAgdmlldy5zZXRVaW50MzIob2Zmc2V0LCBoaWdoKTsKICAgIHZpZXcuc2V0VWludDMyKG9mZnNldCArIDQsIGxvdyk7Cn0KZnVuY3Rpb24gc2V0SW50NjQodmlldywgb2Zmc2V0LCB2YWx1ZSkgewogICAgY29uc3QgaGlnaCA9IE1hdGguZmxvb3IodmFsdWUgLyA0Mjk0OTY3Mjk2KTsKICAgIGNvbnN0IGxvdyA9IHZhbHVlOwogICAgdmlldy5zZXRVaW50MzIob2Zmc2V0LCBoaWdoKTsKICAgIHZpZXcuc2V0VWludDMyKG9mZnNldCArIDQsIGxvdyk7Cn0KZnVuY3Rpb24gZ2V0SW50NjQodmlldywgb2Zmc2V0KSB7CiAgICBjb25zdCBoaWdoID0gdmlldy5nZXRJbnQzMihvZmZzZXQpOwogICAgY29uc3QgbG93ID0gdmlldy5nZXRVaW50MzIob2Zmc2V0ICsgNCk7CiAgICByZXR1cm4gaGlnaCAqIDQyOTQ5NjcyOTYgKyBsb3c7Cn0KZnVuY3Rpb24gZ2V0VWludDY0KHZpZXcsIG9mZnNldCkgewogICAgY29uc3QgaGlnaCA9IHZpZXcuZ2V0VWludDMyKG9mZnNldCk7CiAgICBjb25zdCBsb3cgPSB2aWV3LmdldFVpbnQzMihvZmZzZXQgKyA0KTsKICAgIHJldHVybiBoaWdoICogNDI5NDk2NzI5NiArIGxvdzsKfQpjb25zdCBFWFRfVElNRVNUQU1QID0gLTE7CmNvbnN0IFRJTUVTVEFNUDMyX01BWF9TRUMgPSAweDEwMDAwMDAwMCAtIDE7CmNvbnN0IFRJTUVTVEFNUDY0X01BWF9TRUMgPSAweDQwMDAwMDAwMCAtIDE7CmZ1bmN0aW9uIGVuY29kZVRpbWVTcGVjVG9UaW1lc3RhbXAoeyBzZWMgLCBuc2VjICB9KSB7CiAgICBpZiAoc2VjID49IDAgJiYgbnNlYyA+PSAwICYmIHNlYyA8PSBUSU1FU1RBTVA2NF9NQVhfU0VDKSB7CiAgICAgICAgaWYgKG5zZWMgPT09IDAgJiYgc2VjIDw9IFRJTUVTVEFNUDMyX01BWF9TRUMpIHsKICAgICAgICAgICAgY29uc3QgcnYgPSBuZXcgVWludDhBcnJheSg0KTsKICAgICAgICAgICAgY29uc3QgdmlldyA9IG5ldyBEYXRhVmlldyhydi5idWZmZXIpOwogICAgICAgICAgICB2aWV3LnNldFVpbnQzMigwLCBzZWMpOwogICAgICAgICAgICByZXR1cm4gcnY7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29uc3Qgc2VjSGlnaCA9IHNlYyAvIDB4MTAwMDAwMDAwOwogICAgICAgICAgICBjb25zdCBzZWNMb3cgPSBzZWMgJiAweGZmZmZmZmZmOwogICAgICAgICAgICBjb25zdCBydiA9IG5ldyBVaW50OEFycmF5KDgpOwogICAgICAgICAgICBjb25zdCB2aWV3ID0gbmV3IERhdGFWaWV3KHJ2LmJ1ZmZlcik7CiAgICAgICAgICAgIHZpZXcuc2V0VWludDMyKDAsIG5zZWMgPDwgMiB8IHNlY0hpZ2ggJiAweDMpOwogICAgICAgICAgICB2aWV3LnNldFVpbnQzMig0LCBzZWNMb3cpOwogICAgICAgICAgICByZXR1cm4gcnY7CiAgICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgICBjb25zdCBydiA9IG5ldyBVaW50OEFycmF5KDEyKTsKICAgICAgICBjb25zdCB2aWV3ID0gbmV3IERhdGFWaWV3KHJ2LmJ1ZmZlcik7CiAgICAgICAgdmlldy5zZXRVaW50MzIoMCwgbnNlYyk7CiAgICAgICAgc2V0SW50NjQodmlldywgNCwgc2VjKTsKICAgICAgICByZXR1cm4gcnY7CiAgICB9Cn0KZnVuY3Rpb24gZW5jb2RlRGF0ZVRvVGltZVNwZWMoZGF0ZSkgewogICAgY29uc3QgbXNlYyA9IGRhdGUuZ2V0VGltZSgpOwogICAgY29uc3Qgc2VjID0gTWF0aC5mbG9vcihtc2VjIC8gMWUzKTsKICAgIGNvbnN0IG5zZWMgPSAobXNlYyAtIHNlYyAqIDFlMykgKiAxZTY7CiAgICBjb25zdCBuc2VjSW5TZWMgPSBNYXRoLmZsb29yKG5zZWMgLyAxZTkpOwogICAgcmV0dXJuIHsKICAgICAgICBzZWM6IHNlYyArIG5zZWNJblNlYywKICAgICAgICBuc2VjOiBuc2VjIC0gbnNlY0luU2VjICogMWU5CiAgICB9Owp9CmZ1bmN0aW9uIGVuY29kZVRpbWVzdGFtcEV4dGVuc2lvbihvYmplY3QpIHsKICAgIGlmIChvYmplY3QgaW5zdGFuY2VvZiBEYXRlKSB7CiAgICAgICAgY29uc3QgdGltZVNwZWMgPSBlbmNvZGVEYXRlVG9UaW1lU3BlYyhvYmplY3QpOwogICAgICAgIHJldHVybiBlbmNvZGVUaW1lU3BlY1RvVGltZXN0YW1wKHRpbWVTcGVjKTsKICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9Cn0KZnVuY3Rpb24gZGVjb2RlVGltZXN0YW1wVG9UaW1lU3BlYyhkYXRhKSB7CiAgICBjb25zdCB2aWV3ID0gbmV3IERhdGFWaWV3KGRhdGEuYnVmZmVyLCBkYXRhLmJ5dGVPZmZzZXQsIGRhdGEuYnl0ZUxlbmd0aCk7CiAgICBzd2l0Y2goZGF0YS5ieXRlTGVuZ3RoKXsKICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGNvbnN0IHNlYyA9IHZpZXcuZ2V0VWludDMyKDApOwogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICBzZWMsCiAgICAgICAgICAgICAgICAgICAgbnNlYzogMAogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgIGNhc2UgODoKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgY29uc3QgbnNlYzMwQW5kU2VjSGlnaDIgPSB2aWV3LmdldFVpbnQzMigwKTsKICAgICAgICAgICAgICAgIGNvbnN0IHNlY0xvdzMyID0gdmlldy5nZXRVaW50MzIoNCk7CiAgICAgICAgICAgICAgICBjb25zdCBzZWMgPSAobnNlYzMwQW5kU2VjSGlnaDIgJiAweDMpICogMHgxMDAwMDAwMDAgKyBzZWNMb3czMjsKICAgICAgICAgICAgICAgIGNvbnN0IG5zZWMgPSBuc2VjMzBBbmRTZWNIaWdoMiA+Pj4gMjsKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgc2VjLAogICAgICAgICAgICAgICAgICAgIG5zZWMKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICBjYXNlIDEyOgogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBjb25zdCBzZWMgPSBnZXRJbnQ2NCh2aWV3LCA0KTsKICAgICAgICAgICAgICAgIGNvbnN0IG5zZWMgPSB2aWV3LmdldFVpbnQzMigwKTsKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgc2VjLAogICAgICAgICAgICAgICAgICAgIG5zZWMKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICB0aHJvdyBuZXcgRGVjb2RlRXJyb3IoYFVucmVjb2duaXplZCBkYXRhIHNpemUgZm9yIHRpbWVzdGFtcCAoZXhwZWN0ZWQgNCwgOCwgb3IgMTIpOiAke2RhdGEubGVuZ3RofWApOwogICAgfQp9CmZ1bmN0aW9uIGRlY29kZVRpbWVzdGFtcEV4dGVuc2lvbihkYXRhKSB7CiAgICBjb25zdCB0aW1lU3BlYyA9IGRlY29kZVRpbWVzdGFtcFRvVGltZVNwZWMoZGF0YSk7CiAgICByZXR1cm4gbmV3IERhdGUodGltZVNwZWMuc2VjICogMWUzICsgdGltZVNwZWMubnNlYyAvIDFlNik7Cn0KY29uc3QgdGltZXN0YW1wRXh0ZW5zaW9uID0gewogICAgdHlwZTogRVhUX1RJTUVTVEFNUCwKICAgIGVuY29kZTogZW5jb2RlVGltZXN0YW1wRXh0ZW5zaW9uLAogICAgZGVjb2RlOiBkZWNvZGVUaW1lc3RhbXBFeHRlbnNpb24KfTsKY2xhc3MgRXh0ZW5zaW9uQ29kZWMgewogICAgY29uc3RydWN0b3IoKXsKICAgICAgICB0aGlzLmJ1aWx0SW5FbmNvZGVycyA9IFtdOwogICAgICAgIHRoaXMuYnVpbHRJbkRlY29kZXJzID0gW107CiAgICAgICAgdGhpcy5lbmNvZGVycyA9IFtdOwogICAgICAgIHRoaXMuZGVjb2RlcnMgPSBbXTsKICAgICAgICB0aGlzLnJlZ2lzdGVyKHRpbWVzdGFtcEV4dGVuc2lvbik7CiAgICB9CiAgICByZWdpc3Rlcih7IHR5cGUgLCBlbmNvZGUgLCBkZWNvZGUgIH0pIHsKICAgICAgICBpZiAodHlwZSA+PSAwKSB7CiAgICAgICAgICAgIHRoaXMuZW5jb2RlcnNbdHlwZV0gPSBlbmNvZGU7CiAgICAgICAgICAgIHRoaXMuZGVjb2RlcnNbdHlwZV0gPSBkZWNvZGU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29uc3QgaW5kZXggPSAtMSAtIHR5cGU7CiAgICAgICAgICAgIHRoaXMuYnVpbHRJbkVuY29kZXJzW2luZGV4XSA9IGVuY29kZTsKICAgICAgICAgICAgdGhpcy5idWlsdEluRGVjb2RlcnNbaW5kZXhdID0gZGVjb2RlOwogICAgICAgIH0KICAgIH0KICAgIHRyeVRvRW5jb2RlKG9iamVjdCwgY29udGV4dCkgewogICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCB0aGlzLmJ1aWx0SW5FbmNvZGVycy5sZW5ndGg7IGkrKyl7CiAgICAgICAgICAgIGNvbnN0IGVuY29kZUV4dCA9IHRoaXMuYnVpbHRJbkVuY29kZXJzW2ldOwogICAgICAgICAgICBpZiAoZW5jb2RlRXh0ICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBlbmNvZGVFeHQob2JqZWN0LCBjb250ZXh0KTsKICAgICAgICAgICAgICAgIGlmIChkYXRhICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCB0eXBlID0gLTEgLSBpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRXh0RGF0YSh0eXBlLCBkYXRhKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgdGhpcy5lbmNvZGVycy5sZW5ndGg7IGkrKyl7CiAgICAgICAgICAgIGNvbnN0IGVuY29kZUV4dCA9IHRoaXMuZW5jb2RlcnNbaV07CiAgICAgICAgICAgIGlmIChlbmNvZGVFeHQgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IGVuY29kZUV4dChvYmplY3QsIGNvbnRleHQpOwogICAgICAgICAgICAgICAgaWYgKGRhdGEgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHR5cGUgPSBpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRXh0RGF0YSh0eXBlLCBkYXRhKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAob2JqZWN0IGluc3RhbmNlb2YgRXh0RGF0YSkgewogICAgICAgICAgICByZXR1cm4gb2JqZWN0OwogICAgICAgIH0KICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGRlY29kZShkYXRhLCB0eXBlLCBjb250ZXh0KSB7CiAgICAgICAgY29uc3QgZGVjb2RlRXh0ID0gdHlwZSA8IDAgPyB0aGlzLmJ1aWx0SW5EZWNvZGVyc1stMSAtIHR5cGVdIDogdGhpcy5kZWNvZGVyc1t0eXBlXTsKICAgICAgICBpZiAoZGVjb2RlRXh0KSB7CiAgICAgICAgICAgIHJldHVybiBkZWNvZGVFeHQoZGF0YSwgdHlwZSwgY29udGV4dCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBFeHREYXRhKHR5cGUsIGRhdGEpOwogICAgICAgIH0KICAgIH0KfQpFeHRlbnNpb25Db2RlYy5kZWZhdWx0Q29kZWMgPSBuZXcgRXh0ZW5zaW9uQ29kZWMoKTsKZnVuY3Rpb24gaXNBcnJheUJ1ZmZlckxpa2UoYnVmZmVyKSB7CiAgICByZXR1cm4gYnVmZmVyIGluc3RhbmNlb2YgQXJyYXlCdWZmZXIgfHwgdHlwZW9mIFNoYXJlZEFycmF5QnVmZmVyICE9PSAidW5kZWZpbmVkIiAmJiBidWZmZXIgaW5zdGFuY2VvZiBTaGFyZWRBcnJheUJ1ZmZlcjsKfQpmdW5jdGlvbiBlbnN1cmVVaW50OEFycmF5KGJ1ZmZlcikgewogICAgaWYgKGJ1ZmZlciBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkpIHsKICAgICAgICByZXR1cm4gYnVmZmVyOwogICAgfSBlbHNlIGlmIChBcnJheUJ1ZmZlci5pc1ZpZXcoYnVmZmVyKSkgewogICAgICAgIHJldHVybiBuZXcgVWludDhBcnJheShidWZmZXIuYnVmZmVyLCBidWZmZXIuYnl0ZU9mZnNldCwgYnVmZmVyLmJ5dGVMZW5ndGgpOwogICAgfSBlbHNlIGlmIChpc0FycmF5QnVmZmVyTGlrZShidWZmZXIpKSB7CiAgICAgICAgcmV0dXJuIG5ldyBVaW50OEFycmF5KGJ1ZmZlcik7CiAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBVaW50OEFycmF5LmZyb20oYnVmZmVyKTsKICAgIH0KfQpjb25zdCBERUZBVUxUX01BWF9ERVBUSCA9IDEwMDsKY29uc3QgREVGQVVMVF9JTklUSUFMX0JVRkZFUl9TSVpFID0gMjA0ODsKY2xhc3MgRW5jb2RlciB7CiAgICBjb25zdHJ1Y3RvcihvcHRpb25zKXsKICAgICAgICB0aGlzLmVudGVyZWQgPSBmYWxzZTsKICAgICAgICB0aGlzLmV4dGVuc2lvbkNvZGVjID0gb3B0aW9ucz8uZXh0ZW5zaW9uQ29kZWMgPz8gRXh0ZW5zaW9uQ29kZWMuZGVmYXVsdENvZGVjOwogICAgICAgIHRoaXMuY29udGV4dCA9IG9wdGlvbnM/LmNvbnRleHQ7CiAgICAgICAgdGhpcy51c2VCaWdJbnQ2NCA9IG9wdGlvbnM/LnVzZUJpZ0ludDY0ID8/IGZhbHNlOwogICAgICAgIHRoaXMubWF4RGVwdGggPSBvcHRpb25zPy5tYXhEZXB0aCA/PyBERUZBVUxUX01BWF9ERVBUSDsKICAgICAgICB0aGlzLmluaXRpYWxCdWZmZXJTaXplID0gb3B0aW9ucz8uaW5pdGlhbEJ1ZmZlclNpemUgPz8gREVGQVVMVF9JTklUSUFMX0JVRkZFUl9TSVpFOwogICAgICAgIHRoaXMuc29ydEtleXMgPSBvcHRpb25zPy5zb3J0S2V5cyA/PyBmYWxzZTsKICAgICAgICB0aGlzLmZvcmNlRmxvYXQzMiA9IG9wdGlvbnM/LmZvcmNlRmxvYXQzMiA/PyBmYWxzZTsKICAgICAgICB0aGlzLmlnbm9yZVVuZGVmaW5lZCA9IG9wdGlvbnM/Lmlnbm9yZVVuZGVmaW5lZCA/PyBmYWxzZTsKICAgICAgICB0aGlzLmZvcmNlSW50ZWdlclRvRmxvYXQgPSBvcHRpb25zPy5mb3JjZUludGVnZXJUb0Zsb2F0ID8/IGZhbHNlOwogICAgICAgIHRoaXMucG9zID0gMDsKICAgICAgICB0aGlzLnZpZXcgPSBuZXcgRGF0YVZpZXcobmV3IEFycmF5QnVmZmVyKHRoaXMuaW5pdGlhbEJ1ZmZlclNpemUpKTsKICAgICAgICB0aGlzLmJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkodGhpcy52aWV3LmJ1ZmZlcik7CiAgICB9CiAgICBjbG9uZSgpIHsKICAgICAgICByZXR1cm4gbmV3IEVuY29kZXIoewogICAgICAgICAgICBleHRlbnNpb25Db2RlYzogdGhpcy5leHRlbnNpb25Db2RlYywKICAgICAgICAgICAgY29udGV4dDogdGhpcy5jb250ZXh0LAogICAgICAgICAgICB1c2VCaWdJbnQ2NDogdGhpcy51c2VCaWdJbnQ2NCwKICAgICAgICAgICAgbWF4RGVwdGg6IHRoaXMubWF4RGVwdGgsCiAgICAgICAgICAgIGluaXRpYWxCdWZmZXJTaXplOiB0aGlzLmluaXRpYWxCdWZmZXJTaXplLAogICAgICAgICAgICBzb3J0S2V5czogdGhpcy5zb3J0S2V5cywKICAgICAgICAgICAgZm9yY2VGbG9hdDMyOiB0aGlzLmZvcmNlRmxvYXQzMiwKICAgICAgICAgICAgaWdub3JlVW5kZWZpbmVkOiB0aGlzLmlnbm9yZVVuZGVmaW5lZCwKICAgICAgICAgICAgZm9yY2VJbnRlZ2VyVG9GbG9hdDogdGhpcy5mb3JjZUludGVnZXJUb0Zsb2F0CiAgICAgICAgfSk7CiAgICB9CiAgICByZWluaXRpYWxpemVTdGF0ZSgpIHsKICAgICAgICB0aGlzLnBvcyA9IDA7CiAgICB9CiAgICBlbmNvZGVTaGFyZWRSZWYob2JqZWN0KSB7CiAgICAgICAgaWYgKHRoaXMuZW50ZXJlZCkgewogICAgICAgICAgICBjb25zdCBpbnN0YW5jZSA9IHRoaXMuY2xvbmUoKTsKICAgICAgICAgICAgcmV0dXJuIGluc3RhbmNlLmVuY29kZVNoYXJlZFJlZihvYmplY3QpOwogICAgICAgIH0KICAgICAgICB0cnkgewogICAgICAgICAgICB0aGlzLmVudGVyZWQgPSB0cnVlOwogICAgICAgICAgICB0aGlzLnJlaW5pdGlhbGl6ZVN0YXRlKCk7CiAgICAgICAgICAgIHRoaXMuZG9FbmNvZGUob2JqZWN0LCAxKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuYnl0ZXMuc3ViYXJyYXkoMCwgdGhpcy5wb3MpOwogICAgICAgIH0gZmluYWxseXsKICAgICAgICAgICAgdGhpcy5lbnRlcmVkID0gZmFsc2U7CiAgICAgICAgfQogICAgfQogICAgZW5jb2RlKG9iamVjdCkgewogICAgICAgIGlmICh0aGlzLmVudGVyZWQpIHsKICAgICAgICAgICAgY29uc3QgaW5zdGFuY2UgPSB0aGlzLmNsb25lKCk7CiAgICAgICAgICAgIHJldHVybiBpbnN0YW5jZS5lbmNvZGUob2JqZWN0KTsKICAgICAgICB9CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgdGhpcy5lbnRlcmVkID0gdHJ1ZTsKICAgICAgICAgICAgdGhpcy5yZWluaXRpYWxpemVTdGF0ZSgpOwogICAgICAgICAgICB0aGlzLmRvRW5jb2RlKG9iamVjdCwgMSk7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmJ5dGVzLnNsaWNlKDAsIHRoaXMucG9zKTsKICAgICAgICB9IGZpbmFsbHl7CiAgICAgICAgICAgIHRoaXMuZW50ZXJlZCA9IGZhbHNlOwogICAgICAgIH0KICAgIH0KICAgIGRvRW5jb2RlKG9iamVjdCwgZGVwdGgpIHsKICAgICAgICBpZiAoZGVwdGggPiB0aGlzLm1heERlcHRoKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgVG9vIGRlZXAgb2JqZWN0cyBpbiBkZXB0aCAke2RlcHRofWApOwogICAgICAgIH0KICAgICAgICBpZiAob2JqZWN0ID09IG51bGwpIHsKICAgICAgICAgICAgdGhpcy5lbmNvZGVOaWwoKTsKICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBvYmplY3QgPT09ICJib29sZWFuIikgewogICAgICAgICAgICB0aGlzLmVuY29kZUJvb2xlYW4ob2JqZWN0KTsKICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBvYmplY3QgPT09ICJudW1iZXIiKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5mb3JjZUludGVnZXJUb0Zsb2F0KSB7CiAgICAgICAgICAgICAgICB0aGlzLmVuY29kZU51bWJlcihvYmplY3QpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5lbmNvZGVOdW1iZXJBc0Zsb2F0KG9iamVjdCk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBvYmplY3QgPT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgIHRoaXMuZW5jb2RlU3RyaW5nKG9iamVjdCk7CiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnVzZUJpZ0ludDY0ICYmIHR5cGVvZiBvYmplY3QgPT09ICJiaWdpbnQiKSB7CiAgICAgICAgICAgIHRoaXMuZW5jb2RlQmlnSW50NjQob2JqZWN0KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLmVuY29kZU9iamVjdChvYmplY3QsIGRlcHRoKTsKICAgICAgICB9CiAgICB9CiAgICBlbnN1cmVCdWZmZXJTaXplVG9Xcml0ZShzaXplVG9Xcml0ZSkgewogICAgICAgIGNvbnN0IHJlcXVpcmVkU2l6ZSA9IHRoaXMucG9zICsgc2l6ZVRvV3JpdGU7CiAgICAgICAgaWYgKHRoaXMudmlldy5ieXRlTGVuZ3RoIDwgcmVxdWlyZWRTaXplKSB7CiAgICAgICAgICAgIHRoaXMucmVzaXplQnVmZmVyKHJlcXVpcmVkU2l6ZSAqIDIpOwogICAgICAgIH0KICAgIH0KICAgIHJlc2l6ZUJ1ZmZlcihuZXdTaXplKSB7CiAgICAgICAgY29uc3QgbmV3QnVmZmVyID0gbmV3IEFycmF5QnVmZmVyKG5ld1NpemUpOwogICAgICAgIGNvbnN0IG5ld0J5dGVzID0gbmV3IFVpbnQ4QXJyYXkobmV3QnVmZmVyKTsKICAgICAgICBjb25zdCBuZXdWaWV3ID0gbmV3IERhdGFWaWV3KG5ld0J1ZmZlcik7CiAgICAgICAgbmV3Qnl0ZXMuc2V0KHRoaXMuYnl0ZXMpOwogICAgICAgIHRoaXMudmlldyA9IG5ld1ZpZXc7CiAgICAgICAgdGhpcy5ieXRlcyA9IG5ld0J5dGVzOwogICAgfQogICAgZW5jb2RlTmlsKCkgewogICAgICAgIHRoaXMud3JpdGVVOCgweGMwKTsKICAgIH0KICAgIGVuY29kZUJvb2xlYW4ob2JqZWN0KSB7CiAgICAgICAgaWYgKG9iamVjdCA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgdGhpcy53cml0ZVU4KDB4YzIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMud3JpdGVVOCgweGMzKTsKICAgICAgICB9CiAgICB9CiAgICBlbmNvZGVOdW1iZXIob2JqZWN0KSB7CiAgICAgICAgaWYgKCF0aGlzLmZvcmNlSW50ZWdlclRvRmxvYXQgJiYgTnVtYmVyLmlzU2FmZUludGVnZXIob2JqZWN0KSkgewogICAgICAgICAgICBpZiAob2JqZWN0ID49IDApIHsKICAgICAgICAgICAgICAgIGlmIChvYmplY3QgPCAweDgwKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy53cml0ZVU4KG9iamVjdCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9iamVjdCA8IDB4MTAwKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy53cml0ZVU4KDB4Y2MpOwogICAgICAgICAgICAgICAgICAgIHRoaXMud3JpdGVVOChvYmplY3QpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChvYmplY3QgPCAweDEwMDAwKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy53cml0ZVU4KDB4Y2QpOwogICAgICAgICAgICAgICAgICAgIHRoaXMud3JpdGVVMTYob2JqZWN0KTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAob2JqZWN0IDwgMHgxMDAwMDAwMDApIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLndyaXRlVTgoMHhjZSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy53cml0ZVUzMihvYmplY3QpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICghdGhpcy51c2VCaWdJbnQ2NCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMud3JpdGVVOCgweGNmKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLndyaXRlVTY0KG9iamVjdCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRoaXMuZW5jb2RlTnVtYmVyQXNGbG9hdChvYmplY3QpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaWYgKG9iamVjdCA+PSAtMHgyMCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMud3JpdGVVOCgweGUwIHwgb2JqZWN0ICsgMHgyMCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9iamVjdCA+PSAtMHg4MCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMud3JpdGVVOCgweGQwKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLndyaXRlSTgob2JqZWN0KTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAob2JqZWN0ID49IC0weDgwMDApIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLndyaXRlVTgoMHhkMSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy53cml0ZUkxNihvYmplY3QpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChvYmplY3QgPj0gLTB4ODAwMDAwMDApIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLndyaXRlVTgoMHhkMik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy53cml0ZUkzMihvYmplY3QpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICghdGhpcy51c2VCaWdJbnQ2NCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMud3JpdGVVOCgweGQzKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLndyaXRlSTY0KG9iamVjdCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRoaXMuZW5jb2RlTnVtYmVyQXNGbG9hdChvYmplY3QpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5lbmNvZGVOdW1iZXJBc0Zsb2F0KG9iamVjdCk7CiAgICAgICAgfQogICAgfQogICAgZW5jb2RlTnVtYmVyQXNGbG9hdChvYmplY3QpIHsKICAgICAgICBpZiAodGhpcy5mb3JjZUZsb2F0MzIpIHsKICAgICAgICAgICAgdGhpcy53cml0ZVU4KDB4Y2EpOwogICAgICAgICAgICB0aGlzLndyaXRlRjMyKG9iamVjdCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy53cml0ZVU4KDB4Y2IpOwogICAgICAgICAgICB0aGlzLndyaXRlRjY0KG9iamVjdCk7CiAgICAgICAgfQogICAgfQogICAgZW5jb2RlQmlnSW50NjQob2JqZWN0KSB7CiAgICAgICAgaWYgKG9iamVjdCA+PSBCaWdJbnQoMCkpIHsKICAgICAgICAgICAgdGhpcy53cml0ZVU4KDB4Y2YpOwogICAgICAgICAgICB0aGlzLndyaXRlQmlnVWludDY0KG9iamVjdCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy53cml0ZVU4KDB4ZDMpOwogICAgICAgICAgICB0aGlzLndyaXRlQmlnSW50NjQob2JqZWN0KTsKICAgICAgICB9CiAgICB9CiAgICB3cml0ZVN0cmluZ0hlYWRlcihieXRlTGVuZ3RoKSB7CiAgICAgICAgaWYgKGJ5dGVMZW5ndGggPCAzMikgewogICAgICAgICAgICB0aGlzLndyaXRlVTgoMHhhMCArIGJ5dGVMZW5ndGgpOwogICAgICAgIH0gZWxzZSBpZiAoYnl0ZUxlbmd0aCA8IDB4MTAwKSB7CiAgICAgICAgICAgIHRoaXMud3JpdGVVOCgweGQ5KTsKICAgICAgICAgICAgdGhpcy53cml0ZVU4KGJ5dGVMZW5ndGgpOwogICAgICAgIH0gZWxzZSBpZiAoYnl0ZUxlbmd0aCA8IDB4MTAwMDApIHsKICAgICAgICAgICAgdGhpcy53cml0ZVU4KDB4ZGEpOwogICAgICAgICAgICB0aGlzLndyaXRlVTE2KGJ5dGVMZW5ndGgpOwogICAgICAgIH0gZWxzZSBpZiAoYnl0ZUxlbmd0aCA8IDB4MTAwMDAwMDAwKSB7CiAgICAgICAgICAgIHRoaXMud3JpdGVVOCgweGRiKTsKICAgICAgICAgICAgdGhpcy53cml0ZVUzMihieXRlTGVuZ3RoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFRvbyBsb25nIHN0cmluZzogJHtieXRlTGVuZ3RofSBieXRlcyBpbiBVVEYtOGApOwogICAgICAgIH0KICAgIH0KICAgIGVuY29kZVN0cmluZyhvYmplY3QpIHsKICAgICAgICBjb25zdCBtYXhIZWFkZXJTaXplID0gMSArIDQ7CiAgICAgICAgY29uc3QgYnl0ZUxlbmd0aCA9IHV0ZjhDb3VudChvYmplY3QpOwogICAgICAgIHRoaXMuZW5zdXJlQnVmZmVyU2l6ZVRvV3JpdGUobWF4SGVhZGVyU2l6ZSArIGJ5dGVMZW5ndGgpOwogICAgICAgIHRoaXMud3JpdGVTdHJpbmdIZWFkZXIoYnl0ZUxlbmd0aCk7CiAgICAgICAgdXRmOEVuY29kZShvYmplY3QsIHRoaXMuYnl0ZXMsIHRoaXMucG9zKTsKICAgICAgICB0aGlzLnBvcyArPSBieXRlTGVuZ3RoOwogICAgfQogICAgZW5jb2RlT2JqZWN0KG9iamVjdCwgZGVwdGgpIHsKICAgICAgICBjb25zdCBleHQgPSB0aGlzLmV4dGVuc2lvbkNvZGVjLnRyeVRvRW5jb2RlKG9iamVjdCwgdGhpcy5jb250ZXh0KTsKICAgICAgICBpZiAoZXh0ICE9IG51bGwpIHsKICAgICAgICAgICAgdGhpcy5lbmNvZGVFeHRlbnNpb24oZXh0KTsKICAgICAgICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob2JqZWN0KSkgewogICAgICAgICAgICB0aGlzLmVuY29kZUFycmF5KG9iamVjdCwgZGVwdGgpOwogICAgICAgIH0gZWxzZSBpZiAoQXJyYXlCdWZmZXIuaXNWaWV3KG9iamVjdCkpIHsKICAgICAgICAgICAgdGhpcy5lbmNvZGVCaW5hcnkob2JqZWN0KTsKICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBvYmplY3QgPT09ICJvYmplY3QiKSB7CiAgICAgICAgICAgIHRoaXMuZW5jb2RlTWFwKG9iamVjdCwgZGVwdGgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgVW5yZWNvZ25pemVkIG9iamVjdDogJHtPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmFwcGx5KG9iamVjdCl9YCk7CiAgICAgICAgfQogICAgfQogICAgZW5jb2RlQmluYXJ5KG9iamVjdCkgewogICAgICAgIGNvbnN0IHNpemUgPSBvYmplY3QuYnl0ZUxlbmd0aDsKICAgICAgICBpZiAoc2l6ZSA8IDB4MTAwKSB7CiAgICAgICAgICAgIHRoaXMud3JpdGVVOCgweGM0KTsKICAgICAgICAgICAgdGhpcy53cml0ZVU4KHNpemUpOwogICAgICAgIH0gZWxzZSBpZiAoc2l6ZSA8IDB4MTAwMDApIHsKICAgICAgICAgICAgdGhpcy53cml0ZVU4KDB4YzUpOwogICAgICAgICAgICB0aGlzLndyaXRlVTE2KHNpemUpOwogICAgICAgIH0gZWxzZSBpZiAoc2l6ZSA8IDB4MTAwMDAwMDAwKSB7CiAgICAgICAgICAgIHRoaXMud3JpdGVVOCgweGM2KTsKICAgICAgICAgICAgdGhpcy53cml0ZVUzMihzaXplKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFRvbyBsYXJnZSBiaW5hcnk6ICR7c2l6ZX1gKTsKICAgICAgICB9CiAgICAgICAgY29uc3QgYnl0ZXMgPSBlbnN1cmVVaW50OEFycmF5KG9iamVjdCk7CiAgICAgICAgdGhpcy53cml0ZVU4YShieXRlcyk7CiAgICB9CiAgICBlbmNvZGVBcnJheShvYmplY3QsIGRlcHRoKSB7CiAgICAgICAgY29uc3Qgc2l6ZSA9IG9iamVjdC5sZW5ndGg7CiAgICAgICAgaWYgKHNpemUgPCAxNikgewogICAgICAgICAgICB0aGlzLndyaXRlVTgoMHg5MCArIHNpemUpOwogICAgICAgIH0gZWxzZSBpZiAoc2l6ZSA8IDB4MTAwMDApIHsKICAgICAgICAgICAgdGhpcy53cml0ZVU4KDB4ZGMpOwogICAgICAgICAgICB0aGlzLndyaXRlVTE2KHNpemUpOwogICAgICAgIH0gZWxzZSBpZiAoc2l6ZSA8IDB4MTAwMDAwMDAwKSB7CiAgICAgICAgICAgIHRoaXMud3JpdGVVOCgweGRkKTsKICAgICAgICAgICAgdGhpcy53cml0ZVUzMihzaXplKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFRvbyBsYXJnZSBhcnJheTogJHtzaXplfWApOwogICAgICAgIH0KICAgICAgICBmb3IgKGNvbnN0IGl0ZW0gb2Ygb2JqZWN0KXsKICAgICAgICAgICAgdGhpcy5kb0VuY29kZShpdGVtLCBkZXB0aCArIDEpOwogICAgICAgIH0KICAgIH0KICAgIGNvdW50V2l0aG91dFVuZGVmaW5lZChvYmplY3QsIGtleXMpIHsKICAgICAgICBsZXQgY291bnQgPSAwOwogICAgICAgIGZvciAoY29uc3Qga2V5IG9mIGtleXMpewogICAgICAgICAgICBpZiAob2JqZWN0W2tleV0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgY291bnQrKzsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gY291bnQ7CiAgICB9CiAgICBlbmNvZGVNYXAob2JqZWN0LCBkZXB0aCkgewogICAgICAgIGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyhvYmplY3QpOwogICAgICAgIGlmICh0aGlzLnNvcnRLZXlzKSB7CiAgICAgICAgICAgIGtleXMuc29ydCgpOwogICAgICAgIH0KICAgICAgICBjb25zdCBzaXplID0gdGhpcy5pZ25vcmVVbmRlZmluZWQgPyB0aGlzLmNvdW50V2l0aG91dFVuZGVmaW5lZChvYmplY3QsIGtleXMpIDoga2V5cy5sZW5ndGg7CiAgICAgICAgaWYgKHNpemUgPCAxNikgewogICAgICAgICAgICB0aGlzLndyaXRlVTgoMHg4MCArIHNpemUpOwogICAgICAgIH0gZWxzZSBpZiAoc2l6ZSA8IDB4MTAwMDApIHsKICAgICAgICAgICAgdGhpcy53cml0ZVU4KDB4ZGUpOwogICAgICAgICAgICB0aGlzLndyaXRlVTE2KHNpemUpOwogICAgICAgIH0gZWxzZSBpZiAoc2l6ZSA8IDB4MTAwMDAwMDAwKSB7CiAgICAgICAgICAgIHRoaXMud3JpdGVVOCgweGRmKTsKICAgICAgICAgICAgdGhpcy53cml0ZVUzMihzaXplKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFRvbyBsYXJnZSBtYXAgb2JqZWN0OiAke3NpemV9YCk7CiAgICAgICAgfQogICAgICAgIGZvciAoY29uc3Qga2V5IG9mIGtleXMpewogICAgICAgICAgICBjb25zdCB2YWx1ZSA9IG9iamVjdFtrZXldOwogICAgICAgICAgICBpZiAoISh0aGlzLmlnbm9yZVVuZGVmaW5lZCAmJiB2YWx1ZSA9PT0gdW5kZWZpbmVkKSkgewogICAgICAgICAgICAgICAgdGhpcy5lbmNvZGVTdHJpbmcoa2V5KTsKICAgICAgICAgICAgICAgIHRoaXMuZG9FbmNvZGUodmFsdWUsIGRlcHRoICsgMSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBlbmNvZGVFeHRlbnNpb24oZXh0KSB7CiAgICAgICAgaWYgKHR5cGVvZiBleHQuZGF0YSA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICBjb25zdCBkYXRhID0gZXh0LmRhdGEodGhpcy5wb3MgKyA2KTsKICAgICAgICAgICAgY29uc3Qgc2l6ZSA9IGRhdGEubGVuZ3RoOwogICAgICAgICAgICBpZiAoc2l6ZSA+PSAweDEwMDAwMDAwMCkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBUb28gbGFyZ2UgZXh0ZW5zaW9uIG9iamVjdDogJHtzaXplfWApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMud3JpdGVVOCgweGM5KTsKICAgICAgICAgICAgdGhpcy53cml0ZVUzMihzaXplKTsKICAgICAgICAgICAgdGhpcy53cml0ZUk4KGV4dC50eXBlKTsKICAgICAgICAgICAgdGhpcy53cml0ZVU4YShkYXRhKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBjb25zdCBzaXplID0gZXh0LmRhdGEubGVuZ3RoOwogICAgICAgIGlmIChzaXplID09PSAxKSB7CiAgICAgICAgICAgIHRoaXMud3JpdGVVOCgweGQ0KTsKICAgICAgICB9IGVsc2UgaWYgKHNpemUgPT09IDIpIHsKICAgICAgICAgICAgdGhpcy53cml0ZVU4KDB4ZDUpOwogICAgICAgIH0gZWxzZSBpZiAoc2l6ZSA9PT0gNCkgewogICAgICAgICAgICB0aGlzLndyaXRlVTgoMHhkNik7CiAgICAgICAgfSBlbHNlIGlmIChzaXplID09PSA4KSB7CiAgICAgICAgICAgIHRoaXMud3JpdGVVOCgweGQ3KTsKICAgICAgICB9IGVsc2UgaWYgKHNpemUgPT09IDE2KSB7CiAgICAgICAgICAgIHRoaXMud3JpdGVVOCgweGQ4KTsKICAgICAgICB9IGVsc2UgaWYgKHNpemUgPCAweDEwMCkgewogICAgICAgICAgICB0aGlzLndyaXRlVTgoMHhjNyk7CiAgICAgICAgICAgIHRoaXMud3JpdGVVOChzaXplKTsKICAgICAgICB9IGVsc2UgaWYgKHNpemUgPCAweDEwMDAwKSB7CiAgICAgICAgICAgIHRoaXMud3JpdGVVOCgweGM4KTsKICAgICAgICAgICAgdGhpcy53cml0ZVUxNihzaXplKTsKICAgICAgICB9IGVsc2UgaWYgKHNpemUgPCAweDEwMDAwMDAwMCkgewogICAgICAgICAgICB0aGlzLndyaXRlVTgoMHhjOSk7CiAgICAgICAgICAgIHRoaXMud3JpdGVVMzIoc2l6ZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBUb28gbGFyZ2UgZXh0ZW5zaW9uIG9iamVjdDogJHtzaXplfWApOwogICAgICAgIH0KICAgICAgICB0aGlzLndyaXRlSTgoZXh0LnR5cGUpOwogICAgICAgIHRoaXMud3JpdGVVOGEoZXh0LmRhdGEpOwogICAgfQogICAgd3JpdGVVOCh2YWx1ZSkgewogICAgICAgIHRoaXMuZW5zdXJlQnVmZmVyU2l6ZVRvV3JpdGUoMSk7CiAgICAgICAgdGhpcy52aWV3LnNldFVpbnQ4KHRoaXMucG9zLCB2YWx1ZSk7CiAgICAgICAgdGhpcy5wb3MrKzsKICAgIH0KICAgIHdyaXRlVThhKHZhbHVlcykgewogICAgICAgIGNvbnN0IHNpemUgPSB2YWx1ZXMubGVuZ3RoOwogICAgICAgIHRoaXMuZW5zdXJlQnVmZmVyU2l6ZVRvV3JpdGUoc2l6ZSk7CiAgICAgICAgdGhpcy5ieXRlcy5zZXQodmFsdWVzLCB0aGlzLnBvcyk7CiAgICAgICAgdGhpcy5wb3MgKz0gc2l6ZTsKICAgIH0KICAgIHdyaXRlSTgodmFsdWUpIHsKICAgICAgICB0aGlzLmVuc3VyZUJ1ZmZlclNpemVUb1dyaXRlKDEpOwogICAgICAgIHRoaXMudmlldy5zZXRJbnQ4KHRoaXMucG9zLCB2YWx1ZSk7CiAgICAgICAgdGhpcy5wb3MrKzsKICAgIH0KICAgIHdyaXRlVTE2KHZhbHVlKSB7CiAgICAgICAgdGhpcy5lbnN1cmVCdWZmZXJTaXplVG9Xcml0ZSgyKTsKICAgICAgICB0aGlzLnZpZXcuc2V0VWludDE2KHRoaXMucG9zLCB2YWx1ZSk7CiAgICAgICAgdGhpcy5wb3MgKz0gMjsKICAgIH0KICAgIHdyaXRlSTE2KHZhbHVlKSB7CiAgICAgICAgdGhpcy5lbnN1cmVCdWZmZXJTaXplVG9Xcml0ZSgyKTsKICAgICAgICB0aGlzLnZpZXcuc2V0SW50MTYodGhpcy5wb3MsIHZhbHVlKTsKICAgICAgICB0aGlzLnBvcyArPSAyOwogICAgfQogICAgd3JpdGVVMzIodmFsdWUpIHsKICAgICAgICB0aGlzLmVuc3VyZUJ1ZmZlclNpemVUb1dyaXRlKDQpOwogICAgICAgIHRoaXMudmlldy5zZXRVaW50MzIodGhpcy5wb3MsIHZhbHVlKTsKICAgICAgICB0aGlzLnBvcyArPSA0OwogICAgfQogICAgd3JpdGVJMzIodmFsdWUpIHsKICAgICAgICB0aGlzLmVuc3VyZUJ1ZmZlclNpemVUb1dyaXRlKDQpOwogICAgICAgIHRoaXMudmlldy5zZXRJbnQzMih0aGlzLnBvcywgdmFsdWUpOwogICAgICAgIHRoaXMucG9zICs9IDQ7CiAgICB9CiAgICB3cml0ZUYzMih2YWx1ZSkgewogICAgICAgIHRoaXMuZW5zdXJlQnVmZmVyU2l6ZVRvV3JpdGUoNCk7CiAgICAgICAgdGhpcy52aWV3LnNldEZsb2F0MzIodGhpcy5wb3MsIHZhbHVlKTsKICAgICAgICB0aGlzLnBvcyArPSA0OwogICAgfQogICAgd3JpdGVGNjQodmFsdWUpIHsKICAgICAgICB0aGlzLmVuc3VyZUJ1ZmZlclNpemVUb1dyaXRlKDgpOwogICAgICAgIHRoaXMudmlldy5zZXRGbG9hdDY0KHRoaXMucG9zLCB2YWx1ZSk7CiAgICAgICAgdGhpcy5wb3MgKz0gODsKICAgIH0KICAgIHdyaXRlVTY0KHZhbHVlKSB7CiAgICAgICAgdGhpcy5lbnN1cmVCdWZmZXJTaXplVG9Xcml0ZSg4KTsKICAgICAgICBzZXRVaW50NjQodGhpcy52aWV3LCB0aGlzLnBvcywgdmFsdWUpOwogICAgICAgIHRoaXMucG9zICs9IDg7CiAgICB9CiAgICB3cml0ZUk2NCh2YWx1ZSkgewogICAgICAgIHRoaXMuZW5zdXJlQnVmZmVyU2l6ZVRvV3JpdGUoOCk7CiAgICAgICAgc2V0SW50NjQodGhpcy52aWV3LCB0aGlzLnBvcywgdmFsdWUpOwogICAgICAgIHRoaXMucG9zICs9IDg7CiAgICB9CiAgICB3cml0ZUJpZ1VpbnQ2NCh2YWx1ZSkgewogICAgICAgIHRoaXMuZW5zdXJlQnVmZmVyU2l6ZVRvV3JpdGUoOCk7CiAgICAgICAgdGhpcy52aWV3LnNldEJpZ1VpbnQ2NCh0aGlzLnBvcywgdmFsdWUpOwogICAgICAgIHRoaXMucG9zICs9IDg7CiAgICB9CiAgICB3cml0ZUJpZ0ludDY0KHZhbHVlKSB7CiAgICAgICAgdGhpcy5lbnN1cmVCdWZmZXJTaXplVG9Xcml0ZSg4KTsKICAgICAgICB0aGlzLnZpZXcuc2V0QmlnSW50NjQodGhpcy5wb3MsIHZhbHVlKTsKICAgICAgICB0aGlzLnBvcyArPSA4OwogICAgfQp9CmZ1bmN0aW9uIGVuY29kZSh2YWx1ZSwgb3B0aW9ucykgewogICAgY29uc3QgZW5jb2RlciA9IG5ldyBFbmNvZGVyKG9wdGlvbnMpOwogICAgcmV0dXJuIGVuY29kZXIuZW5jb2RlU2hhcmVkUmVmKHZhbHVlKTsKfQpmdW5jdGlvbiBwcmV0dHlCeXRlKF9fYnl0ZSkgewogICAgcmV0dXJuIGAke19fYnl0ZSA8IDAgPyAiLSIgOiAiIn0weCR7TWF0aC5hYnMoX19ieXRlKS50b1N0cmluZygxNikucGFkU3RhcnQoMiwgIjAiKX1gOwp9CmNsYXNzIENhY2hlZEtleURlY29kZXIgewogICAgY29uc3RydWN0b3IobWF4S2V5TGVuZ3RoID0gMTYsIG1heExlbmd0aFBlcktleSA9IDE2KXsKICAgICAgICB0aGlzLmhpdCA9IDA7CiAgICAgICAgdGhpcy5taXNzID0gMDsKICAgICAgICB0aGlzLm1heEtleUxlbmd0aCA9IG1heEtleUxlbmd0aDsKICAgICAgICB0aGlzLm1heExlbmd0aFBlcktleSA9IG1heExlbmd0aFBlcktleTsKICAgICAgICB0aGlzLmNhY2hlcyA9IFtdOwogICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCB0aGlzLm1heEtleUxlbmd0aDsgaSsrKXsKICAgICAgICAgICAgdGhpcy5jYWNoZXMucHVzaChbXSk7CiAgICAgICAgfQogICAgfQogICAgY2FuQmVDYWNoZWQoYnl0ZUxlbmd0aCkgewogICAgICAgIHJldHVybiBieXRlTGVuZ3RoID4gMCAmJiBieXRlTGVuZ3RoIDw9IHRoaXMubWF4S2V5TGVuZ3RoOwogICAgfQogICAgZmluZChieXRlcywgaW5wdXRPZmZzZXQsIGJ5dGVMZW5ndGgpIHsKICAgICAgICBjb25zdCByZWNvcmRzID0gdGhpcy5jYWNoZXNbYnl0ZUxlbmd0aCAtIDFdOwogICAgICAgIEZJTkRfQ0hVTks6IGZvciAoY29uc3QgcmVjb3JkIG9mIHJlY29yZHMpewogICAgICAgICAgICBjb25zdCByZWNvcmRCeXRlcyA9IHJlY29yZC5ieXRlczsKICAgICAgICAgICAgZm9yKGxldCBqID0gMDsgaiA8IGJ5dGVMZW5ndGg7IGorKyl7CiAgICAgICAgICAgICAgICBpZiAocmVjb3JkQnl0ZXNbal0gIT09IGJ5dGVzW2lucHV0T2Zmc2V0ICsgal0pIHsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZSBGSU5EX0NIVU5LOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiByZWNvcmQuc3RyOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIHN0b3JlKGJ5dGVzLCB2YWx1ZSkgewogICAgICAgIGNvbnN0IHJlY29yZHMgPSB0aGlzLmNhY2hlc1tieXRlcy5sZW5ndGggLSAxXTsKICAgICAgICBjb25zdCByZWNvcmQgPSB7CiAgICAgICAgICAgIGJ5dGVzLAogICAgICAgICAgICBzdHI6IHZhbHVlCiAgICAgICAgfTsKICAgICAgICBpZiAocmVjb3Jkcy5sZW5ndGggPj0gdGhpcy5tYXhMZW5ndGhQZXJLZXkpIHsKICAgICAgICAgICAgcmVjb3Jkc1tNYXRoLnJhbmRvbSgpICogcmVjb3Jkcy5sZW5ndGggfCAwXSA9IHJlY29yZDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZWNvcmRzLnB1c2gocmVjb3JkKTsKICAgICAgICB9CiAgICB9CiAgICBkZWNvZGUoYnl0ZXMsIGlucHV0T2Zmc2V0LCBieXRlTGVuZ3RoKSB7CiAgICAgICAgY29uc3QgY2FjaGVkVmFsdWUgPSB0aGlzLmZpbmQoYnl0ZXMsIGlucHV0T2Zmc2V0LCBieXRlTGVuZ3RoKTsKICAgICAgICBpZiAoY2FjaGVkVmFsdWUgIT0gbnVsbCkgewogICAgICAgICAgICB0aGlzLmhpdCsrOwogICAgICAgICAgICByZXR1cm4gY2FjaGVkVmFsdWU7CiAgICAgICAgfQogICAgICAgIHRoaXMubWlzcysrOwogICAgICAgIGNvbnN0IHN0ciA9IHV0ZjhEZWNvZGVKcyhieXRlcywgaW5wdXRPZmZzZXQsIGJ5dGVMZW5ndGgpOwogICAgICAgIGNvbnN0IHNsaWNlZENvcHlPZkJ5dGVzID0gVWludDhBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChieXRlcywgaW5wdXRPZmZzZXQsIGlucHV0T2Zmc2V0ICsgYnl0ZUxlbmd0aCk7CiAgICAgICAgdGhpcy5zdG9yZShzbGljZWRDb3B5T2ZCeXRlcywgc3RyKTsKICAgICAgICByZXR1cm4gc3RyOwogICAgfQp9CmNvbnN0IFNUQVRFX0FSUkFZID0gImFycmF5IjsKY29uc3QgU1RBVEVfTUFQX0tFWSA9ICJtYXBfa2V5IjsKY29uc3QgU1RBVEVfTUFQX1ZBTFVFID0gIm1hcF92YWx1ZSI7CmNvbnN0IG1hcEtleUNvbnZlcnRlciA9IChrZXkpPT57CiAgICBpZiAodHlwZW9mIGtleSA9PT0gInN0cmluZyIgfHwgdHlwZW9mIGtleSA9PT0gIm51bWJlciIpIHsKICAgICAgICByZXR1cm4ga2V5OwogICAgfQogICAgdGhyb3cgbmV3IERlY29kZUVycm9yKCJUaGUgdHlwZSBvZiBrZXkgbXVzdCBiZSBzdHJpbmcgb3IgbnVtYmVyIGJ1dCAiICsgdHlwZW9mIGtleSk7Cn07CmNsYXNzIFN0YWNrUG9vbCB7CiAgICBjb25zdHJ1Y3RvcigpewogICAgICAgIHRoaXMuc3RhY2sgPSBbXTsKICAgICAgICB0aGlzLnN0YWNrSGVhZFBvc2l0aW9uID0gLTE7CiAgICB9CiAgICBnZXQgbGVuZ3RoKCkgewogICAgICAgIHJldHVybiB0aGlzLnN0YWNrSGVhZFBvc2l0aW9uICsgMTsKICAgIH0KICAgIHRvcCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5zdGFja1t0aGlzLnN0YWNrSGVhZFBvc2l0aW9uXTsKICAgIH0KICAgIHB1c2hBcnJheVN0YXRlKHNpemUpIHsKICAgICAgICBjb25zdCBzdGF0ZSA9IHRoaXMuZ2V0VW5pbml0aWFsaXplZFN0YXRlRnJvbVBvb2woKTsKICAgICAgICBzdGF0ZS50eXBlID0gU1RBVEVfQVJSQVk7CiAgICAgICAgc3RhdGUucG9zaXRpb24gPSAwOwogICAgICAgIHN0YXRlLnNpemUgPSBzaXplOwogICAgICAgIHN0YXRlLmFycmF5ID0gbmV3IEFycmF5KHNpemUpOwogICAgfQogICAgcHVzaE1hcFN0YXRlKHNpemUpIHsKICAgICAgICBjb25zdCBzdGF0ZSA9IHRoaXMuZ2V0VW5pbml0aWFsaXplZFN0YXRlRnJvbVBvb2woKTsKICAgICAgICBzdGF0ZS50eXBlID0gU1RBVEVfTUFQX0tFWTsKICAgICAgICBzdGF0ZS5yZWFkQ291bnQgPSAwOwogICAgICAgIHN0YXRlLnNpemUgPSBzaXplOwogICAgICAgIHN0YXRlLm1hcCA9IHt9OwogICAgfQogICAgZ2V0VW5pbml0aWFsaXplZFN0YXRlRnJvbVBvb2woKSB7CiAgICAgICAgdGhpcy5zdGFja0hlYWRQb3NpdGlvbisrOwogICAgICAgIGlmICh0aGlzLnN0YWNrSGVhZFBvc2l0aW9uID09PSB0aGlzLnN0YWNrLmxlbmd0aCkgewogICAgICAgICAgICBjb25zdCBwYXJ0aWFsU3RhdGUgPSB7CiAgICAgICAgICAgICAgICB0eXBlOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICBzaXplOiAwLAogICAgICAgICAgICAgICAgYXJyYXk6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAwLAogICAgICAgICAgICAgICAgcmVhZENvdW50OiAwLAogICAgICAgICAgICAgICAgbWFwOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICBrZXk6IG51bGwKICAgICAgICAgICAgfTsKICAgICAgICAgICAgdGhpcy5zdGFjay5wdXNoKHBhcnRpYWxTdGF0ZSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzLnN0YWNrW3RoaXMuc3RhY2tIZWFkUG9zaXRpb25dOwogICAgfQogICAgcmVsZWFzZShzdGF0ZSkgewogICAgICAgIGNvbnN0IHRvcFN0YWNrU3RhdGUgPSB0aGlzLnN0YWNrW3RoaXMuc3RhY2tIZWFkUG9zaXRpb25dOwogICAgICAgIGlmICh0b3BTdGFja1N0YXRlICE9PSBzdGF0ZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgc3RhY2sgc3RhdGUuIFJlbGVhc2VkIHN0YXRlIGlzIG5vdCBvbiB0b3Agb2YgdGhlIHN0YWNrLiIpOwogICAgICAgIH0KICAgICAgICBpZiAoc3RhdGUudHlwZSA9PT0gU1RBVEVfQVJSQVkpIHsKICAgICAgICAgICAgY29uc3QgcGFydGlhbFN0YXRlID0gc3RhdGU7CiAgICAgICAgICAgIHBhcnRpYWxTdGF0ZS5zaXplID0gMDsKICAgICAgICAgICAgcGFydGlhbFN0YXRlLmFycmF5ID0gdW5kZWZpbmVkOwogICAgICAgICAgICBwYXJ0aWFsU3RhdGUucG9zaXRpb24gPSAwOwogICAgICAgICAgICBwYXJ0aWFsU3RhdGUudHlwZSA9IHVuZGVmaW5lZDsKICAgICAgICB9CiAgICAgICAgaWYgKHN0YXRlLnR5cGUgPT09IFNUQVRFX01BUF9LRVkgfHwgc3RhdGUudHlwZSA9PT0gU1RBVEVfTUFQX1ZBTFVFKSB7CiAgICAgICAgICAgIGNvbnN0IHBhcnRpYWxTdGF0ZSA9IHN0YXRlOwogICAgICAgICAgICBwYXJ0aWFsU3RhdGUuc2l6ZSA9IDA7CiAgICAgICAgICAgIHBhcnRpYWxTdGF0ZS5tYXAgPSB1bmRlZmluZWQ7CiAgICAgICAgICAgIHBhcnRpYWxTdGF0ZS5yZWFkQ291bnQgPSAwOwogICAgICAgICAgICBwYXJ0aWFsU3RhdGUudHlwZSA9IHVuZGVmaW5lZDsKICAgICAgICB9CiAgICAgICAgdGhpcy5zdGFja0hlYWRQb3NpdGlvbi0tOwogICAgfQogICAgcmVzZXQoKSB7CiAgICAgICAgdGhpcy5zdGFjay5sZW5ndGggPSAwOwogICAgICAgIHRoaXMuc3RhY2tIZWFkUG9zaXRpb24gPSAtMTsKICAgIH0KfQpjb25zdCBIRUFEX0JZVEVfUkVRVUlSRUQgPSAtMTsKY29uc3QgRU1QVFlfVklFVyA9IG5ldyBEYXRhVmlldyhuZXcgQXJyYXlCdWZmZXIoMCkpOwpjb25zdCBFTVBUWV9CWVRFUyA9IG5ldyBVaW50OEFycmF5KEVNUFRZX1ZJRVcuYnVmZmVyKTsKdHJ5IHsKICAgIEVNUFRZX1ZJRVcuZ2V0SW50OCgwKTsKfSBjYXRjaCAoZSkgewogICAgaWYgKCEoZSBpbnN0YW5jZW9mIFJhbmdlRXJyb3IpKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJUaGlzIG1vZHVsZSBpcyBub3Qgc3VwcG9ydGVkIGluIHRoZSBjdXJyZW50IEphdmFTY3JpcHQgZW5naW5lIGJlY2F1c2UgRGF0YVZpZXcgZG9lcyBub3QgdGhyb3cgUmFuZ2VFcnJvciBvbiBvdXQtb2YtYm91bmRzIGFjY2VzcyIpOwogICAgfQp9CmNvbnN0IE1PUkVfREFUQSA9IG5ldyBSYW5nZUVycm9yKCJJbnN1ZmZpY2llbnQgZGF0YSIpOwpjb25zdCBzaGFyZWRDYWNoZWRLZXlEZWNvZGVyID0gbmV3IENhY2hlZEtleURlY29kZXIoKTsKY2xhc3MgRGVjb2RlciB7CiAgICBjb25zdHJ1Y3RvcihvcHRpb25zKXsKICAgICAgICB0aGlzLnRvdGFsUG9zID0gMDsKICAgICAgICB0aGlzLnBvcyA9IDA7CiAgICAgICAgdGhpcy52aWV3ID0gRU1QVFlfVklFVzsKICAgICAgICB0aGlzLmJ5dGVzID0gRU1QVFlfQllURVM7CiAgICAgICAgdGhpcy5oZWFkQnl0ZSA9IEhFQURfQllURV9SRVFVSVJFRDsKICAgICAgICB0aGlzLnN0YWNrID0gbmV3IFN0YWNrUG9vbCgpOwogICAgICAgIHRoaXMuZW50ZXJlZCA9IGZhbHNlOwogICAgICAgIHRoaXMuZXh0ZW5zaW9uQ29kZWMgPSBvcHRpb25zPy5leHRlbnNpb25Db2RlYyA/PyBFeHRlbnNpb25Db2RlYy5kZWZhdWx0Q29kZWM7CiAgICAgICAgdGhpcy5jb250ZXh0ID0gb3B0aW9ucz8uY29udGV4dDsKICAgICAgICB0aGlzLnVzZUJpZ0ludDY0ID0gb3B0aW9ucz8udXNlQmlnSW50NjQgPz8gZmFsc2U7CiAgICAgICAgdGhpcy5yYXdTdHJpbmdzID0gb3B0aW9ucz8ucmF3U3RyaW5ncyA/PyBmYWxzZTsKICAgICAgICB0aGlzLm1heFN0ckxlbmd0aCA9IG9wdGlvbnM/Lm1heFN0ckxlbmd0aCA/PyBVSU5UMzJfTUFYOwogICAgICAgIHRoaXMubWF4QmluTGVuZ3RoID0gb3B0aW9ucz8ubWF4QmluTGVuZ3RoID8/IFVJTlQzMl9NQVg7CiAgICAgICAgdGhpcy5tYXhBcnJheUxlbmd0aCA9IG9wdGlvbnM/Lm1heEFycmF5TGVuZ3RoID8/IFVJTlQzMl9NQVg7CiAgICAgICAgdGhpcy5tYXhNYXBMZW5ndGggPSBvcHRpb25zPy5tYXhNYXBMZW5ndGggPz8gVUlOVDMyX01BWDsKICAgICAgICB0aGlzLm1heEV4dExlbmd0aCA9IG9wdGlvbnM/Lm1heEV4dExlbmd0aCA/PyBVSU5UMzJfTUFYOwogICAgICAgIHRoaXMua2V5RGVjb2RlciA9IG9wdGlvbnM/LmtleURlY29kZXIgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMua2V5RGVjb2RlciA6IHNoYXJlZENhY2hlZEtleURlY29kZXI7CiAgICAgICAgdGhpcy5tYXBLZXlDb252ZXJ0ZXIgPSBvcHRpb25zPy5tYXBLZXlDb252ZXJ0ZXIgPz8gbWFwS2V5Q29udmVydGVyOwogICAgfQogICAgY2xvbmUoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBEZWNvZGVyKHsKICAgICAgICAgICAgZXh0ZW5zaW9uQ29kZWM6IHRoaXMuZXh0ZW5zaW9uQ29kZWMsCiAgICAgICAgICAgIGNvbnRleHQ6IHRoaXMuY29udGV4dCwKICAgICAgICAgICAgdXNlQmlnSW50NjQ6IHRoaXMudXNlQmlnSW50NjQsCiAgICAgICAgICAgIHJhd1N0cmluZ3M6IHRoaXMucmF3U3RyaW5ncywKICAgICAgICAgICAgbWF4U3RyTGVuZ3RoOiB0aGlzLm1heFN0ckxlbmd0aCwKICAgICAgICAgICAgbWF4QmluTGVuZ3RoOiB0aGlzLm1heEJpbkxlbmd0aCwKICAgICAgICAgICAgbWF4QXJyYXlMZW5ndGg6IHRoaXMubWF4QXJyYXlMZW5ndGgsCiAgICAgICAgICAgIG1heE1hcExlbmd0aDogdGhpcy5tYXhNYXBMZW5ndGgsCiAgICAgICAgICAgIG1heEV4dExlbmd0aDogdGhpcy5tYXhFeHRMZW5ndGgsCiAgICAgICAgICAgIGtleURlY29kZXI6IHRoaXMua2V5RGVjb2RlcgogICAgICAgIH0pOwogICAgfQogICAgcmVpbml0aWFsaXplU3RhdGUoKSB7CiAgICAgICAgdGhpcy50b3RhbFBvcyA9IDA7CiAgICAgICAgdGhpcy5oZWFkQnl0ZSA9IEhFQURfQllURV9SRVFVSVJFRDsKICAgICAgICB0aGlzLnN0YWNrLnJlc2V0KCk7CiAgICB9CiAgICBzZXRCdWZmZXIoYnVmZmVyKSB7CiAgICAgICAgY29uc3QgYnl0ZXMgPSBlbnN1cmVVaW50OEFycmF5KGJ1ZmZlcik7CiAgICAgICAgdGhpcy5ieXRlcyA9IGJ5dGVzOwogICAgICAgIHRoaXMudmlldyA9IG5ldyBEYXRhVmlldyhieXRlcy5idWZmZXIsIGJ5dGVzLmJ5dGVPZmZzZXQsIGJ5dGVzLmJ5dGVMZW5ndGgpOwogICAgICAgIHRoaXMucG9zID0gMDsKICAgIH0KICAgIGFwcGVuZEJ1ZmZlcihidWZmZXIpIHsKICAgICAgICBpZiAodGhpcy5oZWFkQnl0ZSA9PT0gSEVBRF9CWVRFX1JFUVVJUkVEICYmICF0aGlzLmhhc1JlbWFpbmluZygxKSkgewogICAgICAgICAgICB0aGlzLnNldEJ1ZmZlcihidWZmZXIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbnN0IHJlbWFpbmluZ0RhdGEgPSB0aGlzLmJ5dGVzLnN1YmFycmF5KHRoaXMucG9zKTsKICAgICAgICAgICAgY29uc3QgbmV3RGF0YSA9IGVuc3VyZVVpbnQ4QXJyYXkoYnVmZmVyKTsKICAgICAgICAgICAgY29uc3QgbmV3QnVmZmVyID0gbmV3IFVpbnQ4QXJyYXkocmVtYWluaW5nRGF0YS5sZW5ndGggKyBuZXdEYXRhLmxlbmd0aCk7CiAgICAgICAgICAgIG5ld0J1ZmZlci5zZXQocmVtYWluaW5nRGF0YSk7CiAgICAgICAgICAgIG5ld0J1ZmZlci5zZXQobmV3RGF0YSwgcmVtYWluaW5nRGF0YS5sZW5ndGgpOwogICAgICAgICAgICB0aGlzLnNldEJ1ZmZlcihuZXdCdWZmZXIpOwogICAgICAgIH0KICAgIH0KICAgIGhhc1JlbWFpbmluZyhzaXplKSB7CiAgICAgICAgcmV0dXJuIHRoaXMudmlldy5ieXRlTGVuZ3RoIC0gdGhpcy5wb3MgPj0gc2l6ZTsKICAgIH0KICAgIGNyZWF0ZUV4dHJhQnl0ZUVycm9yKHBvc1RvU2hvdykgewogICAgICAgIGNvbnN0IHsgdmlldyAsIHBvcyAgfSA9IHRoaXM7CiAgICAgICAgcmV0dXJuIG5ldyBSYW5nZUVycm9yKGBFeHRyYSAke3ZpZXcuYnl0ZUxlbmd0aCAtIHBvc30gb2YgJHt2aWV3LmJ5dGVMZW5ndGh9IGJ5dGUocykgZm91bmQgYXQgYnVmZmVyWyR7cG9zVG9TaG93fV1gKTsKICAgIH0KICAgIGRlY29kZShidWZmZXIpIHsKICAgICAgICBpZiAodGhpcy5lbnRlcmVkKSB7CiAgICAgICAgICAgIGNvbnN0IGluc3RhbmNlID0gdGhpcy5jbG9uZSgpOwogICAgICAgICAgICByZXR1cm4gaW5zdGFuY2UuZGVjb2RlKGJ1ZmZlcik7CiAgICAgICAgfQogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHRoaXMuZW50ZXJlZCA9IHRydWU7CiAgICAgICAgICAgIHRoaXMucmVpbml0aWFsaXplU3RhdGUoKTsKICAgICAgICAgICAgdGhpcy5zZXRCdWZmZXIoYnVmZmVyKTsKICAgICAgICAgICAgY29uc3Qgb2JqZWN0ID0gdGhpcy5kb0RlY29kZVN5bmMoKTsKICAgICAgICAgICAgaWYgKHRoaXMuaGFzUmVtYWluaW5nKDEpKSB7CiAgICAgICAgICAgICAgICB0aHJvdyB0aGlzLmNyZWF0ZUV4dHJhQnl0ZUVycm9yKHRoaXMucG9zKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gb2JqZWN0OwogICAgICAgIH0gZmluYWxseXsKICAgICAgICAgICAgdGhpcy5lbnRlcmVkID0gZmFsc2U7CiAgICAgICAgfQogICAgfQogICAgKmRlY29kZU11bHRpKGJ1ZmZlcikgewogICAgICAgIGlmICh0aGlzLmVudGVyZWQpIHsKICAgICAgICAgICAgY29uc3QgaW5zdGFuY2UgPSB0aGlzLmNsb25lKCk7CiAgICAgICAgICAgIHlpZWxkKiBpbnN0YW5jZS5kZWNvZGVNdWx0aShidWZmZXIpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHRoaXMuZW50ZXJlZCA9IHRydWU7CiAgICAgICAgICAgIHRoaXMucmVpbml0aWFsaXplU3RhdGUoKTsKICAgICAgICAgICAgdGhpcy5zZXRCdWZmZXIoYnVmZmVyKTsKICAgICAgICAgICAgd2hpbGUodGhpcy5oYXNSZW1haW5pbmcoMSkpewogICAgICAgICAgICAgICAgeWllbGQgdGhpcy5kb0RlY29kZVN5bmMoKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZmluYWxseXsKICAgICAgICAgICAgdGhpcy5lbnRlcmVkID0gZmFsc2U7CiAgICAgICAgfQogICAgfQogICAgYXN5bmMgZGVjb2RlQXN5bmMoc3RyZWFtKSB7CiAgICAgICAgaWYgKHRoaXMuZW50ZXJlZCkgewogICAgICAgICAgICBjb25zdCBpbnN0YW5jZSA9IHRoaXMuY2xvbmUoKTsKICAgICAgICAgICAgcmV0dXJuIGluc3RhbmNlLmRlY29kZUFzeW5jKHN0cmVhbSk7CiAgICAgICAgfQogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHRoaXMuZW50ZXJlZCA9IHRydWU7CiAgICAgICAgICAgIGxldCBkZWNvZGVkID0gZmFsc2U7CiAgICAgICAgICAgIGxldCBvYmplY3Q7CiAgICAgICAgICAgIGZvciBhd2FpdCAoY29uc3QgYnVmZmVyIG9mIHN0cmVhbSl7CiAgICAgICAgICAgICAgICBpZiAoZGVjb2RlZCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuZW50ZXJlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIHRocm93IHRoaXMuY3JlYXRlRXh0cmFCeXRlRXJyb3IodGhpcy50b3RhbFBvcyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLmFwcGVuZEJ1ZmZlcihidWZmZXIpOwogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBvYmplY3QgPSB0aGlzLmRvRGVjb2RlU3luYygpOwogICAgICAgICAgICAgICAgICAgIGRlY29kZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgICAgIGlmICghKGUgaW5zdGFuY2VvZiBSYW5nZUVycm9yKSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMudG90YWxQb3MgKz0gdGhpcy5wb3M7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGRlY29kZWQpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmhhc1JlbWFpbmluZygxKSkgewogICAgICAgICAgICAgICAgICAgIHRocm93IHRoaXMuY3JlYXRlRXh0cmFCeXRlRXJyb3IodGhpcy50b3RhbFBvcyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gb2JqZWN0OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IHsgaGVhZEJ5dGUgLCBwb3MgLCB0b3RhbFBvcyAgfSA9IHRoaXM7CiAgICAgICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKGBJbnN1ZmZpY2llbnQgZGF0YSBpbiBwYXJzaW5nICR7cHJldHR5Qnl0ZShoZWFkQnl0ZSl9IGF0ICR7dG90YWxQb3N9ICgke3Bvc30gaW4gdGhlIGN1cnJlbnQgYnVmZmVyKWApOwogICAgICAgIH0gZmluYWxseXsKICAgICAgICAgICAgdGhpcy5lbnRlcmVkID0gZmFsc2U7CiAgICAgICAgfQogICAgfQogICAgZGVjb2RlQXJyYXlTdHJlYW0oc3RyZWFtKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZGVjb2RlTXVsdGlBc3luYyhzdHJlYW0sIHRydWUpOwogICAgfQogICAgZGVjb2RlU3RyZWFtKHN0cmVhbSkgewogICAgICAgIHJldHVybiB0aGlzLmRlY29kZU11bHRpQXN5bmMoc3RyZWFtLCBmYWxzZSk7CiAgICB9CiAgICBhc3luYyAqZGVjb2RlTXVsdGlBc3luYyhzdHJlYW0sIGlzQXJyYXkpIHsKICAgICAgICBpZiAodGhpcy5lbnRlcmVkKSB7CiAgICAgICAgICAgIGNvbnN0IGluc3RhbmNlID0gdGhpcy5jbG9uZSgpOwogICAgICAgICAgICB5aWVsZCogaW5zdGFuY2UuZGVjb2RlTXVsdGlBc3luYyhzdHJlYW0sIGlzQXJyYXkpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHRoaXMuZW50ZXJlZCA9IHRydWU7CiAgICAgICAgICAgIGxldCBpc0FycmF5SGVhZGVyUmVxdWlyZWQgPSBpc0FycmF5OwogICAgICAgICAgICBsZXQgYXJyYXlJdGVtc0xlZnQgPSAtMTsKICAgICAgICAgICAgZm9yIGF3YWl0IChjb25zdCBidWZmZXIgb2Ygc3RyZWFtKXsKICAgICAgICAgICAgICAgIGlmIChpc0FycmF5ICYmIGFycmF5SXRlbXNMZWZ0ID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgdGhpcy5jcmVhdGVFeHRyYUJ5dGVFcnJvcih0aGlzLnRvdGFsUG9zKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMuYXBwZW5kQnVmZmVyKGJ1ZmZlcik7CiAgICAgICAgICAgICAgICBpZiAoaXNBcnJheUhlYWRlclJlcXVpcmVkKSB7CiAgICAgICAgICAgICAgICAgICAgYXJyYXlJdGVtc0xlZnQgPSB0aGlzLnJlYWRBcnJheVNpemUoKTsKICAgICAgICAgICAgICAgICAgICBpc0FycmF5SGVhZGVyUmVxdWlyZWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbXBsZXRlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIHdoaWxlKHRydWUpewogICAgICAgICAgICAgICAgICAgICAgICB5aWVsZCB0aGlzLmRvRGVjb2RlU3luYygpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoLS1hcnJheUl0ZW1zTGVmdCA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCEoZSBpbnN0YW5jZW9mIFJhbmdlRXJyb3IpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IGU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy50b3RhbFBvcyArPSB0aGlzLnBvczsKICAgICAgICAgICAgfQogICAgICAgIH0gZmluYWxseXsKICAgICAgICAgICAgdGhpcy5lbnRlcmVkID0gZmFsc2U7CiAgICAgICAgfQogICAgfQogICAgZG9EZWNvZGVTeW5jKCkgewogICAgICAgIERFQ09ERTogd2hpbGUodHJ1ZSl7CiAgICAgICAgICAgIGNvbnN0IGhlYWRCeXRlID0gdGhpcy5yZWFkSGVhZEJ5dGUoKTsKICAgICAgICAgICAgbGV0IG9iamVjdDsKICAgICAgICAgICAgaWYgKGhlYWRCeXRlID49IDB4ZTApIHsKICAgICAgICAgICAgICAgIG9iamVjdCA9IGhlYWRCeXRlIC0gMHgxMDA7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoaGVhZEJ5dGUgPCAweGMwKSB7CiAgICAgICAgICAgICAgICBpZiAoaGVhZEJ5dGUgPCAweDgwKSB7CiAgICAgICAgICAgICAgICAgICAgb2JqZWN0ID0gaGVhZEJ5dGU7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGhlYWRCeXRlIDwgMHg5MCkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNpemUgPSBoZWFkQnl0ZSAtIDB4ODA7CiAgICAgICAgICAgICAgICAgICAgaWYgKHNpemUgIT09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wdXNoTWFwU3RhdGUoc2l6ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29tcGxldGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUgREVDT0RFOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdCA9IHt9OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaGVhZEJ5dGUgPCAweGEwKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2l6ZSA9IGhlYWRCeXRlIC0gMHg5MDsKICAgICAgICAgICAgICAgICAgICBpZiAoc2l6ZSAhPT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnB1c2hBcnJheVN0YXRlKHNpemUpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbXBsZXRlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlIERFQ09ERTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QgPSBbXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGJ5dGVMZW5ndGggPSBoZWFkQnl0ZSAtIDB4YTA7CiAgICAgICAgICAgICAgICAgICAgb2JqZWN0ID0gdGhpcy5kZWNvZGVTdHJpbmcoYnl0ZUxlbmd0aCwgMCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAoaGVhZEJ5dGUgPT09IDB4YzApIHsKICAgICAgICAgICAgICAgIG9iamVjdCA9IG51bGw7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoaGVhZEJ5dGUgPT09IDB4YzIpIHsKICAgICAgICAgICAgICAgIG9iamVjdCA9IGZhbHNlOwogICAgICAgICAgICB9IGVsc2UgaWYgKGhlYWRCeXRlID09PSAweGMzKSB7CiAgICAgICAgICAgICAgICBvYmplY3QgPSB0cnVlOwogICAgICAgICAgICB9IGVsc2UgaWYgKGhlYWRCeXRlID09PSAweGNhKSB7CiAgICAgICAgICAgICAgICBvYmplY3QgPSB0aGlzLnJlYWRGMzIoKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChoZWFkQnl0ZSA9PT0gMHhjYikgewogICAgICAgICAgICAgICAgb2JqZWN0ID0gdGhpcy5yZWFkRjY0KCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoaGVhZEJ5dGUgPT09IDB4Y2MpIHsKICAgICAgICAgICAgICAgIG9iamVjdCA9IHRoaXMucmVhZFU4KCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoaGVhZEJ5dGUgPT09IDB4Y2QpIHsKICAgICAgICAgICAgICAgIG9iamVjdCA9IHRoaXMucmVhZFUxNigpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGhlYWRCeXRlID09PSAweGNlKSB7CiAgICAgICAgICAgICAgICBvYmplY3QgPSB0aGlzLnJlYWRVMzIoKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChoZWFkQnl0ZSA9PT0gMHhjZikgewogICAgICAgICAgICAgICAgaWYgKHRoaXMudXNlQmlnSW50NjQpIHsKICAgICAgICAgICAgICAgICAgICBvYmplY3QgPSB0aGlzLnJlYWRVNjRBc0JpZ0ludCgpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBvYmplY3QgPSB0aGlzLnJlYWRVNjQoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChoZWFkQnl0ZSA9PT0gMHhkMCkgewogICAgICAgICAgICAgICAgb2JqZWN0ID0gdGhpcy5yZWFkSTgoKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChoZWFkQnl0ZSA9PT0gMHhkMSkgewogICAgICAgICAgICAgICAgb2JqZWN0ID0gdGhpcy5yZWFkSTE2KCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoaGVhZEJ5dGUgPT09IDB4ZDIpIHsKICAgICAgICAgICAgICAgIG9iamVjdCA9IHRoaXMucmVhZEkzMigpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGhlYWRCeXRlID09PSAweGQzKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy51c2VCaWdJbnQ2NCkgewogICAgICAgICAgICAgICAgICAgIG9iamVjdCA9IHRoaXMucmVhZEk2NEFzQmlnSW50KCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIG9iamVjdCA9IHRoaXMucmVhZEk2NCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKGhlYWRCeXRlID09PSAweGQ5KSB7CiAgICAgICAgICAgICAgICBjb25zdCBieXRlTGVuZ3RoID0gdGhpcy5sb29rVTgoKTsKICAgICAgICAgICAgICAgIG9iamVjdCA9IHRoaXMuZGVjb2RlU3RyaW5nKGJ5dGVMZW5ndGgsIDEpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGhlYWRCeXRlID09PSAweGRhKSB7CiAgICAgICAgICAgICAgICBjb25zdCBieXRlTGVuZ3RoID0gdGhpcy5sb29rVTE2KCk7CiAgICAgICAgICAgICAgICBvYmplY3QgPSB0aGlzLmRlY29kZVN0cmluZyhieXRlTGVuZ3RoLCAyKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChoZWFkQnl0ZSA9PT0gMHhkYikgewogICAgICAgICAgICAgICAgY29uc3QgYnl0ZUxlbmd0aCA9IHRoaXMubG9va1UzMigpOwogICAgICAgICAgICAgICAgb2JqZWN0ID0gdGhpcy5kZWNvZGVTdHJpbmcoYnl0ZUxlbmd0aCwgNCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoaGVhZEJ5dGUgPT09IDB4ZGMpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHNpemUgPSB0aGlzLnJlYWRVMTYoKTsKICAgICAgICAgICAgICAgIGlmIChzaXplICE9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wdXNoQXJyYXlTdGF0ZShzaXplKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbXBsZXRlKCk7CiAgICAgICAgICAgICAgICAgICAgY29udGludWUgREVDT0RFOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBvYmplY3QgPSBbXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChoZWFkQnl0ZSA9PT0gMHhkZCkgewogICAgICAgICAgICAgICAgY29uc3Qgc2l6ZSA9IHRoaXMucmVhZFUzMigpOwogICAgICAgICAgICAgICAgaWYgKHNpemUgIT09IDApIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnB1c2hBcnJheVN0YXRlKHNpemUpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuY29tcGxldGUoKTsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZSBERUNPREU7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIG9iamVjdCA9IFtdOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKGhlYWRCeXRlID09PSAweGRlKSB7CiAgICAgICAgICAgICAgICBjb25zdCBzaXplID0gdGhpcy5yZWFkVTE2KCk7CiAgICAgICAgICAgICAgICBpZiAoc2l6ZSAhPT0gMCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMucHVzaE1hcFN0YXRlKHNpemUpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuY29tcGxldGUoKTsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZSBERUNPREU7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIG9iamVjdCA9IHt9OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKGhlYWRCeXRlID09PSAweGRmKSB7CiAgICAgICAgICAgICAgICBjb25zdCBzaXplID0gdGhpcy5yZWFkVTMyKCk7CiAgICAgICAgICAgICAgICBpZiAoc2l6ZSAhPT0gMCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMucHVzaE1hcFN0YXRlKHNpemUpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuY29tcGxldGUoKTsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZSBERUNPREU7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIG9iamVjdCA9IHt9OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKGhlYWRCeXRlID09PSAweGM0KSB7CiAgICAgICAgICAgICAgICBjb25zdCBzaXplID0gdGhpcy5sb29rVTgoKTsKICAgICAgICAgICAgICAgIG9iamVjdCA9IHRoaXMuZGVjb2RlQmluYXJ5KHNpemUsIDEpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGhlYWRCeXRlID09PSAweGM1KSB7CiAgICAgICAgICAgICAgICBjb25zdCBzaXplID0gdGhpcy5sb29rVTE2KCk7CiAgICAgICAgICAgICAgICBvYmplY3QgPSB0aGlzLmRlY29kZUJpbmFyeShzaXplLCAyKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChoZWFkQnl0ZSA9PT0gMHhjNikgewogICAgICAgICAgICAgICAgY29uc3Qgc2l6ZSA9IHRoaXMubG9va1UzMigpOwogICAgICAgICAgICAgICAgb2JqZWN0ID0gdGhpcy5kZWNvZGVCaW5hcnkoc2l6ZSwgNCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoaGVhZEJ5dGUgPT09IDB4ZDQpIHsKICAgICAgICAgICAgICAgIG9iamVjdCA9IHRoaXMuZGVjb2RlRXh0ZW5zaW9uKDEsIDApOwogICAgICAgICAgICB9IGVsc2UgaWYgKGhlYWRCeXRlID09PSAweGQ1KSB7CiAgICAgICAgICAgICAgICBvYmplY3QgPSB0aGlzLmRlY29kZUV4dGVuc2lvbigyLCAwKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChoZWFkQnl0ZSA9PT0gMHhkNikgewogICAgICAgICAgICAgICAgb2JqZWN0ID0gdGhpcy5kZWNvZGVFeHRlbnNpb24oNCwgMCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoaGVhZEJ5dGUgPT09IDB4ZDcpIHsKICAgICAgICAgICAgICAgIG9iamVjdCA9IHRoaXMuZGVjb2RlRXh0ZW5zaW9uKDgsIDApOwogICAgICAgICAgICB9IGVsc2UgaWYgKGhlYWRCeXRlID09PSAweGQ4KSB7CiAgICAgICAgICAgICAgICBvYmplY3QgPSB0aGlzLmRlY29kZUV4dGVuc2lvbigxNiwgMCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoaGVhZEJ5dGUgPT09IDB4YzcpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHNpemUgPSB0aGlzLmxvb2tVOCgpOwogICAgICAgICAgICAgICAgb2JqZWN0ID0gdGhpcy5kZWNvZGVFeHRlbnNpb24oc2l6ZSwgMSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoaGVhZEJ5dGUgPT09IDB4YzgpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHNpemUgPSB0aGlzLmxvb2tVMTYoKTsKICAgICAgICAgICAgICAgIG9iamVjdCA9IHRoaXMuZGVjb2RlRXh0ZW5zaW9uKHNpemUsIDIpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGhlYWRCeXRlID09PSAweGM5KSB7CiAgICAgICAgICAgICAgICBjb25zdCBzaXplID0gdGhpcy5sb29rVTMyKCk7CiAgICAgICAgICAgICAgICBvYmplY3QgPSB0aGlzLmRlY29kZUV4dGVuc2lvbihzaXplLCA0KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBEZWNvZGVFcnJvcihgVW5yZWNvZ25pemVkIHR5cGUgYnl0ZTogJHtwcmV0dHlCeXRlKGhlYWRCeXRlKX1gKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLmNvbXBsZXRlKCk7CiAgICAgICAgICAgIGNvbnN0IHN0YWNrID0gdGhpcy5zdGFjazsKICAgICAgICAgICAgd2hpbGUoc3RhY2subGVuZ3RoID4gMCl7CiAgICAgICAgICAgICAgICBjb25zdCBzdGF0ZSA9IHN0YWNrLnRvcCgpOwogICAgICAgICAgICAgICAgaWYgKHN0YXRlLnR5cGUgPT09IFNUQVRFX0FSUkFZKSB7CiAgICAgICAgICAgICAgICAgICAgc3RhdGUuYXJyYXlbc3RhdGUucG9zaXRpb25dID0gb2JqZWN0OwogICAgICAgICAgICAgICAgICAgIHN0YXRlLnBvc2l0aW9uKys7CiAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXRlLnBvc2l0aW9uID09PSBzdGF0ZS5zaXplKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdCA9IHN0YXRlLmFycmF5OwogICAgICAgICAgICAgICAgICAgICAgICBzdGFjay5yZWxlYXNlKHN0YXRlKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZSBERUNPREU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzdGF0ZS50eXBlID09PSBTVEFURV9NQVBfS0VZKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKG9iamVjdCA9PT0gIl9fcHJvdG9fXyIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IERlY29kZUVycm9yKCJUaGUga2V5IF9fcHJvdG9fXyBpcyBub3QgYWxsb3dlZCIpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBzdGF0ZS5rZXkgPSB0aGlzLm1hcEtleUNvbnZlcnRlcihvYmplY3QpOwogICAgICAgICAgICAgICAgICAgIHN0YXRlLnR5cGUgPSBTVEFURV9NQVBfVkFMVUU7CiAgICAgICAgICAgICAgICAgICAgY29udGludWUgREVDT0RFOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBzdGF0ZS5tYXBbc3RhdGUua2V5XSA9IG9iamVjdDsKICAgICAgICAgICAgICAgICAgICBzdGF0ZS5yZWFkQ291bnQrKzsKICAgICAgICAgICAgICAgICAgICBpZiAoc3RhdGUucmVhZENvdW50ID09PSBzdGF0ZS5zaXplKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdCA9IHN0YXRlLm1hcDsKICAgICAgICAgICAgICAgICAgICAgICAgc3RhY2sucmVsZWFzZShzdGF0ZSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUua2V5ID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUudHlwZSA9IFNUQVRFX01BUF9LRVk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlIERFQ09ERTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG9iamVjdDsKICAgICAgICB9CiAgICB9CiAgICByZWFkSGVhZEJ5dGUoKSB7CiAgICAgICAgaWYgKHRoaXMuaGVhZEJ5dGUgPT09IEhFQURfQllURV9SRVFVSVJFRCkgewogICAgICAgICAgICB0aGlzLmhlYWRCeXRlID0gdGhpcy5yZWFkVTgoKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXMuaGVhZEJ5dGU7CiAgICB9CiAgICBjb21wbGV0ZSgpIHsKICAgICAgICB0aGlzLmhlYWRCeXRlID0gSEVBRF9CWVRFX1JFUVVJUkVEOwogICAgfQogICAgcmVhZEFycmF5U2l6ZSgpIHsKICAgICAgICBjb25zdCBoZWFkQnl0ZSA9IHRoaXMucmVhZEhlYWRCeXRlKCk7CiAgICAgICAgc3dpdGNoKGhlYWRCeXRlKXsKICAgICAgICAgICAgY2FzZSAweGRjOgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVhZFUxNigpOwogICAgICAgICAgICBjYXNlIDB4ZGQ6CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5yZWFkVTMyKCk7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGhlYWRCeXRlIDwgMHhhMCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaGVhZEJ5dGUgLSAweDkwOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBEZWNvZGVFcnJvcihgVW5yZWNvZ25pemVkIGFycmF5IHR5cGUgYnl0ZTogJHtwcmV0dHlCeXRlKGhlYWRCeXRlKX1gKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgcHVzaE1hcFN0YXRlKHNpemUpIHsKICAgICAgICBpZiAoc2l6ZSA+IHRoaXMubWF4TWFwTGVuZ3RoKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBEZWNvZGVFcnJvcihgTWF4IGxlbmd0aCBleGNlZWRlZDogbWFwIGxlbmd0aCAoJHtzaXplfSkgPiBtYXhNYXBMZW5ndGhMZW5ndGggKCR7dGhpcy5tYXhNYXBMZW5ndGh9KWApOwogICAgICAgIH0KICAgICAgICB0aGlzLnN0YWNrLnB1c2hNYXBTdGF0ZShzaXplKTsKICAgIH0KICAgIHB1c2hBcnJheVN0YXRlKHNpemUpIHsKICAgICAgICBpZiAoc2l6ZSA+IHRoaXMubWF4QXJyYXlMZW5ndGgpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IERlY29kZUVycm9yKGBNYXggbGVuZ3RoIGV4Y2VlZGVkOiBhcnJheSBsZW5ndGggKCR7c2l6ZX0pID4gbWF4QXJyYXlMZW5ndGggKCR7dGhpcy5tYXhBcnJheUxlbmd0aH0pYCk7CiAgICAgICAgfQogICAgICAgIHRoaXMuc3RhY2sucHVzaEFycmF5U3RhdGUoc2l6ZSk7CiAgICB9CiAgICBkZWNvZGVTdHJpbmcoYnl0ZUxlbmd0aCwgaGVhZGVyT2Zmc2V0KSB7CiAgICAgICAgaWYgKCF0aGlzLnJhd1N0cmluZ3MgfHwgdGhpcy5zdGF0ZUlzTWFwS2V5KCkpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGVjb2RlVXRmOFN0cmluZyhieXRlTGVuZ3RoLCBoZWFkZXJPZmZzZXQpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpcy5kZWNvZGVCaW5hcnkoYnl0ZUxlbmd0aCwgaGVhZGVyT2Zmc2V0KTsKICAgIH0KICAgIGRlY29kZVV0ZjhTdHJpbmcoYnl0ZUxlbmd0aCwgaGVhZGVyT2Zmc2V0KSB7CiAgICAgICAgaWYgKGJ5dGVMZW5ndGggPiB0aGlzLm1heFN0ckxlbmd0aCkgewogICAgICAgICAgICB0aHJvdyBuZXcgRGVjb2RlRXJyb3IoYE1heCBsZW5ndGggZXhjZWVkZWQ6IFVURi04IGJ5dGUgbGVuZ3RoICgke2J5dGVMZW5ndGh9KSA+IG1heFN0ckxlbmd0aCAoJHt0aGlzLm1heFN0ckxlbmd0aH0pYCk7CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLmJ5dGVzLmJ5dGVMZW5ndGggPCB0aGlzLnBvcyArIGhlYWRlck9mZnNldCArIGJ5dGVMZW5ndGgpIHsKICAgICAgICAgICAgdGhyb3cgTU9SRV9EQVRBOwogICAgICAgIH0KICAgICAgICBjb25zdCBvZmZzZXQgPSB0aGlzLnBvcyArIGhlYWRlck9mZnNldDsKICAgICAgICBsZXQgb2JqZWN0OwogICAgICAgIGlmICh0aGlzLnN0YXRlSXNNYXBLZXkoKSAmJiB0aGlzLmtleURlY29kZXI/LmNhbkJlQ2FjaGVkKGJ5dGVMZW5ndGgpKSB7CiAgICAgICAgICAgIG9iamVjdCA9IHRoaXMua2V5RGVjb2Rlci5kZWNvZGUodGhpcy5ieXRlcywgb2Zmc2V0LCBieXRlTGVuZ3RoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBvYmplY3QgPSB1dGY4RGVjb2RlKHRoaXMuYnl0ZXMsIG9mZnNldCwgYnl0ZUxlbmd0aCk7CiAgICAgICAgfQogICAgICAgIHRoaXMucG9zICs9IGhlYWRlck9mZnNldCArIGJ5dGVMZW5ndGg7CiAgICAgICAgcmV0dXJuIG9iamVjdDsKICAgIH0KICAgIHN0YXRlSXNNYXBLZXkoKSB7CiAgICAgICAgaWYgKHRoaXMuc3RhY2subGVuZ3RoID4gMCkgewogICAgICAgICAgICBjb25zdCBzdGF0ZSA9IHRoaXMuc3RhY2sudG9wKCk7CiAgICAgICAgICAgIHJldHVybiBzdGF0ZS50eXBlID09PSBTVEFURV9NQVBfS0VZOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBkZWNvZGVCaW5hcnkoYnl0ZUxlbmd0aCwgaGVhZE9mZnNldCkgewogICAgICAgIGlmIChieXRlTGVuZ3RoID4gdGhpcy5tYXhCaW5MZW5ndGgpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IERlY29kZUVycm9yKGBNYXggbGVuZ3RoIGV4Y2VlZGVkOiBiaW4gbGVuZ3RoICgke2J5dGVMZW5ndGh9KSA+IG1heEJpbkxlbmd0aCAoJHt0aGlzLm1heEJpbkxlbmd0aH0pYCk7CiAgICAgICAgfQogICAgICAgIGlmICghdGhpcy5oYXNSZW1haW5pbmcoYnl0ZUxlbmd0aCArIGhlYWRPZmZzZXQpKSB7CiAgICAgICAgICAgIHRocm93IE1PUkVfREFUQTsKICAgICAgICB9CiAgICAgICAgY29uc3Qgb2Zmc2V0ID0gdGhpcy5wb3MgKyBoZWFkT2Zmc2V0OwogICAgICAgIGNvbnN0IG9iamVjdCA9IHRoaXMuYnl0ZXMuc3ViYXJyYXkob2Zmc2V0LCBvZmZzZXQgKyBieXRlTGVuZ3RoKTsKICAgICAgICB0aGlzLnBvcyArPSBoZWFkT2Zmc2V0ICsgYnl0ZUxlbmd0aDsKICAgICAgICByZXR1cm4gb2JqZWN0OwogICAgfQogICAgZGVjb2RlRXh0ZW5zaW9uKHNpemUsIGhlYWRPZmZzZXQpIHsKICAgICAgICBpZiAoc2l6ZSA+IHRoaXMubWF4RXh0TGVuZ3RoKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBEZWNvZGVFcnJvcihgTWF4IGxlbmd0aCBleGNlZWRlZDogZXh0IGxlbmd0aCAoJHtzaXplfSkgPiBtYXhFeHRMZW5ndGggKCR7dGhpcy5tYXhFeHRMZW5ndGh9KWApOwogICAgICAgIH0KICAgICAgICBjb25zdCBleHRUeXBlID0gdGhpcy52aWV3LmdldEludDgodGhpcy5wb3MgKyBoZWFkT2Zmc2V0KTsKICAgICAgICBjb25zdCBkYXRhID0gdGhpcy5kZWNvZGVCaW5hcnkoc2l6ZSwgaGVhZE9mZnNldCArIDEpOwogICAgICAgIHJldHVybiB0aGlzLmV4dGVuc2lvbkNvZGVjLmRlY29kZShkYXRhLCBleHRUeXBlLCB0aGlzLmNvbnRleHQpOwogICAgfQogICAgbG9va1U4KCkgewogICAgICAgIHJldHVybiB0aGlzLnZpZXcuZ2V0VWludDgodGhpcy5wb3MpOwogICAgfQogICAgbG9va1UxNigpIHsKICAgICAgICByZXR1cm4gdGhpcy52aWV3LmdldFVpbnQxNih0aGlzLnBvcyk7CiAgICB9CiAgICBsb29rVTMyKCkgewogICAgICAgIHJldHVybiB0aGlzLnZpZXcuZ2V0VWludDMyKHRoaXMucG9zKTsKICAgIH0KICAgIHJlYWRVOCgpIHsKICAgICAgICBjb25zdCB2YWx1ZSA9IHRoaXMudmlldy5nZXRVaW50OCh0aGlzLnBvcyk7CiAgICAgICAgdGhpcy5wb3MrKzsKICAgICAgICByZXR1cm4gdmFsdWU7CiAgICB9CiAgICByZWFkSTgoKSB7CiAgICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLnZpZXcuZ2V0SW50OCh0aGlzLnBvcyk7CiAgICAgICAgdGhpcy5wb3MrKzsKICAgICAgICByZXR1cm4gdmFsdWU7CiAgICB9CiAgICByZWFkVTE2KCkgewogICAgICAgIGNvbnN0IHZhbHVlID0gdGhpcy52aWV3LmdldFVpbnQxNih0aGlzLnBvcyk7CiAgICAgICAgdGhpcy5wb3MgKz0gMjsKICAgICAgICByZXR1cm4gdmFsdWU7CiAgICB9CiAgICByZWFkSTE2KCkgewogICAgICAgIGNvbnN0IHZhbHVlID0gdGhpcy52aWV3LmdldEludDE2KHRoaXMucG9zKTsKICAgICAgICB0aGlzLnBvcyArPSAyOwogICAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0KICAgIHJlYWRVMzIoKSB7CiAgICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLnZpZXcuZ2V0VWludDMyKHRoaXMucG9zKTsKICAgICAgICB0aGlzLnBvcyArPSA0OwogICAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0KICAgIHJlYWRJMzIoKSB7CiAgICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLnZpZXcuZ2V0SW50MzIodGhpcy5wb3MpOwogICAgICAgIHRoaXMucG9zICs9IDQ7CiAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgfQogICAgcmVhZFU2NCgpIHsKICAgICAgICBjb25zdCB2YWx1ZSA9IGdldFVpbnQ2NCh0aGlzLnZpZXcsIHRoaXMucG9zKTsKICAgICAgICB0aGlzLnBvcyArPSA4OwogICAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0KICAgIHJlYWRJNjQoKSB7CiAgICAgICAgY29uc3QgdmFsdWUgPSBnZXRJbnQ2NCh0aGlzLnZpZXcsIHRoaXMucG9zKTsKICAgICAgICB0aGlzLnBvcyArPSA4OwogICAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0KICAgIHJlYWRVNjRBc0JpZ0ludCgpIHsKICAgICAgICBjb25zdCB2YWx1ZSA9IHRoaXMudmlldy5nZXRCaWdVaW50NjQodGhpcy5wb3MpOwogICAgICAgIHRoaXMucG9zICs9IDg7CiAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgfQogICAgcmVhZEk2NEFzQmlnSW50KCkgewogICAgICAgIGNvbnN0IHZhbHVlID0gdGhpcy52aWV3LmdldEJpZ0ludDY0KHRoaXMucG9zKTsKICAgICAgICB0aGlzLnBvcyArPSA4OwogICAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0KICAgIHJlYWRGMzIoKSB7CiAgICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLnZpZXcuZ2V0RmxvYXQzMih0aGlzLnBvcyk7CiAgICAgICAgdGhpcy5wb3MgKz0gNDsKICAgICAgICByZXR1cm4gdmFsdWU7CiAgICB9CiAgICByZWFkRjY0KCkgewogICAgICAgIGNvbnN0IHZhbHVlID0gdGhpcy52aWV3LmdldEZsb2F0NjQodGhpcy5wb3MpOwogICAgICAgIHRoaXMucG9zICs9IDg7CiAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgfQp9CmZ1bmN0aW9uIGRlY29kZShidWZmZXIsIG9wdGlvbnMpIHsKICAgIGNvbnN0IGRlY29kZXIgPSBuZXcgRGVjb2RlcihvcHRpb25zKTsKICAgIHJldHVybiBkZWNvZGVyLmRlY29kZShidWZmZXIpOwp9CmZ1bmN0aW9uIF9lKGUpIHsKICAgIGxldCBpID0gZS5sZW5ndGg7CiAgICBmb3IoOyAtLWkgPj0gMDspZVtpXSA9IDA7Cn0KdmFyICRpID0gMCwgYWkgPSAxLCBDaSA9IDIsIEZpID0gMywgTWkgPSAyNTgsIGR0ID0gMjksIEFlID0gMjU2LCBnZSA9IEFlICsgMSArIGR0LCBvZSA9IDMwLCBzdCA9IDE5LCBuaSA9IDIgKiBnZSArIDEsIFEgPSAxNSwgR2UgPSAxNiwgSGkgPSA3LCBjdCA9IDI1NiwgbGkgPSAxNiwgcmkgPSAxNywgZmkgPSAxOCwgZnQgPSBuZXcgVWludDhBcnJheShbCiAgICAwLAogICAgMCwKICAgIDAsCiAgICAwLAogICAgMCwKICAgIDAsCiAgICAwLAogICAgMCwKICAgIDEsCiAgICAxLAogICAgMSwKICAgIDEsCiAgICAyLAogICAgMiwKICAgIDIsCiAgICAyLAogICAgMywKICAgIDMsCiAgICAzLAogICAgMywKICAgIDQsCiAgICA0LAogICAgNCwKICAgIDQsCiAgICA1LAogICAgNSwKICAgIDUsCiAgICA1LAogICAgMApdKSwgJGUgPSBuZXcgVWludDhBcnJheShbCiAgICAwLAogICAgMCwKICAgIDAsCiAgICAwLAogICAgMSwKICAgIDEsCiAgICAyLAogICAgMiwKICAgIDMsCiAgICAzLAogICAgNCwKICAgIDQsCiAgICA1LAogICAgNSwKICAgIDYsCiAgICA2LAogICAgNywKICAgIDcsCiAgICA4LAogICAgOCwKICAgIDksCiAgICA5LAogICAgMTAsCiAgICAxMCwKICAgIDExLAogICAgMTEsCiAgICAxMiwKICAgIDEyLAogICAgMTMsCiAgICAxMwpdKSwgQmkgPSBuZXcgVWludDhBcnJheShbCiAgICAwLAogICAgMCwKICAgIDAsCiAgICAwLAogICAgMCwKICAgIDAsCiAgICAwLAogICAgMCwKICAgIDAsCiAgICAwLAogICAgMCwKICAgIDAsCiAgICAwLAogICAgMCwKICAgIDAsCiAgICAwLAogICAgMiwKICAgIDMsCiAgICA3Cl0pLCBvaSA9IG5ldyBVaW50OEFycmF5KFsKICAgIDE2LAogICAgMTcsCiAgICAxOCwKICAgIDAsCiAgICA4LAogICAgNywKICAgIDksCiAgICA2LAogICAgMTAsCiAgICA1LAogICAgMTEsCiAgICA0LAogICAgMTIsCiAgICAzLAogICAgMTMsCiAgICAyLAogICAgMTQsCiAgICAxLAogICAgMTUKXSksIEtpID0gNTEyLCBCID0gbmV3IEFycmF5KChnZSArIDIpICogMik7Cl9lKEIpOwp2YXIgdWUgPSBuZXcgQXJyYXkob2UgKiAyKTsKX2UodWUpOwp2YXIgcGUgPSBuZXcgQXJyYXkoS2kpOwpfZShwZSk7CnZhciB4ZSA9IG5ldyBBcnJheShNaSAtIEZpICsgMSk7Cl9lKHhlKTsKdmFyIHV0ID0gbmV3IEFycmF5KGR0KTsKX2UodXQpOwp2YXIgSGUgPSBuZXcgQXJyYXkob2UpOwpfZShIZSk7CmZ1bmN0aW9uIGplKGUsIGksIHQsIG4sIGEpIHsKICAgIHRoaXMuc3RhdGljX3RyZWUgPSBlLCB0aGlzLmV4dHJhX2JpdHMgPSBpLCB0aGlzLmV4dHJhX2Jhc2UgPSB0LCB0aGlzLmVsZW1zID0gbiwgdGhpcy5tYXhfbGVuZ3RoID0gYSwgdGhpcy5oYXNfc3RyZWUgPSBlICYmIGUubGVuZ3RoOwp9CnZhciBfaSwgaGksIGRpOwpmdW5jdGlvbiBXZShlLCBpKSB7CiAgICB0aGlzLmR5bl90cmVlID0gZSwgdGhpcy5tYXhfY29kZSA9IDAsIHRoaXMuc3RhdF9kZXNjID0gaTsKfQp2YXIgc2kgPSAoZSk9PmUgPCAyNTYgPyBwZVtlXSA6IHBlWzI1NiArIChlID4+PiA3KV0sIGtlID0gKGUsIGkpPT57CiAgICBlLnBlbmRpbmdfYnVmW2UucGVuZGluZysrXSA9IGkgJiAyNTUsIGUucGVuZGluZ19idWZbZS5wZW5kaW5nKytdID0gaSA+Pj4gOCAmIDI1NTsKfSwgTjEgPSAoZSwgaSwgdCk9PnsKICAgIGUuYmlfdmFsaWQgPiBHZSAtIHQgPyAoZS5iaV9idWYgfD0gaSA8PCBlLmJpX3ZhbGlkICYgNjU1MzUsIGtlKGUsIGUuYmlfYnVmKSwgZS5iaV9idWYgPSBpID4+IEdlIC0gZS5iaV92YWxpZCwgZS5iaV92YWxpZCArPSB0IC0gR2UpIDogKGUuYmlfYnVmIHw9IGkgPDwgZS5iaV92YWxpZCAmIDY1NTM1LCBlLmJpX3ZhbGlkICs9IHQpOwp9LCBGID0gKGUsIGksIHQpPT57CiAgICBOMShlLCB0W2kgKiAyXSwgdFtpICogMiArIDFdKTsKfSwgY2kgPSAoZSwgaSk9PnsKICAgIGxldCB0ID0gMDsKICAgIGRvIHQgfD0gZSAmIDEsIGUgPj4+PSAxLCB0IDw8PSAxOwogICAgd2hpbGUgKC0taSA+IDApCiAgICByZXR1cm4gdCA+Pj4gMTsKfSwgUGkgPSAoZSk9PnsKICAgIGUuYmlfdmFsaWQgPT09IDE2ID8gKGtlKGUsIGUuYmlfYnVmKSwgZS5iaV9idWYgPSAwLCBlLmJpX3ZhbGlkID0gMCkgOiBlLmJpX3ZhbGlkID49IDggJiYgKGUucGVuZGluZ19idWZbZS5wZW5kaW5nKytdID0gZS5iaV9idWYgJiAyNTUsIGUuYmlfYnVmID4+PSA4LCBlLmJpX3ZhbGlkIC09IDgpOwp9LCBYaSA9IChlLCBpKT0+ewogICAgbGV0IHQgPSBpLmR5bl90cmVlLCBuID0gaS5tYXhfY29kZSwgYSA9IGkuc3RhdF9kZXNjLnN0YXRpY190cmVlLCBsID0gaS5zdGF0X2Rlc2MuaGFzX3N0cmVlLCBvID0gaS5zdGF0X2Rlc2MuZXh0cmFfYml0cywgZiA9IGkuc3RhdF9kZXNjLmV4dHJhX2Jhc2UsIGMgPSBpLnN0YXRfZGVzYy5tYXhfbGVuZ3RoLCByLCBfLCBFLCBzLCBoLCB1LCBtID0gMDsKICAgIGZvcihzID0gMDsgcyA8PSBROyBzKyspZS5ibF9jb3VudFtzXSA9IDA7CiAgICBmb3IodFtlLmhlYXBbZS5oZWFwX21heF0gKiAyICsgMV0gPSAwLCByID0gZS5oZWFwX21heCArIDE7IHIgPCBuaTsgcisrKV8gPSBlLmhlYXBbcl0sIHMgPSB0W3RbXyAqIDIgKyAxXSAqIDIgKyAxXSArIDEsIHMgPiBjICYmIChzID0gYywgbSsrKSwgdFtfICogMiArIDFdID0gcywgIShfID4gbikgJiYgKGUuYmxfY291bnRbc10rKywgaCA9IDAsIF8gPj0gZiAmJiAoaCA9IG9bXyAtIGZdKSwgdSA9IHRbXyAqIDJdLCBlLm9wdF9sZW4gKz0gdSAqIChzICsgaCksIGwgJiYgKGUuc3RhdGljX2xlbiArPSB1ICogKGFbXyAqIDIgKyAxXSArIGgpKSk7CiAgICBpZiAobSAhPT0gMCkgewogICAgICAgIGRvIHsKICAgICAgICAgICAgZm9yKHMgPSBjIC0gMTsgZS5ibF9jb3VudFtzXSA9PT0gMDspcy0tOwogICAgICAgICAgICBlLmJsX2NvdW50W3NdLS0sIGUuYmxfY291bnRbcyArIDFdICs9IDIsIGUuYmxfY291bnRbY10tLSwgbSAtPSAyOwogICAgICAgIH13aGlsZSAobSA+IDApCiAgICAgICAgZm9yKHMgPSBjOyBzICE9PSAwOyBzLS0pZm9yKF8gPSBlLmJsX2NvdW50W3NdOyBfICE9PSAwOylFID0gZS5oZWFwWy0tcl0sICEoRSA+IG4pICYmICh0W0UgKiAyICsgMV0gIT09IHMgJiYgKGUub3B0X2xlbiArPSAocyAtIHRbRSAqIDIgKyAxXSkgKiB0W0UgKiAyXSwgdFtFICogMiArIDFdID0gcyksIF8tLSk7CiAgICB9Cn0sIHVpID0gKGUsIGksIHQpPT57CiAgICBsZXQgbiA9IG5ldyBBcnJheShRICsgMSksIGEgPSAwLCBsLCBvOwogICAgZm9yKGwgPSAxOyBsIDw9IFE7IGwrKyluW2xdID0gYSA9IGEgKyB0W2wgLSAxXSA8PCAxOwogICAgZm9yKG8gPSAwOyBvIDw9IGk7IG8rKyl7CiAgICAgICAgbGV0IGYgPSBlW28gKiAyICsgMV07CiAgICAgICAgZiAhPT0gMCAmJiAoZVtvICogMl0gPSBjaShuW2ZdKyssIGYpKTsKICAgIH0KfSwgWWkgPSAoKT0+ewogICAgbGV0IGUsIGksIHQsIG4sIGEsIGwgPSBuZXcgQXJyYXkoUSArIDEpOwogICAgZm9yKHQgPSAwLCBuID0gMDsgbiA8IGR0IC0gMTsgbisrKWZvcih1dFtuXSA9IHQsIGUgPSAwOyBlIDwgMSA8PCBmdFtuXTsgZSsrKXhlW3QrK10gPSBuOwogICAgZm9yKHhlW3QgLSAxXSA9IG4sIGEgPSAwLCBuID0gMDsgbiA8IDE2OyBuKyspZm9yKEhlW25dID0gYSwgZSA9IDA7IGUgPCAxIDw8ICRlW25dOyBlKyspcGVbYSsrXSA9IG47CiAgICBmb3IoYSA+Pj0gNzsgbiA8IG9lOyBuKyspZm9yKEhlW25dID0gYSA8PCA3LCBlID0gMDsgZSA8IDEgPDwgJGVbbl0gLSA3OyBlKyspcGVbMjU2ICsgYSsrXSA9IG47CiAgICBmb3IoaSA9IDA7IGkgPD0gUTsgaSsrKWxbaV0gPSAwOwogICAgZm9yKGUgPSAwOyBlIDw9IDE0MzspQltlICogMiArIDFdID0gOCwgZSsrLCBsWzhdKys7CiAgICBmb3IoOyBlIDw9IDI1NTspQltlICogMiArIDFdID0gOSwgZSsrLCBsWzldKys7CiAgICBmb3IoOyBlIDw9IDI3OTspQltlICogMiArIDFdID0gNywgZSsrLCBsWzddKys7CiAgICBmb3IoOyBlIDw9IDI4NzspQltlICogMiArIDFdID0gOCwgZSsrLCBsWzhdKys7CiAgICBmb3IodWkoQiwgZ2UgKyAxLCBsKSwgZSA9IDA7IGUgPCBvZTsgZSsrKXVlW2UgKiAyICsgMV0gPSA1LCB1ZVtlICogMl0gPSBjaShlLCA1KTsKICAgIF9pID0gbmV3IGplKEIsIGZ0LCBBZSArIDEsIGdlLCBRKSwgaGkgPSBuZXcgamUodWUsICRlLCAwLCBvZSwgUSksIGRpID0gbmV3IGplKG5ldyBBcnJheSgwKSwgQmksIDAsIHN0LCBIaSk7Cn0sIGJpID0gKGUpPT57CiAgICBsZXQgaTsKICAgIGZvcihpID0gMDsgaSA8IGdlOyBpKyspZS5keW5fbHRyZWVbaSAqIDJdID0gMDsKICAgIGZvcihpID0gMDsgaSA8IG9lOyBpKyspZS5keW5fZHRyZWVbaSAqIDJdID0gMDsKICAgIGZvcihpID0gMDsgaSA8IHN0OyBpKyspZS5ibF90cmVlW2kgKiAyXSA9IDA7CiAgICBlLmR5bl9sdHJlZVtjdCAqIDJdID0gMSwgZS5vcHRfbGVuID0gZS5zdGF0aWNfbGVuID0gMCwgZS5sYXN0X2xpdCA9IGUubWF0Y2hlcyA9IDA7Cn0sIHdpID0gKGUpPT57CiAgICBlLmJpX3ZhbGlkID4gOCA/IGtlKGUsIGUuYmlfYnVmKSA6IGUuYmlfdmFsaWQgPiAwICYmIChlLnBlbmRpbmdfYnVmW2UucGVuZGluZysrXSA9IGUuYmlfYnVmKSwgZS5iaV9idWYgPSAwLCBlLmJpX3ZhbGlkID0gMDsKfSwgR2kgPSAoZSwgaSwgdCwgbik9PnsKICAgIHdpKGUpLCBuICYmIChrZShlLCB0KSwga2UoZSwgfnQpKSwgZS5wZW5kaW5nX2J1Zi5zZXQoZS53aW5kb3cuc3ViYXJyYXkoaSwgaSArIHQpLCBlLnBlbmRpbmcpLCBlLnBlbmRpbmcgKz0gdDsKfSwgeHQgPSAoZSwgaSwgdCwgbik9PnsKICAgIGxldCBhID0gaSAqIDIsIGwgPSB0ICogMjsKICAgIHJldHVybiBlW2FdIDwgZVtsXSB8fCBlW2FdID09PSBlW2xdICYmIG5baV0gPD0gblt0XTsKfSwgVmUgPSAoZSwgaSwgdCk9PnsKICAgIGxldCBuID0gZS5oZWFwW3RdLCBhID0gdCA8PCAxOwogICAgZm9yKDsgYSA8PSBlLmhlYXBfbGVuICYmIChhIDwgZS5oZWFwX2xlbiAmJiB4dChpLCBlLmhlYXBbYSArIDFdLCBlLmhlYXBbYV0sIGUuZGVwdGgpICYmIGErKywgIXh0KGksIG4sIGUuaGVhcFthXSwgZS5kZXB0aCkpOyllLmhlYXBbdF0gPSBlLmhlYXBbYV0sIHQgPSBhLCBhIDw8PSAxOwogICAgZS5oZWFwW3RdID0gbjsKfSwga3QgPSAoZSwgaSwgdCk9PnsKICAgIGxldCBuLCBhLCBsID0gMCwgbywgZjsKICAgIGlmIChlLmxhc3RfbGl0ICE9PSAwKSBkbyBuID0gZS5wZW5kaW5nX2J1ZltlLmRfYnVmICsgbCAqIDJdIDw8IDggfCBlLnBlbmRpbmdfYnVmW2UuZF9idWYgKyBsICogMiArIDFdLCBhID0gZS5wZW5kaW5nX2J1ZltlLmxfYnVmICsgbF0sIGwrKywgbiA9PT0gMCA/IEYoZSwgYSwgaSkgOiAobyA9IHhlW2FdLCBGKGUsIG8gKyBBZSArIDEsIGkpLCBmID0gZnRbb10sIGYgIT09IDAgJiYgKGEgLT0gdXRbb10sIE4xKGUsIGEsIGYpKSwgbi0tLCBvID0gc2kobiksIEYoZSwgbywgdCksIGYgPSAkZVtvXSwgZiAhPT0gMCAmJiAobiAtPSBIZVtvXSwgTjEoZSwgbiwgZikpKTsKICAgIHdoaWxlIChsIDwgZS5sYXN0X2xpdCkKICAgIEYoZSwgY3QsIGkpOwp9LCBvdCA9IChlLCBpKT0+ewogICAgbGV0IHQgPSBpLmR5bl90cmVlLCBuID0gaS5zdGF0X2Rlc2Muc3RhdGljX3RyZWUsIGEgPSBpLnN0YXRfZGVzYy5oYXNfc3RyZWUsIGwgPSBpLnN0YXRfZGVzYy5lbGVtcywgbywgZiwgYyA9IC0xLCByOwogICAgZm9yKGUuaGVhcF9sZW4gPSAwLCBlLmhlYXBfbWF4ID0gbmksIG8gPSAwOyBvIDwgbDsgbysrKXRbbyAqIDJdICE9PSAwID8gKGUuaGVhcFsrK2UuaGVhcF9sZW5dID0gYyA9IG8sIGUuZGVwdGhbb10gPSAwKSA6IHRbbyAqIDIgKyAxXSA9IDA7CiAgICBmb3IoOyBlLmhlYXBfbGVuIDwgMjspciA9IGUuaGVhcFsrK2UuaGVhcF9sZW5dID0gYyA8IDIgPyArK2MgOiAwLCB0W3IgKiAyXSA9IDEsIGUuZGVwdGhbcl0gPSAwLCBlLm9wdF9sZW4tLSwgYSAmJiAoZS5zdGF0aWNfbGVuIC09IG5bciAqIDIgKyAxXSk7CiAgICBmb3IoaS5tYXhfY29kZSA9IGMsIG8gPSBlLmhlYXBfbGVuID4+IDE7IG8gPj0gMTsgby0tKVZlKGUsIHQsIG8pOwogICAgciA9IGw7CiAgICBkbyBvID0gZS5oZWFwWzFdLCBlLmhlYXBbMV0gPSBlLmhlYXBbZS5oZWFwX2xlbi0tXSwgVmUoZSwgdCwgMSksIGYgPSBlLmhlYXBbMV0sIGUuaGVhcFstLWUuaGVhcF9tYXhdID0gbywgZS5oZWFwWy0tZS5oZWFwX21heF0gPSBmLCB0W3IgKiAyXSA9IHRbbyAqIDJdICsgdFtmICogMl0sIGUuZGVwdGhbcl0gPSAoZS5kZXB0aFtvXSA+PSBlLmRlcHRoW2ZdID8gZS5kZXB0aFtvXSA6IGUuZGVwdGhbZl0pICsgMSwgdFtvICogMiArIDFdID0gdFtmICogMiArIDFdID0gciwgZS5oZWFwWzFdID0gcisrLCBWZShlLCB0LCAxKTsKICAgIHdoaWxlIChlLmhlYXBfbGVuID49IDIpCiAgICBlLmhlYXBbLS1lLmhlYXBfbWF4XSA9IGUuaGVhcFsxXSwgWGkoZSwgaSksIHVpKHQsIGMsIGUuYmxfY291bnQpOwp9LCB2dCA9IChlLCBpLCB0KT0+ewogICAgbGV0IG4sIGEgPSAtMSwgbCwgbyA9IGlbMCAqIDIgKyAxXSwgZiA9IDAsIGMgPSA3LCByID0gNDsKICAgIGZvcihvID09PSAwICYmIChjID0gMTM4LCByID0gMyksIGlbKHQgKyAxKSAqIDIgKyAxXSA9IDY1NTM1LCBuID0gMDsgbiA8PSB0OyBuKyspbCA9IG8sIG8gPSBpWyhuICsgMSkgKiAyICsgMV0sICEoKytmIDwgYyAmJiBsID09PSBvKSAmJiAoZiA8IHIgPyBlLmJsX3RyZWVbbCAqIDJdICs9IGYgOiBsICE9PSAwID8gKGwgIT09IGEgJiYgZS5ibF90cmVlW2wgKiAyXSsrLCBlLmJsX3RyZWVbbGkgKiAyXSsrKSA6IGYgPD0gMTAgPyBlLmJsX3RyZWVbcmkgKiAyXSsrIDogZS5ibF90cmVlW2ZpICogMl0rKywgZiA9IDAsIGEgPSBsLCBvID09PSAwID8gKGMgPSAxMzgsIHIgPSAzKSA6IGwgPT09IG8gPyAoYyA9IDYsIHIgPSAzKSA6IChjID0gNywgciA9IDQpKTsKfSwgRXQgPSAoZSwgaSwgdCk9PnsKICAgIGxldCBuLCBhID0gLTEsIGwsIG8gPSBpWzAgKiAyICsgMV0sIGYgPSAwLCBjID0gNywgciA9IDQ7CiAgICBmb3IobyA9PT0gMCAmJiAoYyA9IDEzOCwgciA9IDMpLCBuID0gMDsgbiA8PSB0OyBuKyspaWYgKGwgPSBvLCBvID0gaVsobiArIDEpICogMiArIDFdLCAhKCsrZiA8IGMgJiYgbCA9PT0gbykpIHsKICAgICAgICBpZiAoZiA8IHIpIGRvIEYoZSwgbCwgZS5ibF90cmVlKTsKICAgICAgICB3aGlsZSAoLS1mICE9PSAwKQogICAgICAgIGVsc2UgbCAhPT0gMCA/IChsICE9PSBhICYmIChGKGUsIGwsIGUuYmxfdHJlZSksIGYtLSksIEYoZSwgbGksIGUuYmxfdHJlZSksIE4xKGUsIGYgLSAzLCAyKSkgOiBmIDw9IDEwID8gKEYoZSwgcmksIGUuYmxfdHJlZSksIE4xKGUsIGYgLSAzLCAzKSkgOiAoRihlLCBmaSwgZS5ibF90cmVlKSwgTjEoZSwgZiAtIDExLCA3KSk7CiAgICAgICAgZiA9IDAsIGEgPSBsLCBvID09PSAwID8gKGMgPSAxMzgsIHIgPSAzKSA6IGwgPT09IG8gPyAoYyA9IDYsIHIgPSAzKSA6IChjID0gNywgciA9IDQpOwogICAgfQp9LCBqaSA9IChlKT0+ewogICAgbGV0IGk7CiAgICBmb3IodnQoZSwgZS5keW5fbHRyZWUsIGUubF9kZXNjLm1heF9jb2RlKSwgdnQoZSwgZS5keW5fZHRyZWUsIGUuZF9kZXNjLm1heF9jb2RlKSwgb3QoZSwgZS5ibF9kZXNjKSwgaSA9IHN0IC0gMTsgaSA+PSAzICYmIGUuYmxfdHJlZVtvaVtpXSAqIDIgKyAxXSA9PT0gMDsgaS0tKTsKICAgIHJldHVybiBlLm9wdF9sZW4gKz0gMyAqIChpICsgMSkgKyA1ICsgNSArIDQsIGk7Cn0sIFdpID0gKGUsIGksIHQsIG4pPT57CiAgICBsZXQgYTsKICAgIGZvcihOMShlLCBpIC0gMjU3LCA1KSwgTjEoZSwgdCAtIDEsIDUpLCBOMShlLCBuIC0gNCwgNCksIGEgPSAwOyBhIDwgbjsgYSsrKU4xKGUsIGUuYmxfdHJlZVtvaVthXSAqIDIgKyAxXSwgMyk7CiAgICBFdChlLCBlLmR5bl9sdHJlZSwgaSAtIDEpLCBFdChlLCBlLmR5bl9kdHJlZSwgdCAtIDEpOwp9LCBWaSA9IChlKT0+ewogICAgbGV0IGkgPSA0MDkzNjI0NDQ3LCB0OwogICAgZm9yKHQgPSAwOyB0IDw9IDMxOyB0KyssIGkgPj4+PSAxKWlmIChpICYgMSAmJiBlLmR5bl9sdHJlZVt0ICogMl0gIT09IDApIHJldHVybiAwOwogICAgaWYgKGUuZHluX2x0cmVlWzkgKiAyXSAhPT0gMCB8fCBlLmR5bl9sdHJlZVsxMCAqIDJdICE9PSAwIHx8IGUuZHluX2x0cmVlWzEzICogMl0gIT09IDApIHJldHVybiAxOwogICAgZm9yKHQgPSAzMjsgdCA8IEFlOyB0KyspaWYgKGUuZHluX2x0cmVlW3QgKiAyXSAhPT0gMCkgcmV0dXJuIDE7CiAgICByZXR1cm4gMDsKfSwgeXQgPSAhMSwgSmkgPSAoZSk9PnsKICAgIHl0IHx8IChZaSgpLCB5dCA9ICEwKSwgZS5sX2Rlc2MgPSBuZXcgV2UoZS5keW5fbHRyZWUsIF9pKSwgZS5kX2Rlc2MgPSBuZXcgV2UoZS5keW5fZHRyZWUsIGhpKSwgZS5ibF9kZXNjID0gbmV3IFdlKGUuYmxfdHJlZSwgZGkpLCBlLmJpX2J1ZiA9IDAsIGUuYmlfdmFsaWQgPSAwLCBiaShlKTsKfSwgZ2kgPSAoZSwgaSwgdCwgbik9PnsKICAgIE4xKGUsICgkaSA8PCAxKSArIChuID8gMSA6IDApLCAzKSwgR2koZSwgaSwgdCwgITApOwp9LCBRaSA9IChlKT0+ewogICAgTjEoZSwgYWkgPDwgMSwgMyksIEYoZSwgY3QsIEIpLCBQaShlKTsKfSwgcWkgPSAoZSwgaSwgdCwgbik9PnsKICAgIGxldCBhLCBsLCBvID0gMDsKICAgIGUubGV2ZWwgPiAwID8gKGUuc3RybS5kYXRhX3R5cGUgPT09IDIgJiYgKGUuc3RybS5kYXRhX3R5cGUgPSBWaShlKSksIG90KGUsIGUubF9kZXNjKSwgb3QoZSwgZS5kX2Rlc2MpLCBvID0gamkoZSksIGEgPSBlLm9wdF9sZW4gKyAzICsgNyA+Pj4gMywgbCA9IGUuc3RhdGljX2xlbiArIDMgKyA3ID4+PiAzLCBsIDw9IGEgJiYgKGEgPSBsKSkgOiBhID0gbCA9IHQgKyA1LCB0ICsgNCA8PSBhICYmIGkgIT09IC0xID8gZ2koZSwgaSwgdCwgbikgOiBlLnN0cmF0ZWd5ID09PSA0IHx8IGwgPT09IGEgPyAoTjEoZSwgKGFpIDw8IDEpICsgKG4gPyAxIDogMCksIDMpLCBrdChlLCBCLCB1ZSkpIDogKE4xKGUsIChDaSA8PCAxKSArIChuID8gMSA6IDApLCAzKSwgV2koZSwgZS5sX2Rlc2MubWF4X2NvZGUgKyAxLCBlLmRfZGVzYy5tYXhfY29kZSArIDEsIG8gKyAxKSwga3QoZSwgZS5keW5fbHRyZWUsIGUuZHluX2R0cmVlKSksIGJpKGUpLCBuICYmIHdpKGUpOwp9LCBlYSA9IChlLCBpLCB0KT0+KGUucGVuZGluZ19idWZbZS5kX2J1ZiArIGUubGFzdF9saXQgKiAyXSA9IGkgPj4+IDggJiAyNTUsIGUucGVuZGluZ19idWZbZS5kX2J1ZiArIGUubGFzdF9saXQgKiAyICsgMV0gPSBpICYgMjU1LCBlLnBlbmRpbmdfYnVmW2UubF9idWYgKyBlLmxhc3RfbGl0XSA9IHQgJiAyNTUsIGUubGFzdF9saXQrKywgaSA9PT0gMCA/IGUuZHluX2x0cmVlW3QgKiAyXSsrIDogKGUubWF0Y2hlcysrLCBpLS0sIGUuZHluX2x0cmVlWyh4ZVt0XSArIEFlICsgMSkgKiAyXSsrLCBlLmR5bl9kdHJlZVtzaShpKSAqIDJdKyspLCBlLmxhc3RfbGl0ID09PSBlLmxpdF9idWZzaXplIC0gMSksIHRhID0gSmksIGlhID0gZ2ksIGFhID0gcWksIG5hID0gZWEsIGxhID0gUWksIHJhID0gewogICAgX3RyX2luaXQ6IHRhLAogICAgX3RyX3N0b3JlZF9ibG9jazogaWEsCiAgICBfdHJfZmx1c2hfYmxvY2s6IGFhLAogICAgX3RyX3RhbGx5OiBuYSwKICAgIF90cl9hbGlnbjogbGEKfSwgZmEgPSAoZSwgaSwgdCwgbik9PnsKICAgIGxldCBhID0gZSAmIDY1NTM1IHwgMCwgbCA9IGUgPj4+IDE2ICYgNjU1MzUgfCAwLCBvID0gMDsKICAgIGZvcig7IHQgIT09IDA7KXsKICAgICAgICBvID0gdCA+IDJlMyA/IDJlMyA6IHQsIHQgLT0gbzsKICAgICAgICBkbyBhID0gYSArIGlbbisrXSB8IDAsIGwgPSBsICsgYSB8IDA7CiAgICAgICAgd2hpbGUgKC0tbykKICAgICAgICBhICU9IDY1NTIxLCBsICU9IDY1NTIxOwogICAgfQogICAgcmV0dXJuIGEgfCBsIDw8IDE2IHwgMDsKfSwgdmUgPSBmYSwgb2EgPSAoKT0+ewogICAgbGV0IGUsIGkgPSBbXTsKICAgIGZvcih2YXIgdCA9IDA7IHQgPCAyNTY7IHQrKyl7CiAgICAgICAgZSA9IHQ7CiAgICAgICAgZm9yKHZhciBuID0gMDsgbiA8IDg7IG4rKyllID0gZSAmIDEgPyAzOTg4MjkyMzg0IF4gZSA+Pj4gMSA6IGUgPj4+IDE7CiAgICAgICAgaVt0XSA9IGU7CiAgICB9CiAgICByZXR1cm4gaTsKfSwgX2EgPSBuZXcgVWludDMyQXJyYXkob2EoKSksIGhhID0gKGUsIGksIHQsIG4pPT57CiAgICBsZXQgYSA9IF9hLCBsID0gbiArIHQ7CiAgICBlIF49IC0xOwogICAgZm9yKGxldCBvID0gbjsgbyA8IGw7IG8rKyllID0gZSA+Pj4gOCBeIGFbKGUgXiBpW29dKSAmIDI1NV07CiAgICByZXR1cm4gZSBeIC0xOwp9LCBJID0gaGEsIGVlID0gewogICAgMjogIm5lZWQgZGljdGlvbmFyeSIsCiAgICAxOiAic3RyZWFtIGVuZCIsCiAgICAwOiAiIiwKICAgICItMSI6ICJmaWxlIGVycm9yIiwKICAgICItMiI6ICJzdHJlYW0gZXJyb3IiLAogICAgIi0zIjogImRhdGEgZXJyb3IiLAogICAgIi00IjogImluc3VmZmljaWVudCBtZW1vcnkiLAogICAgIi01IjogImJ1ZmZlciBlcnJvciIsCiAgICAiLTYiOiAiaW5jb21wYXRpYmxlIHZlcnNpb24iCn0sIG5lID0gewogICAgWl9OT19GTFVTSDogMCwKICAgIFpfUEFSVElBTF9GTFVTSDogMSwKICAgIFpfU1lOQ19GTFVTSDogMiwKICAgIFpfRlVMTF9GTFVTSDogMywKICAgIFpfRklOSVNIOiA0LAogICAgWl9CTE9DSzogNSwKICAgIFpfVFJFRVM6IDYsCiAgICBaX09LOiAwLAogICAgWl9TVFJFQU1fRU5EOiAxLAogICAgWl9ORUVEX0RJQ1Q6IDIsCiAgICBaX0VSUk5POiAtMSwKICAgIFpfU1RSRUFNX0VSUk9SOiAtMiwKICAgIFpfREFUQV9FUlJPUjogLTMsCiAgICBaX01FTV9FUlJPUjogLTQsCiAgICBaX0JVRl9FUlJPUjogLTUsCiAgICBaX05PX0NPTVBSRVNTSU9OOiAwLAogICAgWl9CRVNUX1NQRUVEOiAxLAogICAgWl9CRVNUX0NPTVBSRVNTSU9OOiA5LAogICAgWl9ERUZBVUxUX0NPTVBSRVNTSU9OOiAtMSwKICAgIFpfRklMVEVSRUQ6IDEsCiAgICBaX0hVRkZNQU5fT05MWTogMiwKICAgIFpfUkxFOiAzLAogICAgWl9GSVhFRDogNCwKICAgIFpfREVGQVVMVF9TVFJBVEVHWTogMCwKICAgIFpfQklOQVJZOiAwLAogICAgWl9URVhUOiAxLAogICAgWl9VTktOT1dOOiAyLAogICAgWl9ERUZMQVRFRDogOAp9LCB7IF90cl9pbml0OiBkYSAsIF90cl9zdG9yZWRfYmxvY2s6IHNhICwgX3RyX2ZsdXNoX2Jsb2NrOiBjYSAsIF90cl90YWxseTogaiAsIF90cl9hbGlnbjogdWEgIH0gPSByYSwgeyBaX05PX0ZMVVNIOiBsZSAsIFpfUEFSVElBTF9GTFVTSDogYmEgLCBaX0ZVTExfRkxVU0g6IHdhICwgWl9GSU5JU0g6IFcgLCBaX0JMT0NLOiBTdCAsIFpfT0s6IE0gLCBaX1NUUkVBTV9FTkQ6IEF0ICwgWl9TVFJFQU1fRVJST1I6IEwxICwgWl9EQVRBX0VSUk9SOiBnYSAsIFpfQlVGX0VSUk9SOiBKZSAsIFpfREVGQVVMVF9DT01QUkVTU0lPTjogcGEgLCBaX0ZJTFRFUkVEOiB4YSAsIFpfSFVGRk1BTl9PTkxZOiBJZSAsIFpfUkxFOiBrYSAsIFpfRklYRUQ6IHZhICwgWl9ERUZBVUxUX1NUUkFURUdZOiBFYSAsIFpfVU5LTk9XTjogeWEgLCBaX0RFRkxBVEVEOiBQZSAgfSA9IG5lLCBTYSA9IDksIEFhID0gMTUsIFJhID0gOCwgemEgPSAyOSwgVGEgPSAyNTYsIF90ID0gVGEgKyAxICsgemEsIG1hID0gMzAsIERhID0gMTksIFphID0gMiAqIF90ICsgMSwgSWEgPSAxNSwgazEgPSAzLCBZID0gMjU4LCAkID0gWSArIGsxICsgMSwgT2EgPSAzMiwgWGUgPSA0MiwgaHQgPSA2OSwgQ2UgPSA3MywgRmUgPSA5MSwgTWUgPSAxMDMsIHEgPSAxMTMsIHNlID0gNjY2LCBEID0gMSwgUmUgPSAyLCB0ZSA9IDMsIGhlID0gNCwgTmEgPSAzLCBHID0gKGUsIGkpPT4oZS5tc2cgPSBlZVtpXSwgaSksIFJ0ID0gKGUpPT4oZSA8PCAxKSAtIChlID4gNCA/IDkgOiAwKSwgWCA9IChlKT0+ewogICAgbGV0IGkgPSBlLmxlbmd0aDsKICAgIGZvcig7IC0taSA+PSAwOyllW2ldID0gMDsKfSwgTGEgPSAoZSwgaSwgdCk9PihpIDw8IGUuaGFzaF9zaGlmdCBeIHQpICYgZS5oYXNoX21hc2ssIFYgPSBMYSwgUDEgPSAoZSk9PnsKICAgIGxldCBpID0gZS5zdGF0ZSwgdCA9IGkucGVuZGluZzsKICAgIHQgPiBlLmF2YWlsX291dCAmJiAodCA9IGUuYXZhaWxfb3V0KSwgdCAhPT0gMCAmJiAoZS5vdXRwdXQuc2V0KGkucGVuZGluZ19idWYuc3ViYXJyYXkoaS5wZW5kaW5nX291dCwgaS5wZW5kaW5nX291dCArIHQpLCBlLm5leHRfb3V0KSwgZS5uZXh0X291dCArPSB0LCBpLnBlbmRpbmdfb3V0ICs9IHQsIGUudG90YWxfb3V0ICs9IHQsIGUuYXZhaWxfb3V0IC09IHQsIGkucGVuZGluZyAtPSB0LCBpLnBlbmRpbmcgPT09IDAgJiYgKGkucGVuZGluZ19vdXQgPSAwKSk7Cn0sIE8xID0gKGUsIGkpPT57CiAgICBjYShlLCBlLmJsb2NrX3N0YXJ0ID49IDAgPyBlLmJsb2NrX3N0YXJ0IDogLTEsIGUuc3Ryc3RhcnQgLSBlLmJsb2NrX3N0YXJ0LCBpKSwgZS5ibG9ja19zdGFydCA9IGUuc3Ryc3RhcnQsIFAxKGUuc3RybSk7Cn0sIHkgPSAoZSwgaSk9PnsKICAgIGUucGVuZGluZ19idWZbZS5wZW5kaW5nKytdID0gaTsKfSwgZGUgPSAoZSwgaSk9PnsKICAgIGUucGVuZGluZ19idWZbZS5wZW5kaW5nKytdID0gaSA+Pj4gOCAmIDI1NSwgZS5wZW5kaW5nX2J1ZltlLnBlbmRpbmcrK10gPSBpICYgMjU1Owp9LCBVYSA9IChlLCBpLCB0LCBuKT0+ewogICAgbGV0IGEgPSBlLmF2YWlsX2luOwogICAgcmV0dXJuIGEgPiBuICYmIChhID0gbiksIGEgPT09IDAgPyAwIDogKGUuYXZhaWxfaW4gLT0gYSwgaS5zZXQoZS5pbnB1dC5zdWJhcnJheShlLm5leHRfaW4sIGUubmV4dF9pbiArIGEpLCB0KSwgZS5zdGF0ZS53cmFwID09PSAxID8gZS5hZGxlciA9IHZlKGUuYWRsZXIsIGksIGEsIHQpIDogZS5zdGF0ZS53cmFwID09PSAyICYmIChlLmFkbGVyID0gSShlLmFkbGVyLCBpLCBhLCB0KSksIGUubmV4dF9pbiArPSBhLCBlLnRvdGFsX2luICs9IGEsIGEpOwp9LCBwaSA9IChlLCBpKT0+ewogICAgbGV0IHQgPSBlLm1heF9jaGFpbl9sZW5ndGgsIG4gPSBlLnN0cnN0YXJ0LCBhLCBsLCBvID0gZS5wcmV2X2xlbmd0aCwgZiA9IGUubmljZV9tYXRjaCwgYyA9IGUuc3Ryc3RhcnQgPiBlLndfc2l6ZSAtICQgPyBlLnN0cnN0YXJ0IC0gKGUud19zaXplIC0gJCkgOiAwLCByID0gZS53aW5kb3csIF8gPSBlLndfbWFzaywgRSA9IGUucHJldiwgcyA9IGUuc3Ryc3RhcnQgKyBZLCBoID0gcltuICsgbyAtIDFdLCB1ID0gcltuICsgb107CiAgICBlLnByZXZfbGVuZ3RoID49IGUuZ29vZF9tYXRjaCAmJiAodCA+Pj0gMiksIGYgPiBlLmxvb2thaGVhZCAmJiAoZiA9IGUubG9va2FoZWFkKTsKICAgIGRvIGlmIChhID0gaSwgIShyW2EgKyBvXSAhPT0gdSB8fCByW2EgKyBvIC0gMV0gIT09IGggfHwgclthXSAhPT0gcltuXSB8fCByWysrYV0gIT09IHJbbiArIDFdKSkgewogICAgICAgIG4gKz0gMiwgYSsrOwogICAgICAgIGRvIDsKICAgICAgICB3aGlsZSAoclsrK25dID09PSByWysrYV0gJiYgclsrK25dID09PSByWysrYV0gJiYgclsrK25dID09PSByWysrYV0gJiYgclsrK25dID09PSByWysrYV0gJiYgclsrK25dID09PSByWysrYV0gJiYgclsrK25dID09PSByWysrYV0gJiYgclsrK25dID09PSByWysrYV0gJiYgclsrK25dID09PSByWysrYV0gJiYgbiA8IHMpCiAgICAgICAgaWYgKGwgPSBZIC0gKHMgLSBuKSwgbiA9IHMgLSBZLCBsID4gbykgewogICAgICAgICAgICBpZiAoZS5tYXRjaF9zdGFydCA9IGksIG8gPSBsLCBsID49IGYpIGJyZWFrOwogICAgICAgICAgICBoID0gcltuICsgbyAtIDFdLCB1ID0gcltuICsgb107CiAgICAgICAgfQogICAgfQogICAgd2hpbGUgKChpID0gRVtpICYgX10pID4gYyAmJiAtLXQgIT09IDApCiAgICByZXR1cm4gbyA8PSBlLmxvb2thaGVhZCA/IG8gOiBlLmxvb2thaGVhZDsKfSwgaWUgPSAoZSk9PnsKICAgIGxldCBpID0gZS53X3NpemUsIHQsIG4sIGEsIGwsIG87CiAgICBkbyB7CiAgICAgICAgaWYgKGwgPSBlLndpbmRvd19zaXplIC0gZS5sb29rYWhlYWQgLSBlLnN0cnN0YXJ0LCBlLnN0cnN0YXJ0ID49IGkgKyAoaSAtICQpKSB7CiAgICAgICAgICAgIGUud2luZG93LnNldChlLndpbmRvdy5zdWJhcnJheShpLCBpICsgaSksIDApLCBlLm1hdGNoX3N0YXJ0IC09IGksIGUuc3Ryc3RhcnQgLT0gaSwgZS5ibG9ja19zdGFydCAtPSBpLCBuID0gZS5oYXNoX3NpemUsIHQgPSBuOwogICAgICAgICAgICBkbyBhID0gZS5oZWFkWy0tdF0sIGUuaGVhZFt0XSA9IGEgPj0gaSA/IGEgLSBpIDogMDsKICAgICAgICAgICAgd2hpbGUgKC0tbikKICAgICAgICAgICAgbiA9IGksIHQgPSBuOwogICAgICAgICAgICBkbyBhID0gZS5wcmV2Wy0tdF0sIGUucHJldlt0XSA9IGEgPj0gaSA/IGEgLSBpIDogMDsKICAgICAgICAgICAgd2hpbGUgKC0tbikKICAgICAgICAgICAgbCArPSBpOwogICAgICAgIH0KICAgICAgICBpZiAoZS5zdHJtLmF2YWlsX2luID09PSAwKSBicmVhazsKICAgICAgICBpZiAobiA9IFVhKGUuc3RybSwgZS53aW5kb3csIGUuc3Ryc3RhcnQgKyBlLmxvb2thaGVhZCwgbCksIGUubG9va2FoZWFkICs9IG4sIGUubG9va2FoZWFkICsgZS5pbnNlcnQgPj0gazEpIGZvcihvID0gZS5zdHJzdGFydCAtIGUuaW5zZXJ0LCBlLmluc19oID0gZS53aW5kb3dbb10sIGUuaW5zX2ggPSBWKGUsIGUuaW5zX2gsIGUud2luZG93W28gKyAxXSk7IGUuaW5zZXJ0ICYmIChlLmluc19oID0gVihlLCBlLmluc19oLCBlLndpbmRvd1tvICsgazEgLSAxXSksIGUucHJldltvICYgZS53X21hc2tdID0gZS5oZWFkW2UuaW5zX2hdLCBlLmhlYWRbZS5pbnNfaF0gPSBvLCBvKyssIGUuaW5zZXJ0LS0sICEoZS5sb29rYWhlYWQgKyBlLmluc2VydCA8IGsxKSk7KTsKICAgIH13aGlsZSAoZS5sb29rYWhlYWQgPCAkICYmIGUuc3RybS5hdmFpbF9pbiAhPT0gMCkKfSwgJGEgPSAoZSwgaSk9PnsKICAgIGxldCB0ID0gNjU1MzU7CiAgICBmb3IodCA+IGUucGVuZGluZ19idWZfc2l6ZSAtIDUgJiYgKHQgPSBlLnBlbmRpbmdfYnVmX3NpemUgLSA1KTs7KXsKICAgICAgICBpZiAoZS5sb29rYWhlYWQgPD0gMSkgewogICAgICAgICAgICBpZiAoaWUoZSksIGUubG9va2FoZWFkID09PSAwICYmIGkgPT09IGxlKSByZXR1cm4gRDsKICAgICAgICAgICAgaWYgKGUubG9va2FoZWFkID09PSAwKSBicmVhazsKICAgICAgICB9CiAgICAgICAgZS5zdHJzdGFydCArPSBlLmxvb2thaGVhZCwgZS5sb29rYWhlYWQgPSAwOwogICAgICAgIGxldCBuID0gZS5ibG9ja19zdGFydCArIHQ7CiAgICAgICAgaWYgKChlLnN0cnN0YXJ0ID09PSAwIHx8IGUuc3Ryc3RhcnQgPj0gbikgJiYgKGUubG9va2FoZWFkID0gZS5zdHJzdGFydCAtIG4sIGUuc3Ryc3RhcnQgPSBuLCBPMShlLCAhMSksIGUuc3RybS5hdmFpbF9vdXQgPT09IDApIHx8IGUuc3Ryc3RhcnQgLSBlLmJsb2NrX3N0YXJ0ID49IGUud19zaXplIC0gJCAmJiAoTzEoZSwgITEpLCBlLnN0cm0uYXZhaWxfb3V0ID09PSAwKSkgcmV0dXJuIEQ7CiAgICB9CiAgICByZXR1cm4gZS5pbnNlcnQgPSAwLCBpID09PSBXID8gKE8xKGUsICEwKSwgZS5zdHJtLmF2YWlsX291dCA9PT0gMCA/IHRlIDogaGUpIDogKGUuc3Ryc3RhcnQgPiBlLmJsb2NrX3N0YXJ0ICYmIChPMShlLCAhMSksIGUuc3RybS5hdmFpbF9vdXQgPT09IDApLCBEKTsKfSwgUWUgPSAoZSwgaSk9PnsKICAgIGxldCB0LCBuOwogICAgZm9yKDs7KXsKICAgICAgICBpZiAoZS5sb29rYWhlYWQgPCAkKSB7CiAgICAgICAgICAgIGlmIChpZShlKSwgZS5sb29rYWhlYWQgPCAkICYmIGkgPT09IGxlKSByZXR1cm4gRDsKICAgICAgICAgICAgaWYgKGUubG9va2FoZWFkID09PSAwKSBicmVhazsKICAgICAgICB9CiAgICAgICAgaWYgKHQgPSAwLCBlLmxvb2thaGVhZCA+PSBrMSAmJiAoZS5pbnNfaCA9IFYoZSwgZS5pbnNfaCwgZS53aW5kb3dbZS5zdHJzdGFydCArIGsxIC0gMV0pLCB0ID0gZS5wcmV2W2Uuc3Ryc3RhcnQgJiBlLndfbWFza10gPSBlLmhlYWRbZS5pbnNfaF0sIGUuaGVhZFtlLmluc19oXSA9IGUuc3Ryc3RhcnQpLCB0ICE9PSAwICYmIGUuc3Ryc3RhcnQgLSB0IDw9IGUud19zaXplIC0gJCAmJiAoZS5tYXRjaF9sZW5ndGggPSBwaShlLCB0KSksIGUubWF0Y2hfbGVuZ3RoID49IGsxKSBpZiAobiA9IGooZSwgZS5zdHJzdGFydCAtIGUubWF0Y2hfc3RhcnQsIGUubWF0Y2hfbGVuZ3RoIC0gazEpLCBlLmxvb2thaGVhZCAtPSBlLm1hdGNoX2xlbmd0aCwgZS5tYXRjaF9sZW5ndGggPD0gZS5tYXhfbGF6eV9tYXRjaCAmJiBlLmxvb2thaGVhZCA+PSBrMSkgewogICAgICAgICAgICBlLm1hdGNoX2xlbmd0aC0tOwogICAgICAgICAgICBkbyBlLnN0cnN0YXJ0KyssIGUuaW5zX2ggPSBWKGUsIGUuaW5zX2gsIGUud2luZG93W2Uuc3Ryc3RhcnQgKyBrMSAtIDFdKSwgdCA9IGUucHJldltlLnN0cnN0YXJ0ICYgZS53X21hc2tdID0gZS5oZWFkW2UuaW5zX2hdLCBlLmhlYWRbZS5pbnNfaF0gPSBlLnN0cnN0YXJ0OwogICAgICAgICAgICB3aGlsZSAoLS1lLm1hdGNoX2xlbmd0aCAhPT0gMCkKICAgICAgICAgICAgZS5zdHJzdGFydCsrOwogICAgICAgIH0gZWxzZSBlLnN0cnN0YXJ0ICs9IGUubWF0Y2hfbGVuZ3RoLCBlLm1hdGNoX2xlbmd0aCA9IDAsIGUuaW5zX2ggPSBlLndpbmRvd1tlLnN0cnN0YXJ0XSwgZS5pbnNfaCA9IFYoZSwgZS5pbnNfaCwgZS53aW5kb3dbZS5zdHJzdGFydCArIDFdKTsKICAgICAgICBlbHNlIG4gPSBqKGUsIDAsIGUud2luZG93W2Uuc3Ryc3RhcnRdKSwgZS5sb29rYWhlYWQtLSwgZS5zdHJzdGFydCsrOwogICAgICAgIGlmIChuICYmIChPMShlLCAhMSksIGUuc3RybS5hdmFpbF9vdXQgPT09IDApKSByZXR1cm4gRDsKICAgIH0KICAgIHJldHVybiBlLmluc2VydCA9IGUuc3Ryc3RhcnQgPCBrMSAtIDEgPyBlLnN0cnN0YXJ0IDogazEgLSAxLCBpID09PSBXID8gKE8xKGUsICEwKSwgZS5zdHJtLmF2YWlsX291dCA9PT0gMCA/IHRlIDogaGUpIDogZS5sYXN0X2xpdCAmJiAoTzEoZSwgITEpLCBlLnN0cm0uYXZhaWxfb3V0ID09PSAwKSA/IEQgOiBSZTsKfSwgcmUgPSAoZSwgaSk9PnsKICAgIGxldCB0LCBuLCBhOwogICAgZm9yKDs7KXsKICAgICAgICBpZiAoZS5sb29rYWhlYWQgPCAkKSB7CiAgICAgICAgICAgIGlmIChpZShlKSwgZS5sb29rYWhlYWQgPCAkICYmIGkgPT09IGxlKSByZXR1cm4gRDsKICAgICAgICAgICAgaWYgKGUubG9va2FoZWFkID09PSAwKSBicmVhazsKICAgICAgICB9CiAgICAgICAgaWYgKHQgPSAwLCBlLmxvb2thaGVhZCA+PSBrMSAmJiAoZS5pbnNfaCA9IFYoZSwgZS5pbnNfaCwgZS53aW5kb3dbZS5zdHJzdGFydCArIGsxIC0gMV0pLCB0ID0gZS5wcmV2W2Uuc3Ryc3RhcnQgJiBlLndfbWFza10gPSBlLmhlYWRbZS5pbnNfaF0sIGUuaGVhZFtlLmluc19oXSA9IGUuc3Ryc3RhcnQpLCBlLnByZXZfbGVuZ3RoID0gZS5tYXRjaF9sZW5ndGgsIGUucHJldl9tYXRjaCA9IGUubWF0Y2hfc3RhcnQsIGUubWF0Y2hfbGVuZ3RoID0gazEgLSAxLCB0ICE9PSAwICYmIGUucHJldl9sZW5ndGggPCBlLm1heF9sYXp5X21hdGNoICYmIGUuc3Ryc3RhcnQgLSB0IDw9IGUud19zaXplIC0gJCAmJiAoZS5tYXRjaF9sZW5ndGggPSBwaShlLCB0KSwgZS5tYXRjaF9sZW5ndGggPD0gNSAmJiAoZS5zdHJhdGVneSA9PT0geGEgfHwgZS5tYXRjaF9sZW5ndGggPT09IGsxICYmIGUuc3Ryc3RhcnQgLSBlLm1hdGNoX3N0YXJ0ID4gNDA5NikgJiYgKGUubWF0Y2hfbGVuZ3RoID0gazEgLSAxKSksIGUucHJldl9sZW5ndGggPj0gazEgJiYgZS5tYXRjaF9sZW5ndGggPD0gZS5wcmV2X2xlbmd0aCkgewogICAgICAgICAgICBhID0gZS5zdHJzdGFydCArIGUubG9va2FoZWFkIC0gazEsIG4gPSBqKGUsIGUuc3Ryc3RhcnQgLSAxIC0gZS5wcmV2X21hdGNoLCBlLnByZXZfbGVuZ3RoIC0gazEpLCBlLmxvb2thaGVhZCAtPSBlLnByZXZfbGVuZ3RoIC0gMSwgZS5wcmV2X2xlbmd0aCAtPSAyOwogICAgICAgICAgICBkbyArK2Uuc3Ryc3RhcnQgPD0gYSAmJiAoZS5pbnNfaCA9IFYoZSwgZS5pbnNfaCwgZS53aW5kb3dbZS5zdHJzdGFydCArIGsxIC0gMV0pLCB0ID0gZS5wcmV2W2Uuc3Ryc3RhcnQgJiBlLndfbWFza10gPSBlLmhlYWRbZS5pbnNfaF0sIGUuaGVhZFtlLmluc19oXSA9IGUuc3Ryc3RhcnQpOwogICAgICAgICAgICB3aGlsZSAoLS1lLnByZXZfbGVuZ3RoICE9PSAwKQogICAgICAgICAgICBpZiAoZS5tYXRjaF9hdmFpbGFibGUgPSAwLCBlLm1hdGNoX2xlbmd0aCA9IGsxIC0gMSwgZS5zdHJzdGFydCsrLCBuICYmIChPMShlLCAhMSksIGUuc3RybS5hdmFpbF9vdXQgPT09IDApKSByZXR1cm4gRDsKICAgICAgICB9IGVsc2UgaWYgKGUubWF0Y2hfYXZhaWxhYmxlKSB7CiAgICAgICAgICAgIGlmIChuID0gaihlLCAwLCBlLndpbmRvd1tlLnN0cnN0YXJ0IC0gMV0pLCBuICYmIE8xKGUsICExKSwgZS5zdHJzdGFydCsrLCBlLmxvb2thaGVhZC0tLCBlLnN0cm0uYXZhaWxfb3V0ID09PSAwKSByZXR1cm4gRDsKICAgICAgICB9IGVsc2UgZS5tYXRjaF9hdmFpbGFibGUgPSAxLCBlLnN0cnN0YXJ0KyssIGUubG9va2FoZWFkLS07CiAgICB9CiAgICByZXR1cm4gZS5tYXRjaF9hdmFpbGFibGUgJiYgKG4gPSBqKGUsIDAsIGUud2luZG93W2Uuc3Ryc3RhcnQgLSAxXSksIGUubWF0Y2hfYXZhaWxhYmxlID0gMCksIGUuaW5zZXJ0ID0gZS5zdHJzdGFydCA8IGsxIC0gMSA/IGUuc3Ryc3RhcnQgOiBrMSAtIDEsIGkgPT09IFcgPyAoTzEoZSwgITApLCBlLnN0cm0uYXZhaWxfb3V0ID09PSAwID8gdGUgOiBoZSkgOiBlLmxhc3RfbGl0ICYmIChPMShlLCAhMSksIGUuc3RybS5hdmFpbF9vdXQgPT09IDApID8gRCA6IFJlOwp9LCBDYSA9IChlLCBpKT0+ewogICAgbGV0IHQsIG4sIGEsIGwsIG8gPSBlLndpbmRvdzsKICAgIGZvcig7Oyl7CiAgICAgICAgaWYgKGUubG9va2FoZWFkIDw9IFkpIHsKICAgICAgICAgICAgaWYgKGllKGUpLCBlLmxvb2thaGVhZCA8PSBZICYmIGkgPT09IGxlKSByZXR1cm4gRDsKICAgICAgICAgICAgaWYgKGUubG9va2FoZWFkID09PSAwKSBicmVhazsKICAgICAgICB9CiAgICAgICAgaWYgKGUubWF0Y2hfbGVuZ3RoID0gMCwgZS5sb29rYWhlYWQgPj0gazEgJiYgZS5zdHJzdGFydCA+IDAgJiYgKGEgPSBlLnN0cnN0YXJ0IC0gMSwgbiA9IG9bYV0sIG4gPT09IG9bKythXSAmJiBuID09PSBvWysrYV0gJiYgbiA9PT0gb1srK2FdKSkgewogICAgICAgICAgICBsID0gZS5zdHJzdGFydCArIFk7CiAgICAgICAgICAgIGRvIDsKICAgICAgICAgICAgd2hpbGUgKG4gPT09IG9bKythXSAmJiBuID09PSBvWysrYV0gJiYgbiA9PT0gb1srK2FdICYmIG4gPT09IG9bKythXSAmJiBuID09PSBvWysrYV0gJiYgbiA9PT0gb1srK2FdICYmIG4gPT09IG9bKythXSAmJiBuID09PSBvWysrYV0gJiYgYSA8IGwpCiAgICAgICAgICAgIGUubWF0Y2hfbGVuZ3RoID0gWSAtIChsIC0gYSksIGUubWF0Y2hfbGVuZ3RoID4gZS5sb29rYWhlYWQgJiYgKGUubWF0Y2hfbGVuZ3RoID0gZS5sb29rYWhlYWQpOwogICAgICAgIH0KICAgICAgICBpZiAoZS5tYXRjaF9sZW5ndGggPj0gazEgPyAodCA9IGooZSwgMSwgZS5tYXRjaF9sZW5ndGggLSBrMSksIGUubG9va2FoZWFkIC09IGUubWF0Y2hfbGVuZ3RoLCBlLnN0cnN0YXJ0ICs9IGUubWF0Y2hfbGVuZ3RoLCBlLm1hdGNoX2xlbmd0aCA9IDApIDogKHQgPSBqKGUsIDAsIGUud2luZG93W2Uuc3Ryc3RhcnRdKSwgZS5sb29rYWhlYWQtLSwgZS5zdHJzdGFydCsrKSwgdCAmJiAoTzEoZSwgITEpLCBlLnN0cm0uYXZhaWxfb3V0ID09PSAwKSkgcmV0dXJuIEQ7CiAgICB9CiAgICByZXR1cm4gZS5pbnNlcnQgPSAwLCBpID09PSBXID8gKE8xKGUsICEwKSwgZS5zdHJtLmF2YWlsX291dCA9PT0gMCA/IHRlIDogaGUpIDogZS5sYXN0X2xpdCAmJiAoTzEoZSwgITEpLCBlLnN0cm0uYXZhaWxfb3V0ID09PSAwKSA/IEQgOiBSZTsKfSwgRmEgPSAoZSwgaSk9PnsKICAgIGxldCB0OwogICAgZm9yKDs7KXsKICAgICAgICBpZiAoZS5sb29rYWhlYWQgPT09IDAgJiYgKGllKGUpLCBlLmxvb2thaGVhZCA9PT0gMCkpIHsKICAgICAgICAgICAgaWYgKGkgPT09IGxlKSByZXR1cm4gRDsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIGlmIChlLm1hdGNoX2xlbmd0aCA9IDAsIHQgPSBqKGUsIDAsIGUud2luZG93W2Uuc3Ryc3RhcnRdKSwgZS5sb29rYWhlYWQtLSwgZS5zdHJzdGFydCsrLCB0ICYmIChPMShlLCAhMSksIGUuc3RybS5hdmFpbF9vdXQgPT09IDApKSByZXR1cm4gRDsKICAgIH0KICAgIHJldHVybiBlLmluc2VydCA9IDAsIGkgPT09IFcgPyAoTzEoZSwgITApLCBlLnN0cm0uYXZhaWxfb3V0ID09PSAwID8gdGUgOiBoZSkgOiBlLmxhc3RfbGl0ICYmIChPMShlLCAhMSksIGUuc3RybS5hdmFpbF9vdXQgPT09IDApID8gRCA6IFJlOwp9OwpmdW5jdGlvbiBDMShlLCBpLCB0LCBuLCBhKSB7CiAgICB0aGlzLmdvb2RfbGVuZ3RoID0gZSwgdGhpcy5tYXhfbGF6eSA9IGksIHRoaXMubmljZV9sZW5ndGggPSB0LCB0aGlzLm1heF9jaGFpbiA9IG4sIHRoaXMuZnVuYyA9IGE7Cn0KdmFyIGNlID0gWwogICAgbmV3IEMxKDAsIDAsIDAsIDAsICRhKSwKICAgIG5ldyBDMSg0LCA0LCA4LCA0LCBRZSksCiAgICBuZXcgQzEoNCwgNSwgMTYsIDgsIFFlKSwKICAgIG5ldyBDMSg0LCA2LCAzMiwgMzIsIFFlKSwKICAgIG5ldyBDMSg0LCA0LCAxNiwgMTYsIHJlKSwKICAgIG5ldyBDMSg4LCAxNiwgMzIsIDMyLCByZSksCiAgICBuZXcgQzEoOCwgMTYsIDEyOCwgMTI4LCByZSksCiAgICBuZXcgQzEoOCwgMzIsIDEyOCwgMjU2LCByZSksCiAgICBuZXcgQzEoMzIsIDEyOCwgMjU4LCAxMDI0LCByZSksCiAgICBuZXcgQzEoMzIsIDI1OCwgMjU4LCA0MDk2LCByZSkKXSwgTWEgPSAoZSk9PnsKICAgIGUud2luZG93X3NpemUgPSAyICogZS53X3NpemUsIFgoZS5oZWFkKSwgZS5tYXhfbGF6eV9tYXRjaCA9IGNlW2UubGV2ZWxdLm1heF9sYXp5LCBlLmdvb2RfbWF0Y2ggPSBjZVtlLmxldmVsXS5nb29kX2xlbmd0aCwgZS5uaWNlX21hdGNoID0gY2VbZS5sZXZlbF0ubmljZV9sZW5ndGgsIGUubWF4X2NoYWluX2xlbmd0aCA9IGNlW2UubGV2ZWxdLm1heF9jaGFpbiwgZS5zdHJzdGFydCA9IDAsIGUuYmxvY2tfc3RhcnQgPSAwLCBlLmxvb2thaGVhZCA9IDAsIGUuaW5zZXJ0ID0gMCwgZS5tYXRjaF9sZW5ndGggPSBlLnByZXZfbGVuZ3RoID0gazEgLSAxLCBlLm1hdGNoX2F2YWlsYWJsZSA9IDAsIGUuaW5zX2ggPSAwOwp9OwpmdW5jdGlvbiBIYSgpIHsKICAgIHRoaXMuc3RybSA9IG51bGwsIHRoaXMuc3RhdHVzID0gMCwgdGhpcy5wZW5kaW5nX2J1ZiA9IG51bGwsIHRoaXMucGVuZGluZ19idWZfc2l6ZSA9IDAsIHRoaXMucGVuZGluZ19vdXQgPSAwLCB0aGlzLnBlbmRpbmcgPSAwLCB0aGlzLndyYXAgPSAwLCB0aGlzLmd6aGVhZCA9IG51bGwsIHRoaXMuZ3ppbmRleCA9IDAsIHRoaXMubWV0aG9kID0gUGUsIHRoaXMubGFzdF9mbHVzaCA9IC0xLCB0aGlzLndfc2l6ZSA9IDAsIHRoaXMud19iaXRzID0gMCwgdGhpcy53X21hc2sgPSAwLCB0aGlzLndpbmRvdyA9IG51bGwsIHRoaXMud2luZG93X3NpemUgPSAwLCB0aGlzLnByZXYgPSBudWxsLCB0aGlzLmhlYWQgPSBudWxsLCB0aGlzLmluc19oID0gMCwgdGhpcy5oYXNoX3NpemUgPSAwLCB0aGlzLmhhc2hfYml0cyA9IDAsIHRoaXMuaGFzaF9tYXNrID0gMCwgdGhpcy5oYXNoX3NoaWZ0ID0gMCwgdGhpcy5ibG9ja19zdGFydCA9IDAsIHRoaXMubWF0Y2hfbGVuZ3RoID0gMCwgdGhpcy5wcmV2X21hdGNoID0gMCwgdGhpcy5tYXRjaF9hdmFpbGFibGUgPSAwLCB0aGlzLnN0cnN0YXJ0ID0gMCwgdGhpcy5tYXRjaF9zdGFydCA9IDAsIHRoaXMubG9va2FoZWFkID0gMCwgdGhpcy5wcmV2X2xlbmd0aCA9IDAsIHRoaXMubWF4X2NoYWluX2xlbmd0aCA9IDAsIHRoaXMubWF4X2xhenlfbWF0Y2ggPSAwLCB0aGlzLmxldmVsID0gMCwgdGhpcy5zdHJhdGVneSA9IDAsIHRoaXMuZ29vZF9tYXRjaCA9IDAsIHRoaXMubmljZV9tYXRjaCA9IDAsIHRoaXMuZHluX2x0cmVlID0gbmV3IFVpbnQxNkFycmF5KFphICogMiksIHRoaXMuZHluX2R0cmVlID0gbmV3IFVpbnQxNkFycmF5KCgyICogbWEgKyAxKSAqIDIpLCB0aGlzLmJsX3RyZWUgPSBuZXcgVWludDE2QXJyYXkoKDIgKiBEYSArIDEpICogMiksIFgodGhpcy5keW5fbHRyZWUpLCBYKHRoaXMuZHluX2R0cmVlKSwgWCh0aGlzLmJsX3RyZWUpLCB0aGlzLmxfZGVzYyA9IG51bGwsIHRoaXMuZF9kZXNjID0gbnVsbCwgdGhpcy5ibF9kZXNjID0gbnVsbCwgdGhpcy5ibF9jb3VudCA9IG5ldyBVaW50MTZBcnJheShJYSArIDEpLCB0aGlzLmhlYXAgPSBuZXcgVWludDE2QXJyYXkoMiAqIF90ICsgMSksIFgodGhpcy5oZWFwKSwgdGhpcy5oZWFwX2xlbiA9IDAsIHRoaXMuaGVhcF9tYXggPSAwLCB0aGlzLmRlcHRoID0gbmV3IFVpbnQxNkFycmF5KDIgKiBfdCArIDEpLCBYKHRoaXMuZGVwdGgpLCB0aGlzLmxfYnVmID0gMCwgdGhpcy5saXRfYnVmc2l6ZSA9IDAsIHRoaXMubGFzdF9saXQgPSAwLCB0aGlzLmRfYnVmID0gMCwgdGhpcy5vcHRfbGVuID0gMCwgdGhpcy5zdGF0aWNfbGVuID0gMCwgdGhpcy5tYXRjaGVzID0gMCwgdGhpcy5pbnNlcnQgPSAwLCB0aGlzLmJpX2J1ZiA9IDAsIHRoaXMuYmlfdmFsaWQgPSAwOwp9CnZhciB4aSA9IChlKT0+ewogICAgaWYgKCFlIHx8ICFlLnN0YXRlKSByZXR1cm4gRyhlLCBMMSk7CiAgICBlLnRvdGFsX2luID0gZS50b3RhbF9vdXQgPSAwLCBlLmRhdGFfdHlwZSA9IHlhOwogICAgbGV0IGkgPSBlLnN0YXRlOwogICAgcmV0dXJuIGkucGVuZGluZyA9IDAsIGkucGVuZGluZ19vdXQgPSAwLCBpLndyYXAgPCAwICYmIChpLndyYXAgPSAtaS53cmFwKSwgaS5zdGF0dXMgPSBpLndyYXAgPyBYZSA6IHEsIGUuYWRsZXIgPSBpLndyYXAgPT09IDIgPyAwIDogMSwgaS5sYXN0X2ZsdXNoID0gbGUsIGRhKGkpLCBNOwp9LCBraSA9IChlKT0+ewogICAgbGV0IGkgPSB4aShlKTsKICAgIHJldHVybiBpID09PSBNICYmIE1hKGUuc3RhdGUpLCBpOwp9LCBCYSA9IChlLCBpKT0+IWUgfHwgIWUuc3RhdGUgfHwgZS5zdGF0ZS53cmFwICE9PSAyID8gTDEgOiAoZS5zdGF0ZS5nemhlYWQgPSBpLCBNKSwgdmkgPSAoZSwgaSwgdCwgbiwgYSwgbCk9PnsKICAgIGlmICghZSkgcmV0dXJuIEwxOwogICAgbGV0IG8gPSAxOwogICAgaWYgKGkgPT09IHBhICYmIChpID0gNiksIG4gPCAwID8gKG8gPSAwLCBuID0gLW4pIDogbiA+IDE1ICYmIChvID0gMiwgbiAtPSAxNiksIGEgPCAxIHx8IGEgPiBTYSB8fCB0ICE9PSBQZSB8fCBuIDwgOCB8fCBuID4gMTUgfHwgaSA8IDAgfHwgaSA+IDkgfHwgbCA8IDAgfHwgbCA+IHZhKSByZXR1cm4gRyhlLCBMMSk7CiAgICBuID09PSA4ICYmIChuID0gOSk7CiAgICBsZXQgZiA9IG5ldyBIYTsKICAgIHJldHVybiBlLnN0YXRlID0gZiwgZi5zdHJtID0gZSwgZi53cmFwID0gbywgZi5nemhlYWQgPSBudWxsLCBmLndfYml0cyA9IG4sIGYud19zaXplID0gMSA8PCBmLndfYml0cywgZi53X21hc2sgPSBmLndfc2l6ZSAtIDEsIGYuaGFzaF9iaXRzID0gYSArIDcsIGYuaGFzaF9zaXplID0gMSA8PCBmLmhhc2hfYml0cywgZi5oYXNoX21hc2sgPSBmLmhhc2hfc2l6ZSAtIDEsIGYuaGFzaF9zaGlmdCA9IH5+KChmLmhhc2hfYml0cyArIGsxIC0gMSkgLyBrMSksIGYud2luZG93ID0gbmV3IFVpbnQ4QXJyYXkoZi53X3NpemUgKiAyKSwgZi5oZWFkID0gbmV3IFVpbnQxNkFycmF5KGYuaGFzaF9zaXplKSwgZi5wcmV2ID0gbmV3IFVpbnQxNkFycmF5KGYud19zaXplKSwgZi5saXRfYnVmc2l6ZSA9IDEgPDwgYSArIDYsIGYucGVuZGluZ19idWZfc2l6ZSA9IGYubGl0X2J1ZnNpemUgKiA0LCBmLnBlbmRpbmdfYnVmID0gbmV3IFVpbnQ4QXJyYXkoZi5wZW5kaW5nX2J1Zl9zaXplKSwgZi5kX2J1ZiA9IDEgKiBmLmxpdF9idWZzaXplLCBmLmxfYnVmID0gKDEgKyAyKSAqIGYubGl0X2J1ZnNpemUsIGYubGV2ZWwgPSBpLCBmLnN0cmF0ZWd5ID0gbCwgZi5tZXRob2QgPSB0LCBraShlKTsKfSwgS2EgPSAoZSwgaSk9PnZpKGUsIGksIFBlLCBBYSwgUmEsIEVhKSwgUGEgPSAoZSwgaSk9PnsKICAgIGxldCB0LCBuOwogICAgaWYgKCFlIHx8ICFlLnN0YXRlIHx8IGkgPiBTdCB8fCBpIDwgMCkgcmV0dXJuIGUgPyBHKGUsIEwxKSA6IEwxOwogICAgbGV0IGEgPSBlLnN0YXRlOwogICAgaWYgKCFlLm91dHB1dCB8fCAhZS5pbnB1dCAmJiBlLmF2YWlsX2luICE9PSAwIHx8IGEuc3RhdHVzID09PSBzZSAmJiBpICE9PSBXKSByZXR1cm4gRyhlLCBlLmF2YWlsX291dCA9PT0gMCA/IEplIDogTDEpOwogICAgYS5zdHJtID0gZTsKICAgIGxldCBsID0gYS5sYXN0X2ZsdXNoOwogICAgaWYgKGEubGFzdF9mbHVzaCA9IGksIGEuc3RhdHVzID09PSBYZSkgaWYgKGEud3JhcCA9PT0gMikgZS5hZGxlciA9IDAsIHkoYSwgMzEpLCB5KGEsIDEzOSksIHkoYSwgOCksIGEuZ3poZWFkID8gKHkoYSwgKGEuZ3poZWFkLnRleHQgPyAxIDogMCkgKyAoYS5nemhlYWQuaGNyYyA/IDIgOiAwKSArIChhLmd6aGVhZC5leHRyYSA/IDQgOiAwKSArIChhLmd6aGVhZC5uYW1lID8gOCA6IDApICsgKGEuZ3poZWFkLmNvbW1lbnQgPyAxNiA6IDApKSwgeShhLCBhLmd6aGVhZC50aW1lICYgMjU1KSwgeShhLCBhLmd6aGVhZC50aW1lID4+IDggJiAyNTUpLCB5KGEsIGEuZ3poZWFkLnRpbWUgPj4gMTYgJiAyNTUpLCB5KGEsIGEuZ3poZWFkLnRpbWUgPj4gMjQgJiAyNTUpLCB5KGEsIGEubGV2ZWwgPT09IDkgPyAyIDogYS5zdHJhdGVneSA+PSBJZSB8fCBhLmxldmVsIDwgMiA/IDQgOiAwKSwgeShhLCBhLmd6aGVhZC5vcyAmIDI1NSksIGEuZ3poZWFkLmV4dHJhICYmIGEuZ3poZWFkLmV4dHJhLmxlbmd0aCAmJiAoeShhLCBhLmd6aGVhZC5leHRyYS5sZW5ndGggJiAyNTUpLCB5KGEsIGEuZ3poZWFkLmV4dHJhLmxlbmd0aCA+PiA4ICYgMjU1KSksIGEuZ3poZWFkLmhjcmMgJiYgKGUuYWRsZXIgPSBJKGUuYWRsZXIsIGEucGVuZGluZ19idWYsIGEucGVuZGluZywgMCkpLCBhLmd6aW5kZXggPSAwLCBhLnN0YXR1cyA9IGh0KSA6ICh5KGEsIDApLCB5KGEsIDApLCB5KGEsIDApLCB5KGEsIDApLCB5KGEsIDApLCB5KGEsIGEubGV2ZWwgPT09IDkgPyAyIDogYS5zdHJhdGVneSA+PSBJZSB8fCBhLmxldmVsIDwgMiA/IDQgOiAwKSwgeShhLCBOYSksIGEuc3RhdHVzID0gcSk7CiAgICBlbHNlIHsKICAgICAgICBsZXQgbyA9IFBlICsgKGEud19iaXRzIC0gOCA8PCA0KSA8PCA4LCBmID0gLTE7CiAgICAgICAgYS5zdHJhdGVneSA+PSBJZSB8fCBhLmxldmVsIDwgMiA/IGYgPSAwIDogYS5sZXZlbCA8IDYgPyBmID0gMSA6IGEubGV2ZWwgPT09IDYgPyBmID0gMiA6IGYgPSAzLCBvIHw9IGYgPDwgNiwgYS5zdHJzdGFydCAhPT0gMCAmJiAobyB8PSBPYSksIG8gKz0gMzEgLSBvICUgMzEsIGEuc3RhdHVzID0gcSwgZGUoYSwgbyksIGEuc3Ryc3RhcnQgIT09IDAgJiYgKGRlKGEsIGUuYWRsZXIgPj4+IDE2KSwgZGUoYSwgZS5hZGxlciAmIDY1NTM1KSksIGUuYWRsZXIgPSAxOwogICAgfQogICAgaWYgKGEuc3RhdHVzID09PSBodCkgaWYgKGEuZ3poZWFkLmV4dHJhKSB7CiAgICAgICAgZm9yKHQgPSBhLnBlbmRpbmc7IGEuZ3ppbmRleCA8IChhLmd6aGVhZC5leHRyYS5sZW5ndGggJiA2NTUzNSkgJiYgIShhLnBlbmRpbmcgPT09IGEucGVuZGluZ19idWZfc2l6ZSAmJiAoYS5nemhlYWQuaGNyYyAmJiBhLnBlbmRpbmcgPiB0ICYmIChlLmFkbGVyID0gSShlLmFkbGVyLCBhLnBlbmRpbmdfYnVmLCBhLnBlbmRpbmcgLSB0LCB0KSksIFAxKGUpLCB0ID0gYS5wZW5kaW5nLCBhLnBlbmRpbmcgPT09IGEucGVuZGluZ19idWZfc2l6ZSkpOyl5KGEsIGEuZ3poZWFkLmV4dHJhW2EuZ3ppbmRleF0gJiAyNTUpLCBhLmd6aW5kZXgrKzsKICAgICAgICBhLmd6aGVhZC5oY3JjICYmIGEucGVuZGluZyA+IHQgJiYgKGUuYWRsZXIgPSBJKGUuYWRsZXIsIGEucGVuZGluZ19idWYsIGEucGVuZGluZyAtIHQsIHQpKSwgYS5nemluZGV4ID09PSBhLmd6aGVhZC5leHRyYS5sZW5ndGggJiYgKGEuZ3ppbmRleCA9IDAsIGEuc3RhdHVzID0gQ2UpOwogICAgfSBlbHNlIGEuc3RhdHVzID0gQ2U7CiAgICBpZiAoYS5zdGF0dXMgPT09IENlKSBpZiAoYS5nemhlYWQubmFtZSkgewogICAgICAgIHQgPSBhLnBlbmRpbmc7CiAgICAgICAgZG8gewogICAgICAgICAgICBpZiAoYS5wZW5kaW5nID09PSBhLnBlbmRpbmdfYnVmX3NpemUgJiYgKGEuZ3poZWFkLmhjcmMgJiYgYS5wZW5kaW5nID4gdCAmJiAoZS5hZGxlciA9IEkoZS5hZGxlciwgYS5wZW5kaW5nX2J1ZiwgYS5wZW5kaW5nIC0gdCwgdCkpLCBQMShlKSwgdCA9IGEucGVuZGluZywgYS5wZW5kaW5nID09PSBhLnBlbmRpbmdfYnVmX3NpemUpKSB7CiAgICAgICAgICAgICAgICBuID0gMTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGEuZ3ppbmRleCA8IGEuZ3poZWFkLm5hbWUubGVuZ3RoID8gbiA9IGEuZ3poZWFkLm5hbWUuY2hhckNvZGVBdChhLmd6aW5kZXgrKykgJiAyNTUgOiBuID0gMCwgeShhLCBuKTsKICAgICAgICB9d2hpbGUgKG4gIT09IDApCiAgICAgICAgYS5nemhlYWQuaGNyYyAmJiBhLnBlbmRpbmcgPiB0ICYmIChlLmFkbGVyID0gSShlLmFkbGVyLCBhLnBlbmRpbmdfYnVmLCBhLnBlbmRpbmcgLSB0LCB0KSksIG4gPT09IDAgJiYgKGEuZ3ppbmRleCA9IDAsIGEuc3RhdHVzID0gRmUpOwogICAgfSBlbHNlIGEuc3RhdHVzID0gRmU7CiAgICBpZiAoYS5zdGF0dXMgPT09IEZlKSBpZiAoYS5nemhlYWQuY29tbWVudCkgewogICAgICAgIHQgPSBhLnBlbmRpbmc7CiAgICAgICAgZG8gewogICAgICAgICAgICBpZiAoYS5wZW5kaW5nID09PSBhLnBlbmRpbmdfYnVmX3NpemUgJiYgKGEuZ3poZWFkLmhjcmMgJiYgYS5wZW5kaW5nID4gdCAmJiAoZS5hZGxlciA9IEkoZS5hZGxlciwgYS5wZW5kaW5nX2J1ZiwgYS5wZW5kaW5nIC0gdCwgdCkpLCBQMShlKSwgdCA9IGEucGVuZGluZywgYS5wZW5kaW5nID09PSBhLnBlbmRpbmdfYnVmX3NpemUpKSB7CiAgICAgICAgICAgICAgICBuID0gMTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGEuZ3ppbmRleCA8IGEuZ3poZWFkLmNvbW1lbnQubGVuZ3RoID8gbiA9IGEuZ3poZWFkLmNvbW1lbnQuY2hhckNvZGVBdChhLmd6aW5kZXgrKykgJiAyNTUgOiBuID0gMCwgeShhLCBuKTsKICAgICAgICB9d2hpbGUgKG4gIT09IDApCiAgICAgICAgYS5nemhlYWQuaGNyYyAmJiBhLnBlbmRpbmcgPiB0ICYmIChlLmFkbGVyID0gSShlLmFkbGVyLCBhLnBlbmRpbmdfYnVmLCBhLnBlbmRpbmcgLSB0LCB0KSksIG4gPT09IDAgJiYgKGEuc3RhdHVzID0gTWUpOwogICAgfSBlbHNlIGEuc3RhdHVzID0gTWU7CiAgICBpZiAoYS5zdGF0dXMgPT09IE1lICYmIChhLmd6aGVhZC5oY3JjID8gKGEucGVuZGluZyArIDIgPiBhLnBlbmRpbmdfYnVmX3NpemUgJiYgUDEoZSksIGEucGVuZGluZyArIDIgPD0gYS5wZW5kaW5nX2J1Zl9zaXplICYmICh5KGEsIGUuYWRsZXIgJiAyNTUpLCB5KGEsIGUuYWRsZXIgPj4gOCAmIDI1NSksIGUuYWRsZXIgPSAwLCBhLnN0YXR1cyA9IHEpKSA6IGEuc3RhdHVzID0gcSksIGEucGVuZGluZyAhPT0gMCkgewogICAgICAgIGlmIChQMShlKSwgZS5hdmFpbF9vdXQgPT09IDApIHJldHVybiBhLmxhc3RfZmx1c2ggPSAtMSwgTTsKICAgIH0gZWxzZSBpZiAoZS5hdmFpbF9pbiA9PT0gMCAmJiBSdChpKSA8PSBSdChsKSAmJiBpICE9PSBXKSByZXR1cm4gRyhlLCBKZSk7CiAgICBpZiAoYS5zdGF0dXMgPT09IHNlICYmIGUuYXZhaWxfaW4gIT09IDApIHJldHVybiBHKGUsIEplKTsKICAgIGlmIChlLmF2YWlsX2luICE9PSAwIHx8IGEubG9va2FoZWFkICE9PSAwIHx8IGkgIT09IGxlICYmIGEuc3RhdHVzICE9PSBzZSkgewogICAgICAgIGxldCBvID0gYS5zdHJhdGVneSA9PT0gSWUgPyBGYShhLCBpKSA6IGEuc3RyYXRlZ3kgPT09IGthID8gQ2EoYSwgaSkgOiBjZVthLmxldmVsXS5mdW5jKGEsIGkpOwogICAgICAgIGlmICgobyA9PT0gdGUgfHwgbyA9PT0gaGUpICYmIChhLnN0YXR1cyA9IHNlKSwgbyA9PT0gRCB8fCBvID09PSB0ZSkgcmV0dXJuIGUuYXZhaWxfb3V0ID09PSAwICYmIChhLmxhc3RfZmx1c2ggPSAtMSksIE07CiAgICAgICAgaWYgKG8gPT09IFJlICYmIChpID09PSBiYSA/IHVhKGEpIDogaSAhPT0gU3QgJiYgKHNhKGEsIDAsIDAsICExKSwgaSA9PT0gd2EgJiYgKFgoYS5oZWFkKSwgYS5sb29rYWhlYWQgPT09IDAgJiYgKGEuc3Ryc3RhcnQgPSAwLCBhLmJsb2NrX3N0YXJ0ID0gMCwgYS5pbnNlcnQgPSAwKSkpLCBQMShlKSwgZS5hdmFpbF9vdXQgPT09IDApKSByZXR1cm4gYS5sYXN0X2ZsdXNoID0gLTEsIE07CiAgICB9CiAgICByZXR1cm4gaSAhPT0gVyA/IE0gOiBhLndyYXAgPD0gMCA/IEF0IDogKGEud3JhcCA9PT0gMiA/ICh5KGEsIGUuYWRsZXIgJiAyNTUpLCB5KGEsIGUuYWRsZXIgPj4gOCAmIDI1NSksIHkoYSwgZS5hZGxlciA+PiAxNiAmIDI1NSksIHkoYSwgZS5hZGxlciA+PiAyNCAmIDI1NSksIHkoYSwgZS50b3RhbF9pbiAmIDI1NSksIHkoYSwgZS50b3RhbF9pbiA+PiA4ICYgMjU1KSwgeShhLCBlLnRvdGFsX2luID4+IDE2ICYgMjU1KSwgeShhLCBlLnRvdGFsX2luID4+IDI0ICYgMjU1KSkgOiAoZGUoYSwgZS5hZGxlciA+Pj4gMTYpLCBkZShhLCBlLmFkbGVyICYgNjU1MzUpKSwgUDEoZSksIGEud3JhcCA+IDAgJiYgKGEud3JhcCA9IC1hLndyYXApLCBhLnBlbmRpbmcgIT09IDAgPyBNIDogQXQpOwp9LCBYYSA9IChlKT0+ewogICAgaWYgKCFlIHx8ICFlLnN0YXRlKSByZXR1cm4gTDE7CiAgICBsZXQgaSA9IGUuc3RhdGUuc3RhdHVzOwogICAgcmV0dXJuIGkgIT09IFhlICYmIGkgIT09IGh0ICYmIGkgIT09IENlICYmIGkgIT09IEZlICYmIGkgIT09IE1lICYmIGkgIT09IHEgJiYgaSAhPT0gc2UgPyBHKGUsIEwxKSA6IChlLnN0YXRlID0gbnVsbCwgaSA9PT0gcSA/IEcoZSwgZ2EpIDogTSk7Cn0sIFlhID0gKGUsIGkpPT57CiAgICBsZXQgdCA9IGkubGVuZ3RoOwogICAgaWYgKCFlIHx8ICFlLnN0YXRlKSByZXR1cm4gTDE7CiAgICBsZXQgbiA9IGUuc3RhdGUsIGEgPSBuLndyYXA7CiAgICBpZiAoYSA9PT0gMiB8fCBhID09PSAxICYmIG4uc3RhdHVzICE9PSBYZSB8fCBuLmxvb2thaGVhZCkgcmV0dXJuIEwxOwogICAgaWYgKGEgPT09IDEgJiYgKGUuYWRsZXIgPSB2ZShlLmFkbGVyLCBpLCB0LCAwKSksIG4ud3JhcCA9IDAsIHQgPj0gbi53X3NpemUpIHsKICAgICAgICBhID09PSAwICYmIChYKG4uaGVhZCksIG4uc3Ryc3RhcnQgPSAwLCBuLmJsb2NrX3N0YXJ0ID0gMCwgbi5pbnNlcnQgPSAwKTsKICAgICAgICBsZXQgYyA9IG5ldyBVaW50OEFycmF5KG4ud19zaXplKTsKICAgICAgICBjLnNldChpLnN1YmFycmF5KHQgLSBuLndfc2l6ZSwgdCksIDApLCBpID0gYywgdCA9IG4ud19zaXplOwogICAgfQogICAgbGV0IGwgPSBlLmF2YWlsX2luLCBvID0gZS5uZXh0X2luLCBmID0gZS5pbnB1dDsKICAgIGZvcihlLmF2YWlsX2luID0gdCwgZS5uZXh0X2luID0gMCwgZS5pbnB1dCA9IGksIGllKG4pOyBuLmxvb2thaGVhZCA+PSBrMTspewogICAgICAgIGxldCBjID0gbi5zdHJzdGFydCwgciA9IG4ubG9va2FoZWFkIC0gKGsxIC0gMSk7CiAgICAgICAgZG8gbi5pbnNfaCA9IFYobiwgbi5pbnNfaCwgbi53aW5kb3dbYyArIGsxIC0gMV0pLCBuLnByZXZbYyAmIG4ud19tYXNrXSA9IG4uaGVhZFtuLmluc19oXSwgbi5oZWFkW24uaW5zX2hdID0gYywgYysrOwogICAgICAgIHdoaWxlICgtLXIpCiAgICAgICAgbi5zdHJzdGFydCA9IGMsIG4ubG9va2FoZWFkID0gazEgLSAxLCBpZShuKTsKICAgIH0KICAgIHJldHVybiBuLnN0cnN0YXJ0ICs9IG4ubG9va2FoZWFkLCBuLmJsb2NrX3N0YXJ0ID0gbi5zdHJzdGFydCwgbi5pbnNlcnQgPSBuLmxvb2thaGVhZCwgbi5sb29rYWhlYWQgPSAwLCBuLm1hdGNoX2xlbmd0aCA9IG4ucHJldl9sZW5ndGggPSBrMSAtIDEsIG4ubWF0Y2hfYXZhaWxhYmxlID0gMCwgZS5uZXh0X2luID0gbywgZS5pbnB1dCA9IGYsIGUuYXZhaWxfaW4gPSBsLCBuLndyYXAgPSBhLCBNOwp9LCBHYSA9IEthLCBqYSA9IHZpLCBXYSA9IGtpLCBWYSA9IHhpLCBKYSA9IEJhLCBRYSA9IFBhLCBxYSA9IFhhLCBlbiA9IFlhLCB0biA9ICJwYWtvIGRlZmxhdGUgKGZyb20gTm9kZWNhIHByb2plY3QpIiwgYmUgPSB7CiAgICBkZWZsYXRlSW5pdDogR2EsCiAgICBkZWZsYXRlSW5pdDI6IGphLAogICAgZGVmbGF0ZVJlc2V0OiBXYSwKICAgIGRlZmxhdGVSZXNldEtlZXA6IFZhLAogICAgZGVmbGF0ZVNldEhlYWRlcjogSmEsCiAgICBkZWZsYXRlOiBRYSwKICAgIGRlZmxhdGVFbmQ6IHFhLAogICAgZGVmbGF0ZVNldERpY3Rpb25hcnk6IGVuLAogICAgZGVmbGF0ZUluZm86IHRuCn0sIGFuID0gKGUsIGkpPT5PYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgaSksIG5uID0gZnVuY3Rpb24oZSkgewogICAgbGV0IGkgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpOwogICAgZm9yKDsgaS5sZW5ndGg7KXsKICAgICAgICBsZXQgdCA9IGkuc2hpZnQoKTsKICAgICAgICBpZiAodCkgewogICAgICAgICAgICBpZiAodHlwZW9mIHQgIT0gIm9iamVjdCIpIHRocm93IG5ldyBUeXBlRXJyb3IodCArICJtdXN0IGJlIG5vbi1vYmplY3QiKTsKICAgICAgICAgICAgZm9yKGxldCBuIGluIHQpYW4odCwgbikgJiYgKGVbbl0gPSB0W25dKTsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gZTsKfSwgbG4gPSAoZSk9PnsKICAgIGxldCBpID0gMDsKICAgIGZvcihsZXQgbiA9IDAsIGEgPSBlLmxlbmd0aDsgbiA8IGE7IG4rKylpICs9IGVbbl0ubGVuZ3RoOwogICAgbGV0IHQgPSBuZXcgVWludDhBcnJheShpKTsKICAgIGZvcihsZXQgbiA9IDAsIGEgPSAwLCBsID0gZS5sZW5ndGg7IG4gPCBsOyBuKyspewogICAgICAgIGxldCBvID0gZVtuXTsKICAgICAgICB0LnNldChvLCBhKSwgYSArPSBvLmxlbmd0aDsKICAgIH0KICAgIHJldHVybiB0Owp9LCBZZSA9IHsKICAgIGFzc2lnbjogbm4sCiAgICBmbGF0dGVuQ2h1bmtzOiBsbgp9LCBFaSA9ICEwOwp0cnkgewogICAgU3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShudWxsLCBuZXcgVWludDhBcnJheSgxKSk7Cn0gY2F0Y2ggIHsKICAgIEVpID0gITE7Cn0KdmFyIEVlID0gbmV3IFVpbnQ4QXJyYXkoMjU2KTsKZm9yKGxldCBlID0gMDsgZSA8IDI1NjsgZSsrKUVlW2VdID0gZSA+PSAyNTIgPyA2IDogZSA+PSAyNDggPyA1IDogZSA+PSAyNDAgPyA0IDogZSA+PSAyMjQgPyAzIDogZSA+PSAxOTIgPyAyIDogMTsKRWVbMjU0XSA9IEVlWzI1NF0gPSAxOwp2YXIgcm4gPSAoZSk9PnsKICAgIGlmICh0eXBlb2YgVGV4dEVuY29kZXIgPT0gImZ1bmN0aW9uIiAmJiBUZXh0RW5jb2Rlci5wcm90b3R5cGUuZW5jb2RlKSByZXR1cm4gbmV3IFRleHRFbmNvZGVyKCkuZW5jb2RlKGUpOwogICAgbGV0IGksIHQsIG4sIGEsIGwsIG8gPSBlLmxlbmd0aCwgZiA9IDA7CiAgICBmb3IoYSA9IDA7IGEgPCBvOyBhKyspdCA9IGUuY2hhckNvZGVBdChhKSwgKHQgJiA2NDUxMikgPT09IDU1Mjk2ICYmIGEgKyAxIDwgbyAmJiAobiA9IGUuY2hhckNvZGVBdChhICsgMSksIChuICYgNjQ1MTIpID09PSA1NjMyMCAmJiAodCA9IDY1NTM2ICsgKHQgLSA1NTI5NiA8PCAxMCkgKyAobiAtIDU2MzIwKSwgYSsrKSksIGYgKz0gdCA8IDEyOCA/IDEgOiB0IDwgMjA0OCA/IDIgOiB0IDwgNjU1MzYgPyAzIDogNDsKICAgIGZvcihpID0gbmV3IFVpbnQ4QXJyYXkoZiksIGwgPSAwLCBhID0gMDsgbCA8IGY7IGErKyl0ID0gZS5jaGFyQ29kZUF0KGEpLCAodCAmIDY0NTEyKSA9PT0gNTUyOTYgJiYgYSArIDEgPCBvICYmIChuID0gZS5jaGFyQ29kZUF0KGEgKyAxKSwgKG4gJiA2NDUxMikgPT09IDU2MzIwICYmICh0ID0gNjU1MzYgKyAodCAtIDU1Mjk2IDw8IDEwKSArIChuIC0gNTYzMjApLCBhKyspKSwgdCA8IDEyOCA/IGlbbCsrXSA9IHQgOiB0IDwgMjA0OCA/IChpW2wrK10gPSAxOTIgfCB0ID4+PiA2LCBpW2wrK10gPSAxMjggfCB0ICYgNjMpIDogdCA8IDY1NTM2ID8gKGlbbCsrXSA9IDIyNCB8IHQgPj4+IDEyLCBpW2wrK10gPSAxMjggfCB0ID4+PiA2ICYgNjMsIGlbbCsrXSA9IDEyOCB8IHQgJiA2MykgOiAoaVtsKytdID0gMjQwIHwgdCA+Pj4gMTgsIGlbbCsrXSA9IDEyOCB8IHQgPj4+IDEyICYgNjMsIGlbbCsrXSA9IDEyOCB8IHQgPj4+IDYgJiA2MywgaVtsKytdID0gMTI4IHwgdCAmIDYzKTsKICAgIHJldHVybiBpOwp9LCBmbiA9IChlLCBpKT0+ewogICAgaWYgKGkgPCA2NTUzNCAmJiBlLnN1YmFycmF5ICYmIEVpKSByZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShudWxsLCBlLmxlbmd0aCA9PT0gaSA/IGUgOiBlLnN1YmFycmF5KDAsIGkpKTsKICAgIGxldCB0ID0gIiI7CiAgICBmb3IobGV0IG4gPSAwOyBuIDwgaTsgbisrKXQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShlW25dKTsKICAgIHJldHVybiB0Owp9LCBvbiA9IChlLCBpKT0+ewogICAgbGV0IHQgPSBpIHx8IGUubGVuZ3RoOwogICAgaWYgKHR5cGVvZiBUZXh0RGVjb2RlciA9PSAiZnVuY3Rpb24iICYmIFRleHREZWNvZGVyLnByb3RvdHlwZS5kZWNvZGUpIHJldHVybiBuZXcgVGV4dERlY29kZXIoKS5kZWNvZGUoZS5zdWJhcnJheSgwLCBpKSk7CiAgICBsZXQgbiwgYSwgbCA9IG5ldyBBcnJheSh0ICogMik7CiAgICBmb3IoYSA9IDAsIG4gPSAwOyBuIDwgdDspewogICAgICAgIGxldCBvID0gZVtuKytdOwogICAgICAgIGlmIChvIDwgMTI4KSB7CiAgICAgICAgICAgIGxbYSsrXSA9IG87CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBsZXQgZiA9IEVlW29dOwogICAgICAgIGlmIChmID4gNCkgewogICAgICAgICAgICBsW2ErK10gPSA2NTUzMywgbiArPSBmIC0gMTsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGZvcihvICY9IGYgPT09IDIgPyAzMSA6IGYgPT09IDMgPyAxNSA6IDc7IGYgPiAxICYmIG4gPCB0OylvID0gbyA8PCA2IHwgZVtuKytdICYgNjMsIGYtLTsKICAgICAgICBpZiAoZiA+IDEpIHsKICAgICAgICAgICAgbFthKytdID0gNjU1MzM7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBvIDwgNjU1MzYgPyBsW2ErK10gPSBvIDogKG8gLT0gNjU1MzYsIGxbYSsrXSA9IDU1Mjk2IHwgbyA+PiAxMCAmIDEwMjMsIGxbYSsrXSA9IDU2MzIwIHwgbyAmIDEwMjMpOwogICAgfQogICAgcmV0dXJuIGZuKGwsIGEpOwp9LCBfbiA9IChlLCBpKT0+ewogICAgaSA9IGkgfHwgZS5sZW5ndGgsIGkgPiBlLmxlbmd0aCAmJiAoaSA9IGUubGVuZ3RoKTsKICAgIGxldCB0ID0gaSAtIDE7CiAgICBmb3IoOyB0ID49IDAgJiYgKGVbdF0gJiAxOTIpID09PSAxMjg7KXQtLTsKICAgIHJldHVybiB0IDwgMCB8fCB0ID09PSAwID8gaSA6IHQgKyBFZVtlW3RdXSA+IGkgPyB0IDogaTsKfSwgeWUgPSB7CiAgICBzdHJpbmcyYnVmOiBybiwKICAgIGJ1ZjJzdHJpbmc6IG9uLAogICAgdXRmOGJvcmRlcjogX24KfTsKZnVuY3Rpb24gaG4oKSB7CiAgICB0aGlzLmlucHV0ID0gbnVsbCwgdGhpcy5uZXh0X2luID0gMCwgdGhpcy5hdmFpbF9pbiA9IDAsIHRoaXMudG90YWxfaW4gPSAwLCB0aGlzLm91dHB1dCA9IG51bGwsIHRoaXMubmV4dF9vdXQgPSAwLCB0aGlzLmF2YWlsX291dCA9IDAsIHRoaXMudG90YWxfb3V0ID0gMCwgdGhpcy5tc2cgPSAiIiwgdGhpcy5zdGF0ZSA9IG51bGwsIHRoaXMuZGF0YV90eXBlID0gMiwgdGhpcy5hZGxlciA9IDA7Cn0KdmFyIHlpID0gaG4sIFNpID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZywgeyBaX05PX0ZMVVNIOiBkbiAsIFpfU1lOQ19GTFVTSDogc24gLCBaX0ZVTExfRkxVU0g6IGNuICwgWl9GSU5JU0g6IHVuICwgWl9PSzogQmUgLCBaX1NUUkVBTV9FTkQ6IGJuICwgWl9ERUZBVUxUX0NPTVBSRVNTSU9OOiB3biAsIFpfREVGQVVMVF9TVFJBVEVHWTogZ24gLCBaX0RFRkxBVEVEOiBwbiAgfSA9IG5lOwpmdW5jdGlvbiB6ZShlKSB7CiAgICB0aGlzLm9wdGlvbnMgPSBZZS5hc3NpZ24oewogICAgICAgIGxldmVsOiB3biwKICAgICAgICBtZXRob2Q6IHBuLAogICAgICAgIGNodW5rU2l6ZTogMTYzODQsCiAgICAgICAgd2luZG93Qml0czogMTUsCiAgICAgICAgbWVtTGV2ZWw6IDgsCiAgICAgICAgc3RyYXRlZ3k6IGduCiAgICB9LCBlIHx8IHt9KTsKICAgIGxldCBpID0gdGhpcy5vcHRpb25zOwogICAgaS5yYXcgJiYgaS53aW5kb3dCaXRzID4gMCA/IGkud2luZG93Qml0cyA9IC1pLndpbmRvd0JpdHMgOiBpLmd6aXAgJiYgaS53aW5kb3dCaXRzID4gMCAmJiBpLndpbmRvd0JpdHMgPCAxNiAmJiAoaS53aW5kb3dCaXRzICs9IDE2KSwgdGhpcy5lcnIgPSAwLCB0aGlzLm1zZyA9ICIiLCB0aGlzLmVuZGVkID0gITEsIHRoaXMuY2h1bmtzID0gW10sIHRoaXMuc3RybSA9IG5ldyB5aSwgdGhpcy5zdHJtLmF2YWlsX291dCA9IDA7CiAgICBsZXQgdCA9IGJlLmRlZmxhdGVJbml0Mih0aGlzLnN0cm0sIGkubGV2ZWwsIGkubWV0aG9kLCBpLndpbmRvd0JpdHMsIGkubWVtTGV2ZWwsIGkuc3RyYXRlZ3kpOwogICAgaWYgKHQgIT09IEJlKSB0aHJvdyBuZXcgRXJyb3IoZWVbdF0pOwogICAgaWYgKGkuaGVhZGVyICYmIGJlLmRlZmxhdGVTZXRIZWFkZXIodGhpcy5zdHJtLCBpLmhlYWRlciksIGkuZGljdGlvbmFyeSkgewogICAgICAgIGxldCBuOwogICAgICAgIGlmICh0eXBlb2YgaS5kaWN0aW9uYXJ5ID09ICJzdHJpbmciID8gbiA9IHllLnN0cmluZzJidWYoaS5kaWN0aW9uYXJ5KSA6IFNpLmNhbGwoaS5kaWN0aW9uYXJ5KSA9PT0gIltvYmplY3QgQXJyYXlCdWZmZXJdIiA/IG4gPSBuZXcgVWludDhBcnJheShpLmRpY3Rpb25hcnkpIDogbiA9IGkuZGljdGlvbmFyeSwgdCA9IGJlLmRlZmxhdGVTZXREaWN0aW9uYXJ5KHRoaXMuc3RybSwgbiksIHQgIT09IEJlKSB0aHJvdyBuZXcgRXJyb3IoZWVbdF0pOwogICAgICAgIHRoaXMuX2RpY3Rfc2V0ID0gITA7CiAgICB9Cn0KemUucHJvdG90eXBlLnB1c2ggPSBmdW5jdGlvbihlLCBpKSB7CiAgICBsZXQgdCA9IHRoaXMuc3RybSwgbiA9IHRoaXMub3B0aW9ucy5jaHVua1NpemUsIGEsIGw7CiAgICBpZiAodGhpcy5lbmRlZCkgcmV0dXJuICExOwogICAgZm9yKGkgPT09IH5+aSA/IGwgPSBpIDogbCA9IGkgPT09ICEwID8gdW4gOiBkbiwgdHlwZW9mIGUgPT0gInN0cmluZyIgPyB0LmlucHV0ID0geWUuc3RyaW5nMmJ1ZihlKSA6IFNpLmNhbGwoZSkgPT09ICJbb2JqZWN0IEFycmF5QnVmZmVyXSIgPyB0LmlucHV0ID0gbmV3IFVpbnQ4QXJyYXkoZSkgOiB0LmlucHV0ID0gZSwgdC5uZXh0X2luID0gMCwgdC5hdmFpbF9pbiA9IHQuaW5wdXQubGVuZ3RoOzspewogICAgICAgIGlmICh0LmF2YWlsX291dCA9PT0gMCAmJiAodC5vdXRwdXQgPSBuZXcgVWludDhBcnJheShuKSwgdC5uZXh0X291dCA9IDAsIHQuYXZhaWxfb3V0ID0gbiksIChsID09PSBzbiB8fCBsID09PSBjbikgJiYgdC5hdmFpbF9vdXQgPD0gNikgewogICAgICAgICAgICB0aGlzLm9uRGF0YSh0Lm91dHB1dC5zdWJhcnJheSgwLCB0Lm5leHRfb3V0KSksIHQuYXZhaWxfb3V0ID0gMDsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGlmIChhID0gYmUuZGVmbGF0ZSh0LCBsKSwgYSA9PT0gYm4pIHJldHVybiB0Lm5leHRfb3V0ID4gMCAmJiB0aGlzLm9uRGF0YSh0Lm91dHB1dC5zdWJhcnJheSgwLCB0Lm5leHRfb3V0KSksIGEgPSBiZS5kZWZsYXRlRW5kKHRoaXMuc3RybSksIHRoaXMub25FbmQoYSksIHRoaXMuZW5kZWQgPSAhMCwgYSA9PT0gQmU7CiAgICAgICAgaWYgKHQuYXZhaWxfb3V0ID09PSAwKSB7CiAgICAgICAgICAgIHRoaXMub25EYXRhKHQub3V0cHV0KTsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGlmIChsID4gMCAmJiB0Lm5leHRfb3V0ID4gMCkgewogICAgICAgICAgICB0aGlzLm9uRGF0YSh0Lm91dHB1dC5zdWJhcnJheSgwLCB0Lm5leHRfb3V0KSksIHQuYXZhaWxfb3V0ID0gMDsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGlmICh0LmF2YWlsX2luID09PSAwKSBicmVhazsKICAgIH0KICAgIHJldHVybiAhMDsKfTsKemUucHJvdG90eXBlLm9uRGF0YSA9IGZ1bmN0aW9uKGUpIHsKICAgIHRoaXMuY2h1bmtzLnB1c2goZSk7Cn07CnplLnByb3RvdHlwZS5vbkVuZCA9IGZ1bmN0aW9uKGUpIHsKICAgIGUgPT09IEJlICYmICh0aGlzLnJlc3VsdCA9IFllLmZsYXR0ZW5DaHVua3ModGhpcy5jaHVua3MpKSwgdGhpcy5jaHVua3MgPSBbXSwgdGhpcy5lcnIgPSBlLCB0aGlzLm1zZyA9IHRoaXMuc3RybS5tc2c7Cn07CmZ1bmN0aW9uIGJ0KGUsIGkpIHsKICAgIGxldCB0ID0gbmV3IHplKGkpOwogICAgaWYgKHQucHVzaChlLCAhMCksIHQuZXJyKSB0aHJvdyB0Lm1zZyB8fCBlZVt0LmVycl07CiAgICByZXR1cm4gdC5yZXN1bHQ7Cn0KZnVuY3Rpb24geG4oZSwgaSkgewogICAgcmV0dXJuIGkgPSBpIHx8IHt9LCBpLnJhdyA9ICEwLCBidChlLCBpKTsKfQpmdW5jdGlvbiBrbihlLCBpKSB7CiAgICByZXR1cm4gaSA9IGkgfHwge30sIGkuZ3ppcCA9ICEwLCBidChlLCBpKTsKfQp2YXIgdm4gPSB6ZSwgRW4gPSBidCwgeW4gPSB4biwgU24gPSBrbiwgQW4gPSBuZSwgUm4gPSB7CiAgICBEZWZsYXRlOiB2biwKICAgIGRlZmxhdGU6IEVuLAogICAgZGVmbGF0ZVJhdzogeW4sCiAgICBnemlwOiBTbiwKICAgIGNvbnN0YW50czogQW4KfSwgT2UgPSAzMCwgem4gPSAxMiwgVG4gPSBmdW5jdGlvbihpLCB0KSB7CiAgICBsZXQgbiwgYSwgbCwgbywgZiwgYywgciwgXywgRSwgcywgaCwgdSwgbSwgdiwgdywgQSwgeCwgZCwgUywgWiwgYiwgeiwgUiwgZywgcCA9IGkuc3RhdGU7CiAgICBuID0gaS5uZXh0X2luLCBSID0gaS5pbnB1dCwgYSA9IG4gKyAoaS5hdmFpbF9pbiAtIDUpLCBsID0gaS5uZXh0X291dCwgZyA9IGkub3V0cHV0LCBvID0gbCAtICh0IC0gaS5hdmFpbF9vdXQpLCBmID0gbCArIChpLmF2YWlsX291dCAtIDI1NyksIGMgPSBwLmRtYXgsIHIgPSBwLndzaXplLCBfID0gcC53aGF2ZSwgRSA9IHAud25leHQsIHMgPSBwLndpbmRvdywgaCA9IHAuaG9sZCwgdSA9IHAuYml0cywgbSA9IHAubGVuY29kZSwgdiA9IHAuZGlzdGNvZGUsIHcgPSAoMSA8PCBwLmxlbmJpdHMpIC0gMSwgQSA9ICgxIDw8IHAuZGlzdGJpdHMpIC0gMTsKICAgIGU6IGRvIHsKICAgICAgICB1IDwgMTUgJiYgKGggKz0gUltuKytdIDw8IHUsIHUgKz0gOCwgaCArPSBSW24rK10gPDwgdSwgdSArPSA4KSwgeCA9IG1baCAmIHddOwogICAgICAgIHQ6IGZvcig7Oyl7CiAgICAgICAgICAgIGlmIChkID0geCA+Pj4gMjQsIGggPj4+PSBkLCB1IC09IGQsIGQgPSB4ID4+PiAxNiAmIDI1NSwgZCA9PT0gMCkgZ1tsKytdID0geCAmIDY1NTM1OwogICAgICAgICAgICBlbHNlIGlmIChkICYgMTYpIHsKICAgICAgICAgICAgICAgIFMgPSB4ICYgNjU1MzUsIGQgJj0gMTUsIGQgJiYgKHUgPCBkICYmIChoICs9IFJbbisrXSA8PCB1LCB1ICs9IDgpLCBTICs9IGggJiAoMSA8PCBkKSAtIDEsIGggPj4+PSBkLCB1IC09IGQpLCB1IDwgMTUgJiYgKGggKz0gUltuKytdIDw8IHUsIHUgKz0gOCwgaCArPSBSW24rK10gPDwgdSwgdSArPSA4KSwgeCA9IHZbaCAmIEFdOwogICAgICAgICAgICAgICAgaTogZm9yKDs7KXsKICAgICAgICAgICAgICAgICAgICBpZiAoZCA9IHggPj4+IDI0LCBoID4+Pj0gZCwgdSAtPSBkLCBkID0geCA+Pj4gMTYgJiAyNTUsIGQgJiAxNikgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoWiA9IHggJiA2NTUzNSwgZCAmPSAxNSwgdSA8IGQgJiYgKGggKz0gUltuKytdIDw8IHUsIHUgKz0gOCwgdSA8IGQgJiYgKGggKz0gUltuKytdIDw8IHUsIHUgKz0gOCkpLCBaICs9IGggJiAoMSA8PCBkKSAtIDEsIFogPiBjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpLm1zZyA9ICJpbnZhbGlkIGRpc3RhbmNlIHRvbyBmYXIgYmFjayIsIHAubW9kZSA9IE9lOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsgZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaCA+Pj49IGQsIHUgLT0gZCwgZCA9IGwgLSBvLCBaID4gZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGQgPSBaIC0gZCwgZCA+IF8gJiYgcC5zYW5lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaS5tc2cgPSAiaW52YWxpZCBkaXN0YW5jZSB0b28gZmFyIGJhY2siLCBwLm1vZGUgPSBPZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhayBlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGIgPSAwLCB6ID0gcywgRSA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiICs9IHIgLSBkLCBkIDwgUykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTIC09IGQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvIGdbbCsrXSA9IHNbYisrXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKC0tZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYiA9IGwgLSBaLCB6ID0gZzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKEUgPCBkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGIgKz0gciArIEUgLSBkLCBkIC09IEUsIGQgPCBTKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFMgLT0gZDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG8gZ1tsKytdID0gc1tiKytdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoLS1kKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYiA9IDAsIEUgPCBTKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkID0gRSwgUyAtPSBkOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG8gZ1tsKytdID0gc1tiKytdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKC0tZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIgPSBsIC0gWiwgeiA9IGc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGIgKz0gRSAtIGQsIGQgPCBTKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUyAtPSBkOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvIGdbbCsrXSA9IHNbYisrXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoLS1kKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIgPSBsIC0gWiwgeiA9IGc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IoOyBTID4gMjspZ1tsKytdID0geltiKytdLCBnW2wrK10gPSB6W2IrK10sIGdbbCsrXSA9IHpbYisrXSwgUyAtPSAzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgUyAmJiAoZ1tsKytdID0geltiKytdLCBTID4gMSAmJiAoZ1tsKytdID0geltiKytdKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiID0gbCAtIFo7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkbyBnW2wrK10gPSBnW2IrK10sIGdbbCsrXSA9IGdbYisrXSwgZ1tsKytdID0gZ1tiKytdLCBTIC09IDM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoUyA+IDIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTICYmIChnW2wrK10gPSBnW2IrK10sIFMgPiAxICYmIChnW2wrK10gPSBnW2IrK10pKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZCAmIDY0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGkubXNnID0gImludmFsaWQgZGlzdGFuY2UgY29kZSIsIHAubW9kZSA9IE9lOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhayBlOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHggPSB2Wyh4ICYgNjU1MzUpICsgKGggJiAoMSA8PCBkKSAtIDEpXTsKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUgaTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZCAmIDY0KSBpZiAoZCAmIDMyKSB7CiAgICAgICAgICAgICAgICBwLm1vZGUgPSB6bjsKICAgICAgICAgICAgICAgIGJyZWFrIGU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpLm1zZyA9ICJpbnZhbGlkIGxpdGVyYWwvbGVuZ3RoIGNvZGUiLCBwLm1vZGUgPSBPZTsKICAgICAgICAgICAgICAgIGJyZWFrIGU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICB4ID0gbVsoeCAmIDY1NTM1KSArIChoICYgKDEgPDwgZCkgLSAxKV07CiAgICAgICAgICAgICAgICBjb250aW51ZSB0OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgIH13aGlsZSAobiA8IGEgJiYgbCA8IGYpCiAgICBTID0gdSA+PiAzLCBuIC09IFMsIHUgLT0gUyA8PCAzLCBoICY9ICgxIDw8IHUpIC0gMSwgaS5uZXh0X2luID0gbiwgaS5uZXh0X291dCA9IGwsIGkuYXZhaWxfaW4gPSBuIDwgYSA/IDUgKyAoYSAtIG4pIDogNSAtIChuIC0gYSksIGkuYXZhaWxfb3V0ID0gbCA8IGYgPyAyNTcgKyAoZiAtIGwpIDogMjU3IC0gKGwgLSBmKSwgcC5ob2xkID0gaCwgcC5iaXRzID0gdTsKfSwgZmUgPSAxNSwgenQgPSA4NTIsIFR0ID0gNTkyLCBtdCA9IDAsIHFlID0gMSwgRHQgPSAyLCBtbiA9IG5ldyBVaW50MTZBcnJheShbCiAgICAzLAogICAgNCwKICAgIDUsCiAgICA2LAogICAgNywKICAgIDgsCiAgICA5LAogICAgMTAsCiAgICAxMSwKICAgIDEzLAogICAgMTUsCiAgICAxNywKICAgIDE5LAogICAgMjMsCiAgICAyNywKICAgIDMxLAogICAgMzUsCiAgICA0MywKICAgIDUxLAogICAgNTksCiAgICA2NywKICAgIDgzLAogICAgOTksCiAgICAxMTUsCiAgICAxMzEsCiAgICAxNjMsCiAgICAxOTUsCiAgICAyMjcsCiAgICAyNTgsCiAgICAwLAogICAgMApdKSwgRG4gPSBuZXcgVWludDhBcnJheShbCiAgICAxNiwKICAgIDE2LAogICAgMTYsCiAgICAxNiwKICAgIDE2LAogICAgMTYsCiAgICAxNiwKICAgIDE2LAogICAgMTcsCiAgICAxNywKICAgIDE3LAogICAgMTcsCiAgICAxOCwKICAgIDE4LAogICAgMTgsCiAgICAxOCwKICAgIDE5LAogICAgMTksCiAgICAxOSwKICAgIDE5LAogICAgMjAsCiAgICAyMCwKICAgIDIwLAogICAgMjAsCiAgICAyMSwKICAgIDIxLAogICAgMjEsCiAgICAyMSwKICAgIDE2LAogICAgNzIsCiAgICA3OApdKSwgWm4gPSBuZXcgVWludDE2QXJyYXkoWwogICAgMSwKICAgIDIsCiAgICAzLAogICAgNCwKICAgIDUsCiAgICA3LAogICAgOSwKICAgIDEzLAogICAgMTcsCiAgICAyNSwKICAgIDMzLAogICAgNDksCiAgICA2NSwKICAgIDk3LAogICAgMTI5LAogICAgMTkzLAogICAgMjU3LAogICAgMzg1LAogICAgNTEzLAogICAgNzY5LAogICAgMTAyNSwKICAgIDE1MzcsCiAgICAyMDQ5LAogICAgMzA3MywKICAgIDQwOTcsCiAgICA2MTQ1LAogICAgODE5MywKICAgIDEyMjg5LAogICAgMTYzODUsCiAgICAyNDU3NywKICAgIDAsCiAgICAwCl0pLCBJbiA9IG5ldyBVaW50OEFycmF5KFsKICAgIDE2LAogICAgMTYsCiAgICAxNiwKICAgIDE2LAogICAgMTcsCiAgICAxNywKICAgIDE4LAogICAgMTgsCiAgICAxOSwKICAgIDE5LAogICAgMjAsCiAgICAyMCwKICAgIDIxLAogICAgMjEsCiAgICAyMiwKICAgIDIyLAogICAgMjMsCiAgICAyMywKICAgIDI0LAogICAgMjQsCiAgICAyNSwKICAgIDI1LAogICAgMjYsCiAgICAyNiwKICAgIDI3LAogICAgMjcsCiAgICAyOCwKICAgIDI4LAogICAgMjksCiAgICAyOSwKICAgIDY0LAogICAgNjQKXSksIE9uID0gKGUsIGksIHQsIG4sIGEsIGwsIG8sIGYpPT57CiAgICBsZXQgYyA9IGYuYml0cywgciA9IDAsIF8gPSAwLCBFID0gMCwgcyA9IDAsIGggPSAwLCB1ID0gMCwgbSA9IDAsIHYgPSAwLCB3ID0gMCwgQSA9IDAsIHgsIGQsIFMsIFosIGIsIHogPSBudWxsLCBSID0gMCwgZywgcCA9IG5ldyBVaW50MTZBcnJheShmZSArIDEpLCBKID0gbmV3IFVpbnQxNkFycmF5KGZlICsgMSksIG1lID0gbnVsbCwgZ3QgPSAwLCBwdCwgRGUsIFplOwogICAgZm9yKHIgPSAwOyByIDw9IGZlOyByKyspcFtyXSA9IDA7CiAgICBmb3IoXyA9IDA7IF8gPCBuOyBfKyspcFtpW3QgKyBfXV0rKzsKICAgIGZvcihoID0gYywgcyA9IGZlOyBzID49IDEgJiYgcFtzXSA9PT0gMDsgcy0tKTsKICAgIGlmIChoID4gcyAmJiAoaCA9IHMpLCBzID09PSAwKSByZXR1cm4gYVtsKytdID0gMSA8PCAyNCB8IDY0IDw8IDE2IHwgMCwgYVtsKytdID0gMSA8PCAyNCB8IDY0IDw8IDE2IHwgMCwgZi5iaXRzID0gMSwgMDsKICAgIGZvcihFID0gMTsgRSA8IHMgJiYgcFtFXSA9PT0gMDsgRSsrKTsKICAgIGZvcihoIDwgRSAmJiAoaCA9IEUpLCB2ID0gMSwgciA9IDE7IHIgPD0gZmU7IHIrKylpZiAodiA8PD0gMSwgdiAtPSBwW3JdLCB2IDwgMCkgcmV0dXJuIC0xOwogICAgaWYgKHYgPiAwICYmIChlID09PSBtdCB8fCBzICE9PSAxKSkgcmV0dXJuIC0xOwogICAgZm9yKEpbMV0gPSAwLCByID0gMTsgciA8IGZlOyByKyspSltyICsgMV0gPSBKW3JdICsgcFtyXTsKICAgIGZvcihfID0gMDsgXyA8IG47IF8rKylpW3QgKyBfXSAhPT0gMCAmJiAob1tKW2lbdCArIF9dXSsrXSA9IF8pOwogICAgaWYgKGUgPT09IG10ID8gKHogPSBtZSA9IG8sIGcgPSAxOSkgOiBlID09PSBxZSA/ICh6ID0gbW4sIFIgLT0gMjU3LCBtZSA9IERuLCBndCAtPSAyNTcsIGcgPSAyNTYpIDogKHogPSBabiwgbWUgPSBJbiwgZyA9IC0xKSwgQSA9IDAsIF8gPSAwLCByID0gRSwgYiA9IGwsIHUgPSBoLCBtID0gMCwgUyA9IC0xLCB3ID0gMSA8PCBoLCBaID0gdyAtIDEsIGUgPT09IHFlICYmIHcgPiB6dCB8fCBlID09PSBEdCAmJiB3ID4gVHQpIHJldHVybiAxOwogICAgZm9yKDs7KXsKICAgICAgICBwdCA9IHIgLSBtLCBvW19dIDwgZyA/IChEZSA9IDAsIFplID0gb1tfXSkgOiBvW19dID4gZyA/IChEZSA9IG1lW2d0ICsgb1tfXV0sIFplID0geltSICsgb1tfXV0pIDogKERlID0gMzIgKyA2NCwgWmUgPSAwKSwgeCA9IDEgPDwgciAtIG0sIGQgPSAxIDw8IHUsIEUgPSBkOwogICAgICAgIGRvIGQgLT0geCwgYVtiICsgKEEgPj4gbSkgKyBkXSA9IHB0IDw8IDI0IHwgRGUgPDwgMTYgfCBaZSB8IDA7CiAgICAgICAgd2hpbGUgKGQgIT09IDApCiAgICAgICAgZm9yKHggPSAxIDw8IHIgLSAxOyBBICYgeDspeCA+Pj0gMTsKICAgICAgICBpZiAoeCAhPT0gMCA/IChBICY9IHggLSAxLCBBICs9IHgpIDogQSA9IDAsIF8rKywgLS1wW3JdID09PSAwKSB7CiAgICAgICAgICAgIGlmIChyID09PSBzKSBicmVhazsKICAgICAgICAgICAgciA9IGlbdCArIG9bX11dOwogICAgICAgIH0KICAgICAgICBpZiAociA+IGggJiYgKEEgJiBaKSAhPT0gUykgewogICAgICAgICAgICBmb3IobSA9PT0gMCAmJiAobSA9IGgpLCBiICs9IEUsIHUgPSByIC0gbSwgdiA9IDEgPDwgdTsgdSArIG0gPCBzICYmICh2IC09IHBbdSArIG1dLCAhKHYgPD0gMCkpOyl1KyssIHYgPDw9IDE7CiAgICAgICAgICAgIGlmICh3ICs9IDEgPDwgdSwgZSA9PT0gcWUgJiYgdyA+IHp0IHx8IGUgPT09IER0ICYmIHcgPiBUdCkgcmV0dXJuIDE7CiAgICAgICAgICAgIFMgPSBBICYgWiwgYVtTXSA9IGggPDwgMjQgfCB1IDw8IDE2IHwgYiAtIGwgfCAwOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiBBICE9PSAwICYmIChhW2IgKyBBXSA9IHIgLSBtIDw8IDI0IHwgNjQgPDwgMTYgfCAwKSwgZi5iaXRzID0gaCwgMDsKfSwgd2UgPSBPbiwgTm4gPSAwLCBBaSA9IDEsIFJpID0gMiwgeyBaX0ZJTklTSDogWnQgLCBaX0JMT0NLOiBMbiAsIFpfVFJFRVM6IE5lICwgWl9PSzogYWUgLCBaX1NUUkVBTV9FTkQ6IFVuICwgWl9ORUVEX0RJQ1Q6ICRuICwgWl9TVFJFQU1fRVJST1I6IFUgLCBaX0RBVEFfRVJST1I6IHppICwgWl9NRU1fRVJST1I6IFRpICwgWl9CVUZfRVJST1I6IENuICwgWl9ERUZMQVRFRDogSXQgIH0gPSBuZSwgbWkgPSAxLCBPdCA9IDIsIE50ID0gMywgTHQgPSA0LCBVdCA9IDUsICR0ID0gNiwgQ3QgPSA3LCBGdCA9IDgsIE10ID0gOSwgSHQgPSAxMCwgS2UgPSAxMSwgSCA9IDEyLCBldCA9IDEzLCBCdCA9IDE0LCB0dCA9IDE1LCBLdCA9IDE2LCBQdCA9IDE3LCBYdCA9IDE4LCBZdCA9IDE5LCBMZSA9IDIwLCBVZSA9IDIxLCBHdCA9IDIyLCBqdCA9IDIzLCBXdCA9IDI0LCBWdCA9IDI1LCBKdCA9IDI2LCBpdCA9IDI3LCBRdCA9IDI4LCBxdCA9IDI5LCBUMSA9IDMwLCBEaSA9IDMxLCBGbiA9IDMyLCBNbiA9IDg1MiwgSG4gPSA1OTIsIEJuID0gMTUsIEtuID0gQm4sIGVpID0gKGUpPT4oZSA+Pj4gMjQgJiAyNTUpICsgKGUgPj4+IDggJiA2NTI4MCkgKyAoKGUgJiA2NTI4MCkgPDwgOCkgKyAoKGUgJiAyNTUpIDw8IDI0KTsKZnVuY3Rpb24gUG4oKSB7CiAgICB0aGlzLm1vZGUgPSAwLCB0aGlzLmxhc3QgPSAhMSwgdGhpcy53cmFwID0gMCwgdGhpcy5oYXZlZGljdCA9ICExLCB0aGlzLmZsYWdzID0gMCwgdGhpcy5kbWF4ID0gMCwgdGhpcy5jaGVjayA9IDAsIHRoaXMudG90YWwgPSAwLCB0aGlzLmhlYWQgPSBudWxsLCB0aGlzLndiaXRzID0gMCwgdGhpcy53c2l6ZSA9IDAsIHRoaXMud2hhdmUgPSAwLCB0aGlzLnduZXh0ID0gMCwgdGhpcy53aW5kb3cgPSBudWxsLCB0aGlzLmhvbGQgPSAwLCB0aGlzLmJpdHMgPSAwLCB0aGlzLmxlbmd0aCA9IDAsIHRoaXMub2Zmc2V0ID0gMCwgdGhpcy5leHRyYSA9IDAsIHRoaXMubGVuY29kZSA9IG51bGwsIHRoaXMuZGlzdGNvZGUgPSBudWxsLCB0aGlzLmxlbmJpdHMgPSAwLCB0aGlzLmRpc3RiaXRzID0gMCwgdGhpcy5uY29kZSA9IDAsIHRoaXMubmxlbiA9IDAsIHRoaXMubmRpc3QgPSAwLCB0aGlzLmhhdmUgPSAwLCB0aGlzLm5leHQgPSBudWxsLCB0aGlzLmxlbnMgPSBuZXcgVWludDE2QXJyYXkoMzIwKSwgdGhpcy53b3JrID0gbmV3IFVpbnQxNkFycmF5KDI4OCksIHRoaXMubGVuZHluID0gbnVsbCwgdGhpcy5kaXN0ZHluID0gbnVsbCwgdGhpcy5zYW5lID0gMCwgdGhpcy5iYWNrID0gMCwgdGhpcy53YXMgPSAwOwp9CnZhciBaaSA9IChlKT0+ewogICAgaWYgKCFlIHx8ICFlLnN0YXRlKSByZXR1cm4gVTsKICAgIGxldCBpID0gZS5zdGF0ZTsKICAgIHJldHVybiBlLnRvdGFsX2luID0gZS50b3RhbF9vdXQgPSBpLnRvdGFsID0gMCwgZS5tc2cgPSAiIiwgaS53cmFwICYmIChlLmFkbGVyID0gaS53cmFwICYgMSksIGkubW9kZSA9IG1pLCBpLmxhc3QgPSAwLCBpLmhhdmVkaWN0ID0gMCwgaS5kbWF4ID0gMzI3NjgsIGkuaGVhZCA9IG51bGwsIGkuaG9sZCA9IDAsIGkuYml0cyA9IDAsIGkubGVuY29kZSA9IGkubGVuZHluID0gbmV3IEludDMyQXJyYXkoTW4pLCBpLmRpc3Rjb2RlID0gaS5kaXN0ZHluID0gbmV3IEludDMyQXJyYXkoSG4pLCBpLnNhbmUgPSAxLCBpLmJhY2sgPSAtMSwgYWU7Cn0sIElpID0gKGUpPT57CiAgICBpZiAoIWUgfHwgIWUuc3RhdGUpIHJldHVybiBVOwogICAgbGV0IGkgPSBlLnN0YXRlOwogICAgcmV0dXJuIGkud3NpemUgPSAwLCBpLndoYXZlID0gMCwgaS53bmV4dCA9IDAsIFppKGUpOwp9LCBPaSA9IChlLCBpKT0+ewogICAgbGV0IHQ7CiAgICBpZiAoIWUgfHwgIWUuc3RhdGUpIHJldHVybiBVOwogICAgbGV0IG4gPSBlLnN0YXRlOwogICAgcmV0dXJuIGkgPCAwID8gKHQgPSAwLCBpID0gLWkpIDogKHQgPSAoaSA+PiA0KSArIDEsIGkgPCA0OCAmJiAoaSAmPSAxNSkpLCBpICYmIChpIDwgOCB8fCBpID4gMTUpID8gVSA6IChuLndpbmRvdyAhPT0gbnVsbCAmJiBuLndiaXRzICE9PSBpICYmIChuLndpbmRvdyA9IG51bGwpLCBuLndyYXAgPSB0LCBuLndiaXRzID0gaSwgSWkoZSkpOwp9LCBOaSA9IChlLCBpKT0+ewogICAgaWYgKCFlKSByZXR1cm4gVTsKICAgIGxldCB0ID0gbmV3IFBuOwogICAgZS5zdGF0ZSA9IHQsIHQud2luZG93ID0gbnVsbDsKICAgIGxldCBuID0gT2koZSwgaSk7CiAgICByZXR1cm4gbiAhPT0gYWUgJiYgKGUuc3RhdGUgPSBudWxsKSwgbjsKfSwgWG4gPSAoZSk9Pk5pKGUsIEtuKSwgdGkgPSAhMCwgYXQsIG50LCBZbiA9IChlKT0+ewogICAgaWYgKHRpKSB7CiAgICAgICAgYXQgPSBuZXcgSW50MzJBcnJheSg1MTIpLCBudCA9IG5ldyBJbnQzMkFycmF5KDMyKTsKICAgICAgICBsZXQgaSA9IDA7CiAgICAgICAgZm9yKDsgaSA8IDE0NDspZS5sZW5zW2krK10gPSA4OwogICAgICAgIGZvcig7IGkgPCAyNTY7KWUubGVuc1tpKytdID0gOTsKICAgICAgICBmb3IoOyBpIDwgMjgwOyllLmxlbnNbaSsrXSA9IDc7CiAgICAgICAgZm9yKDsgaSA8IDI4ODspZS5sZW5zW2krK10gPSA4OwogICAgICAgIGZvcih3ZShBaSwgZS5sZW5zLCAwLCAyODgsIGF0LCAwLCBlLndvcmssIHsKICAgICAgICAgICAgYml0czogOQogICAgICAgIH0pLCBpID0gMDsgaSA8IDMyOyllLmxlbnNbaSsrXSA9IDU7CiAgICAgICAgd2UoUmksIGUubGVucywgMCwgMzIsIG50LCAwLCBlLndvcmssIHsKICAgICAgICAgICAgYml0czogNQogICAgICAgIH0pLCB0aSA9ICExOwogICAgfQogICAgZS5sZW5jb2RlID0gYXQsIGUubGVuYml0cyA9IDksIGUuZGlzdGNvZGUgPSBudCwgZS5kaXN0Yml0cyA9IDU7Cn0sIExpID0gKGUsIGksIHQsIG4pPT57CiAgICBsZXQgYSwgbCA9IGUuc3RhdGU7CiAgICByZXR1cm4gbC53aW5kb3cgPT09IG51bGwgJiYgKGwud3NpemUgPSAxIDw8IGwud2JpdHMsIGwud25leHQgPSAwLCBsLndoYXZlID0gMCwgbC53aW5kb3cgPSBuZXcgVWludDhBcnJheShsLndzaXplKSksIG4gPj0gbC53c2l6ZSA/IChsLndpbmRvdy5zZXQoaS5zdWJhcnJheSh0IC0gbC53c2l6ZSwgdCksIDApLCBsLnduZXh0ID0gMCwgbC53aGF2ZSA9IGwud3NpemUpIDogKGEgPSBsLndzaXplIC0gbC53bmV4dCwgYSA+IG4gJiYgKGEgPSBuKSwgbC53aW5kb3cuc2V0KGkuc3ViYXJyYXkodCAtIG4sIHQgLSBuICsgYSksIGwud25leHQpLCBuIC09IGEsIG4gPyAobC53aW5kb3cuc2V0KGkuc3ViYXJyYXkodCAtIG4sIHQpLCAwKSwgbC53bmV4dCA9IG4sIGwud2hhdmUgPSBsLndzaXplKSA6IChsLnduZXh0ICs9IGEsIGwud25leHQgPT09IGwud3NpemUgJiYgKGwud25leHQgPSAwKSwgbC53aGF2ZSA8IGwud3NpemUgJiYgKGwud2hhdmUgKz0gYSkpKSwgMDsKfSwgR24gPSAoZSwgaSk9PnsKICAgIGxldCB0LCBuLCBhLCBsLCBvLCBmLCBjLCByLCBfLCBFLCBzLCBoLCB1LCBtLCB2ID0gMCwgdywgQSwgeCwgZCwgUywgWiwgYiwgeiwgUiA9IG5ldyBVaW50OEFycmF5KDQpLCBnLCBwLCBKID0gbmV3IFVpbnQ4QXJyYXkoWwogICAgICAgIDE2LAogICAgICAgIDE3LAogICAgICAgIDE4LAogICAgICAgIDAsCiAgICAgICAgOCwKICAgICAgICA3LAogICAgICAgIDksCiAgICAgICAgNiwKICAgICAgICAxMCwKICAgICAgICA1LAogICAgICAgIDExLAogICAgICAgIDQsCiAgICAgICAgMTIsCiAgICAgICAgMywKICAgICAgICAxMywKICAgICAgICAyLAogICAgICAgIDE0LAogICAgICAgIDEsCiAgICAgICAgMTUKICAgIF0pOwogICAgaWYgKCFlIHx8ICFlLnN0YXRlIHx8ICFlLm91dHB1dCB8fCAhZS5pbnB1dCAmJiBlLmF2YWlsX2luICE9PSAwKSByZXR1cm4gVTsKICAgIHQgPSBlLnN0YXRlLCB0Lm1vZGUgPT09IEggJiYgKHQubW9kZSA9IGV0KSwgbyA9IGUubmV4dF9vdXQsIGEgPSBlLm91dHB1dCwgYyA9IGUuYXZhaWxfb3V0LCBsID0gZS5uZXh0X2luLCBuID0gZS5pbnB1dCwgZiA9IGUuYXZhaWxfaW4sIHIgPSB0LmhvbGQsIF8gPSB0LmJpdHMsIEUgPSBmLCBzID0gYywgeiA9IGFlOwogICAgZTogZm9yKDs7KXN3aXRjaCh0Lm1vZGUpewogICAgICAgIGNhc2UgbWk6CiAgICAgICAgICAgIGlmICh0LndyYXAgPT09IDApIHsKICAgICAgICAgICAgICAgIHQubW9kZSA9IGV0OwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yKDsgXyA8IDE2Oyl7CiAgICAgICAgICAgICAgICBpZiAoZiA9PT0gMCkgYnJlYWsgZTsKICAgICAgICAgICAgICAgIGYtLSwgciArPSBuW2wrK10gPDwgXywgXyArPSA4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0LndyYXAgJiAyICYmIHIgPT09IDM1NjE1KSB7CiAgICAgICAgICAgICAgICB0LmNoZWNrID0gMCwgUlswXSA9IHIgJiAyNTUsIFJbMV0gPSByID4+PiA4ICYgMjU1LCB0LmNoZWNrID0gSSh0LmNoZWNrLCBSLCAyLCAwKSwgciA9IDAsIF8gPSAwLCB0Lm1vZGUgPSBPdDsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0LmZsYWdzID0gMCwgdC5oZWFkICYmICh0LmhlYWQuZG9uZSA9ICExKSwgISh0LndyYXAgJiAxKSB8fCAoKChyICYgMjU1KSA8PCA4KSArIChyID4+IDgpKSAlIDMxKSB7CiAgICAgICAgICAgICAgICBlLm1zZyA9ICJpbmNvcnJlY3QgaGVhZGVyIGNoZWNrIiwgdC5tb2RlID0gVDE7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoKHIgJiAxNSkgIT09IEl0KSB7CiAgICAgICAgICAgICAgICBlLm1zZyA9ICJ1bmtub3duIGNvbXByZXNzaW9uIG1ldGhvZCIsIHQubW9kZSA9IFQxOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHIgPj4+PSA0LCBfIC09IDQsIGIgPSAociAmIDE1KSArIDgsIHQud2JpdHMgPT09IDApIHQud2JpdHMgPSBiOwogICAgICAgICAgICBlbHNlIGlmIChiID4gdC53Yml0cykgewogICAgICAgICAgICAgICAgZS5tc2cgPSAiaW52YWxpZCB3aW5kb3cgc2l6ZSIsIHQubW9kZSA9IFQxOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdC5kbWF4ID0gMSA8PCB0LndiaXRzLCBlLmFkbGVyID0gdC5jaGVjayA9IDEsIHQubW9kZSA9IHIgJiA1MTIgPyBIdCA6IEgsIHIgPSAwLCBfID0gMDsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBPdDoKICAgICAgICAgICAgZm9yKDsgXyA8IDE2Oyl7CiAgICAgICAgICAgICAgICBpZiAoZiA9PT0gMCkgYnJlYWsgZTsKICAgICAgICAgICAgICAgIGYtLSwgciArPSBuW2wrK10gPDwgXywgXyArPSA4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0LmZsYWdzID0gciwgKHQuZmxhZ3MgJiAyNTUpICE9PSBJdCkgewogICAgICAgICAgICAgICAgZS5tc2cgPSAidW5rbm93biBjb21wcmVzc2lvbiBtZXRob2QiLCB0Lm1vZGUgPSBUMTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0LmZsYWdzICYgNTczNDQpIHsKICAgICAgICAgICAgICAgIGUubXNnID0gInVua25vd24gaGVhZGVyIGZsYWdzIHNldCIsIHQubW9kZSA9IFQxOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdC5oZWFkICYmICh0LmhlYWQudGV4dCA9IHIgPj4gOCAmIDEpLCB0LmZsYWdzICYgNTEyICYmIChSWzBdID0gciAmIDI1NSwgUlsxXSA9IHIgPj4+IDggJiAyNTUsIHQuY2hlY2sgPSBJKHQuY2hlY2ssIFIsIDIsIDApKSwgciA9IDAsIF8gPSAwLCB0Lm1vZGUgPSBOdDsKICAgICAgICBjYXNlIE50OgogICAgICAgICAgICBmb3IoOyBfIDwgMzI7KXsKICAgICAgICAgICAgICAgIGlmIChmID09PSAwKSBicmVhayBlOwogICAgICAgICAgICAgICAgZi0tLCByICs9IG5bbCsrXSA8PCBfLCBfICs9IDg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdC5oZWFkICYmICh0LmhlYWQudGltZSA9IHIpLCB0LmZsYWdzICYgNTEyICYmIChSWzBdID0gciAmIDI1NSwgUlsxXSA9IHIgPj4+IDggJiAyNTUsIFJbMl0gPSByID4+PiAxNiAmIDI1NSwgUlszXSA9IHIgPj4+IDI0ICYgMjU1LCB0LmNoZWNrID0gSSh0LmNoZWNrLCBSLCA0LCAwKSksIHIgPSAwLCBfID0gMCwgdC5tb2RlID0gTHQ7CiAgICAgICAgY2FzZSBMdDoKICAgICAgICAgICAgZm9yKDsgXyA8IDE2Oyl7CiAgICAgICAgICAgICAgICBpZiAoZiA9PT0gMCkgYnJlYWsgZTsKICAgICAgICAgICAgICAgIGYtLSwgciArPSBuW2wrK10gPDwgXywgXyArPSA4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHQuaGVhZCAmJiAodC5oZWFkLnhmbGFncyA9IHIgJiAyNTUsIHQuaGVhZC5vcyA9IHIgPj4gOCksIHQuZmxhZ3MgJiA1MTIgJiYgKFJbMF0gPSByICYgMjU1LCBSWzFdID0gciA+Pj4gOCAmIDI1NSwgdC5jaGVjayA9IEkodC5jaGVjaywgUiwgMiwgMCkpLCByID0gMCwgXyA9IDAsIHQubW9kZSA9IFV0OwogICAgICAgIGNhc2UgVXQ6CiAgICAgICAgICAgIGlmICh0LmZsYWdzICYgMTAyNCkgewogICAgICAgICAgICAgICAgZm9yKDsgXyA8IDE2Oyl7CiAgICAgICAgICAgICAgICAgICAgaWYgKGYgPT09IDApIGJyZWFrIGU7CiAgICAgICAgICAgICAgICAgICAgZi0tLCByICs9IG5bbCsrXSA8PCBfLCBfICs9IDg7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0Lmxlbmd0aCA9IHIsIHQuaGVhZCAmJiAodC5oZWFkLmV4dHJhX2xlbiA9IHIpLCB0LmZsYWdzICYgNTEyICYmIChSWzBdID0gciAmIDI1NSwgUlsxXSA9IHIgPj4+IDggJiAyNTUsIHQuY2hlY2sgPSBJKHQuY2hlY2ssIFIsIDIsIDApKSwgciA9IDAsIF8gPSAwOwogICAgICAgICAgICB9IGVsc2UgdC5oZWFkICYmICh0LmhlYWQuZXh0cmEgPSBudWxsKTsKICAgICAgICAgICAgdC5tb2RlID0gJHQ7CiAgICAgICAgY2FzZSAkdDoKICAgICAgICAgICAgaWYgKHQuZmxhZ3MgJiAxMDI0ICYmIChoID0gdC5sZW5ndGgsIGggPiBmICYmIChoID0gZiksIGggJiYgKHQuaGVhZCAmJiAoYiA9IHQuaGVhZC5leHRyYV9sZW4gLSB0Lmxlbmd0aCwgdC5oZWFkLmV4dHJhIHx8ICh0LmhlYWQuZXh0cmEgPSBuZXcgVWludDhBcnJheSh0LmhlYWQuZXh0cmFfbGVuKSksIHQuaGVhZC5leHRyYS5zZXQobi5zdWJhcnJheShsLCBsICsgaCksIGIpKSwgdC5mbGFncyAmIDUxMiAmJiAodC5jaGVjayA9IEkodC5jaGVjaywgbiwgaCwgbCkpLCBmIC09IGgsIGwgKz0gaCwgdC5sZW5ndGggLT0gaCksIHQubGVuZ3RoKSkgYnJlYWsgZTsKICAgICAgICAgICAgdC5sZW5ndGggPSAwLCB0Lm1vZGUgPSBDdDsKICAgICAgICBjYXNlIEN0OgogICAgICAgICAgICBpZiAodC5mbGFncyAmIDIwNDgpIHsKICAgICAgICAgICAgICAgIGlmIChmID09PSAwKSBicmVhayBlOwogICAgICAgICAgICAgICAgaCA9IDA7CiAgICAgICAgICAgICAgICBkbyBiID0gbltsICsgaCsrXSwgdC5oZWFkICYmIGIgJiYgdC5sZW5ndGggPCA2NTUzNiAmJiAodC5oZWFkLm5hbWUgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShiKSk7CiAgICAgICAgICAgICAgICB3aGlsZSAoYiAmJiBoIDwgZikKICAgICAgICAgICAgICAgIGlmICh0LmZsYWdzICYgNTEyICYmICh0LmNoZWNrID0gSSh0LmNoZWNrLCBuLCBoLCBsKSksIGYgLT0gaCwgbCArPSBoLCBiKSBicmVhayBlOwogICAgICAgICAgICB9IGVsc2UgdC5oZWFkICYmICh0LmhlYWQubmFtZSA9IG51bGwpOwogICAgICAgICAgICB0Lmxlbmd0aCA9IDAsIHQubW9kZSA9IEZ0OwogICAgICAgIGNhc2UgRnQ6CiAgICAgICAgICAgIGlmICh0LmZsYWdzICYgNDA5NikgewogICAgICAgICAgICAgICAgaWYgKGYgPT09IDApIGJyZWFrIGU7CiAgICAgICAgICAgICAgICBoID0gMDsKICAgICAgICAgICAgICAgIGRvIGIgPSBuW2wgKyBoKytdLCB0LmhlYWQgJiYgYiAmJiB0Lmxlbmd0aCA8IDY1NTM2ICYmICh0LmhlYWQuY29tbWVudCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGIpKTsKICAgICAgICAgICAgICAgIHdoaWxlIChiICYmIGggPCBmKQogICAgICAgICAgICAgICAgaWYgKHQuZmxhZ3MgJiA1MTIgJiYgKHQuY2hlY2sgPSBJKHQuY2hlY2ssIG4sIGgsIGwpKSwgZiAtPSBoLCBsICs9IGgsIGIpIGJyZWFrIGU7CiAgICAgICAgICAgIH0gZWxzZSB0LmhlYWQgJiYgKHQuaGVhZC5jb21tZW50ID0gbnVsbCk7CiAgICAgICAgICAgIHQubW9kZSA9IE10OwogICAgICAgIGNhc2UgTXQ6CiAgICAgICAgICAgIGlmICh0LmZsYWdzICYgNTEyKSB7CiAgICAgICAgICAgICAgICBmb3IoOyBfIDwgMTY7KXsKICAgICAgICAgICAgICAgICAgICBpZiAoZiA9PT0gMCkgYnJlYWsgZTsKICAgICAgICAgICAgICAgICAgICBmLS0sIHIgKz0gbltsKytdIDw8IF8sIF8gKz0gODsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChyICE9PSAodC5jaGVjayAmIDY1NTM1KSkgewogICAgICAgICAgICAgICAgICAgIGUubXNnID0gImhlYWRlciBjcmMgbWlzbWF0Y2giLCB0Lm1vZGUgPSBUMTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHIgPSAwLCBfID0gMDsKICAgICAgICAgICAgfQogICAgICAgICAgICB0LmhlYWQgJiYgKHQuaGVhZC5oY3JjID0gdC5mbGFncyA+PiA5ICYgMSwgdC5oZWFkLmRvbmUgPSAhMCksIGUuYWRsZXIgPSB0LmNoZWNrID0gMCwgdC5tb2RlID0gSDsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBIdDoKICAgICAgICAgICAgZm9yKDsgXyA8IDMyOyl7CiAgICAgICAgICAgICAgICBpZiAoZiA9PT0gMCkgYnJlYWsgZTsKICAgICAgICAgICAgICAgIGYtLSwgciArPSBuW2wrK10gPDwgXywgXyArPSA4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGUuYWRsZXIgPSB0LmNoZWNrID0gZWkociksIHIgPSAwLCBfID0gMCwgdC5tb2RlID0gS2U7CiAgICAgICAgY2FzZSBLZToKICAgICAgICAgICAgaWYgKHQuaGF2ZWRpY3QgPT09IDApIHJldHVybiBlLm5leHRfb3V0ID0gbywgZS5hdmFpbF9vdXQgPSBjLCBlLm5leHRfaW4gPSBsLCBlLmF2YWlsX2luID0gZiwgdC5ob2xkID0gciwgdC5iaXRzID0gXywgJG47CiAgICAgICAgICAgIGUuYWRsZXIgPSB0LmNoZWNrID0gMSwgdC5tb2RlID0gSDsKICAgICAgICBjYXNlIEg6CiAgICAgICAgICAgIGlmIChpID09PSBMbiB8fCBpID09PSBOZSkgYnJlYWsgZTsKICAgICAgICBjYXNlIGV0OgogICAgICAgICAgICBpZiAodC5sYXN0KSB7CiAgICAgICAgICAgICAgICByID4+Pj0gXyAmIDcsIF8gLT0gXyAmIDcsIHQubW9kZSA9IGl0OwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yKDsgXyA8IDM7KXsKICAgICAgICAgICAgICAgIGlmIChmID09PSAwKSBicmVhayBlOwogICAgICAgICAgICAgICAgZi0tLCByICs9IG5bbCsrXSA8PCBfLCBfICs9IDg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3dpdGNoKHQubGFzdCA9IHIgJiAxLCByID4+Pj0gMSwgXyAtPSAxLCByICYgMyl7CiAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgdC5tb2RlID0gQnQ7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICAgICAgaWYgKFluKHQpLCB0Lm1vZGUgPSBMZSwgaSA9PT0gTmUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgciA+Pj49IDIsIF8gLT0gMjsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsgZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICAgICAgdC5tb2RlID0gUHQ7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICAgICAgZS5tc2cgPSAiaW52YWxpZCBibG9jayB0eXBlIiwgdC5tb2RlID0gVDE7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgciA+Pj49IDIsIF8gLT0gMjsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBCdDoKICAgICAgICAgICAgZm9yKHIgPj4+PSBfICYgNywgXyAtPSBfICYgNzsgXyA8IDMyOyl7CiAgICAgICAgICAgICAgICBpZiAoZiA9PT0gMCkgYnJlYWsgZTsKICAgICAgICAgICAgICAgIGYtLSwgciArPSBuW2wrK10gPDwgXywgXyArPSA4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgociAmIDY1NTM1KSAhPT0gKHIgPj4+IDE2IF4gNjU1MzUpKSB7CiAgICAgICAgICAgICAgICBlLm1zZyA9ICJpbnZhbGlkIHN0b3JlZCBibG9jayBsZW5ndGhzIiwgdC5tb2RlID0gVDE7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodC5sZW5ndGggPSByICYgNjU1MzUsIHIgPSAwLCBfID0gMCwgdC5tb2RlID0gdHQsIGkgPT09IE5lKSBicmVhayBlOwogICAgICAgIGNhc2UgdHQ6CiAgICAgICAgICAgIHQubW9kZSA9IEt0OwogICAgICAgIGNhc2UgS3Q6CiAgICAgICAgICAgIGlmIChoID0gdC5sZW5ndGgsIGgpIHsKICAgICAgICAgICAgICAgIGlmIChoID4gZiAmJiAoaCA9IGYpLCBoID4gYyAmJiAoaCA9IGMpLCBoID09PSAwKSBicmVhayBlOwogICAgICAgICAgICAgICAgYS5zZXQobi5zdWJhcnJheShsLCBsICsgaCksIG8pLCBmIC09IGgsIGwgKz0gaCwgYyAtPSBoLCBvICs9IGgsIHQubGVuZ3RoIC09IGg7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICB0Lm1vZGUgPSBIOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIFB0OgogICAgICAgICAgICBmb3IoOyBfIDwgMTQ7KXsKICAgICAgICAgICAgICAgIGlmIChmID09PSAwKSBicmVhayBlOwogICAgICAgICAgICAgICAgZi0tLCByICs9IG5bbCsrXSA8PCBfLCBfICs9IDg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHQubmxlbiA9IChyICYgMzEpICsgMjU3LCByID4+Pj0gNSwgXyAtPSA1LCB0Lm5kaXN0ID0gKHIgJiAzMSkgKyAxLCByID4+Pj0gNSwgXyAtPSA1LCB0Lm5jb2RlID0gKHIgJiAxNSkgKyA0LCByID4+Pj0gNCwgXyAtPSA0LCB0Lm5sZW4gPiAyODYgfHwgdC5uZGlzdCA+IDMwKSB7CiAgICAgICAgICAgICAgICBlLm1zZyA9ICJ0b28gbWFueSBsZW5ndGggb3IgZGlzdGFuY2Ugc3ltYm9scyIsIHQubW9kZSA9IFQxOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdC5oYXZlID0gMCwgdC5tb2RlID0gWHQ7CiAgICAgICAgY2FzZSBYdDoKICAgICAgICAgICAgZm9yKDsgdC5oYXZlIDwgdC5uY29kZTspewogICAgICAgICAgICAgICAgZm9yKDsgXyA8IDM7KXsKICAgICAgICAgICAgICAgICAgICBpZiAoZiA9PT0gMCkgYnJlYWsgZTsKICAgICAgICAgICAgICAgICAgICBmLS0sIHIgKz0gbltsKytdIDw8IF8sIF8gKz0gODsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHQubGVuc1tKW3QuaGF2ZSsrXV0gPSByICYgNywgciA+Pj49IDMsIF8gLT0gMzsKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IoOyB0LmhhdmUgPCAxOTspdC5sZW5zW0pbdC5oYXZlKytdXSA9IDA7CiAgICAgICAgICAgIGlmICh0LmxlbmNvZGUgPSB0LmxlbmR5biwgdC5sZW5iaXRzID0gNywgZyA9IHsKICAgICAgICAgICAgICAgIGJpdHM6IHQubGVuYml0cwogICAgICAgICAgICB9LCB6ID0gd2UoTm4sIHQubGVucywgMCwgMTksIHQubGVuY29kZSwgMCwgdC53b3JrLCBnKSwgdC5sZW5iaXRzID0gZy5iaXRzLCB6KSB7CiAgICAgICAgICAgICAgICBlLm1zZyA9ICJpbnZhbGlkIGNvZGUgbGVuZ3RocyBzZXQiLCB0Lm1vZGUgPSBUMTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHQuaGF2ZSA9IDAsIHQubW9kZSA9IFl0OwogICAgICAgIGNhc2UgWXQ6CiAgICAgICAgICAgIGZvcig7IHQuaGF2ZSA8IHQubmxlbiArIHQubmRpc3Q7KXsKICAgICAgICAgICAgICAgIGZvcig7IHYgPSB0LmxlbmNvZGVbciAmICgxIDw8IHQubGVuYml0cykgLSAxXSwgdyA9IHYgPj4+IDI0LCBBID0gdiA+Pj4gMTYgJiAyNTUsIHggPSB2ICYgNjU1MzUsICEodyA8PSBfKTspewogICAgICAgICAgICAgICAgICAgIGlmIChmID09PSAwKSBicmVhayBlOwogICAgICAgICAgICAgICAgICAgIGYtLSwgciArPSBuW2wrK10gPDwgXywgXyArPSA4OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHggPCAxNikgciA+Pj49IHcsIF8gLT0gdywgdC5sZW5zW3QuaGF2ZSsrXSA9IHg7CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBpZiAoeCA9PT0gMTYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yKHAgPSB3ICsgMjsgXyA8IHA7KXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmID09PSAwKSBicmVhayBlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZi0tLCByICs9IG5bbCsrXSA8PCBfLCBfICs9IDg7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHIgPj4+PSB3LCBfIC09IHcsIHQuaGF2ZSA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5tc2cgPSAiaW52YWxpZCBiaXQgbGVuZ3RoIHJlcGVhdCIsIHQubW9kZSA9IFQxOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgYiA9IHQubGVuc1t0LmhhdmUgLSAxXSwgaCA9IDMgKyAociAmIDMpLCByID4+Pj0gMiwgXyAtPSAyOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoeCA9PT0gMTcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yKHAgPSB3ICsgMzsgXyA8IHA7KXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmID09PSAwKSBicmVhayBlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZi0tLCByICs9IG5bbCsrXSA8PCBfLCBfICs9IDg7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgciA+Pj49IHcsIF8gLT0gdywgYiA9IDAsIGggPSAzICsgKHIgJiA3KSwgciA+Pj49IDMsIF8gLT0gMzsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBmb3IocCA9IHcgKyA3OyBfIDwgcDspewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGYgPT09IDApIGJyZWFrIGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmLS0sIHIgKz0gbltsKytdIDw8IF8sIF8gKz0gODsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICByID4+Pj0gdywgXyAtPSB3LCBiID0gMCwgaCA9IDExICsgKHIgJiAxMjcpLCByID4+Pj0gNywgXyAtPSA3OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAodC5oYXZlICsgaCA+IHQubmxlbiArIHQubmRpc3QpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZS5tc2cgPSAiaW52YWxpZCBiaXQgbGVuZ3RoIHJlcGVhdCIsIHQubW9kZSA9IFQxOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZm9yKDsgaC0tOyl0LmxlbnNbdC5oYXZlKytdID0gYjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodC5tb2RlID09PSBUMSkgYnJlYWs7CiAgICAgICAgICAgIGlmICh0LmxlbnNbMjU2XSA9PT0gMCkgewogICAgICAgICAgICAgICAgZS5tc2cgPSAiaW52YWxpZCBjb2RlIC0tIG1pc3NpbmcgZW5kLW9mLWJsb2NrIiwgdC5tb2RlID0gVDE7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodC5sZW5iaXRzID0gOSwgZyA9IHsKICAgICAgICAgICAgICAgIGJpdHM6IHQubGVuYml0cwogICAgICAgICAgICB9LCB6ID0gd2UoQWksIHQubGVucywgMCwgdC5ubGVuLCB0LmxlbmNvZGUsIDAsIHQud29yaywgZyksIHQubGVuYml0cyA9IGcuYml0cywgeikgewogICAgICAgICAgICAgICAgZS5tc2cgPSAiaW52YWxpZCBsaXRlcmFsL2xlbmd0aHMgc2V0IiwgdC5tb2RlID0gVDE7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodC5kaXN0Yml0cyA9IDYsIHQuZGlzdGNvZGUgPSB0LmRpc3RkeW4sIGcgPSB7CiAgICAgICAgICAgICAgICBiaXRzOiB0LmRpc3RiaXRzCiAgICAgICAgICAgIH0sIHogPSB3ZShSaSwgdC5sZW5zLCB0Lm5sZW4sIHQubmRpc3QsIHQuZGlzdGNvZGUsIDAsIHQud29yaywgZyksIHQuZGlzdGJpdHMgPSBnLmJpdHMsIHopIHsKICAgICAgICAgICAgICAgIGUubXNnID0gImludmFsaWQgZGlzdGFuY2VzIHNldCIsIHQubW9kZSA9IFQxOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHQubW9kZSA9IExlLCBpID09PSBOZSkgYnJlYWsgZTsKICAgICAgICBjYXNlIExlOgogICAgICAgICAgICB0Lm1vZGUgPSBVZTsKICAgICAgICBjYXNlIFVlOgogICAgICAgICAgICBpZiAoZiA+PSA2ICYmIGMgPj0gMjU4KSB7CiAgICAgICAgICAgICAgICBlLm5leHRfb3V0ID0gbywgZS5hdmFpbF9vdXQgPSBjLCBlLm5leHRfaW4gPSBsLCBlLmF2YWlsX2luID0gZiwgdC5ob2xkID0gciwgdC5iaXRzID0gXywgVG4oZSwgcyksIG8gPSBlLm5leHRfb3V0LCBhID0gZS5vdXRwdXQsIGMgPSBlLmF2YWlsX291dCwgbCA9IGUubmV4dF9pbiwgbiA9IGUuaW5wdXQsIGYgPSBlLmF2YWlsX2luLCByID0gdC5ob2xkLCBfID0gdC5iaXRzLCB0Lm1vZGUgPT09IEggJiYgKHQuYmFjayA9IC0xKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvcih0LmJhY2sgPSAwOyB2ID0gdC5sZW5jb2RlW3IgJiAoMSA8PCB0LmxlbmJpdHMpIC0gMV0sIHcgPSB2ID4+PiAyNCwgQSA9IHYgPj4+IDE2ICYgMjU1LCB4ID0gdiAmIDY1NTM1LCAhKHcgPD0gXyk7KXsKICAgICAgICAgICAgICAgIGlmIChmID09PSAwKSBicmVhayBlOwogICAgICAgICAgICAgICAgZi0tLCByICs9IG5bbCsrXSA8PCBfLCBfICs9IDg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKEEgJiYgIShBICYgMjQwKSkgewogICAgICAgICAgICAgICAgZm9yKGQgPSB3LCBTID0gQSwgWiA9IHg7IHYgPSB0LmxlbmNvZGVbWiArICgociAmICgxIDw8IGQgKyBTKSAtIDEpID4+IGQpXSwgdyA9IHYgPj4+IDI0LCBBID0gdiA+Pj4gMTYgJiAyNTUsIHggPSB2ICYgNjU1MzUsICEoZCArIHcgPD0gXyk7KXsKICAgICAgICAgICAgICAgICAgICBpZiAoZiA9PT0gMCkgYnJlYWsgZTsKICAgICAgICAgICAgICAgICAgICBmLS0sIHIgKz0gbltsKytdIDw8IF8sIF8gKz0gODsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHIgPj4+PSBkLCBfIC09IGQsIHQuYmFjayArPSBkOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChyID4+Pj0gdywgXyAtPSB3LCB0LmJhY2sgKz0gdywgdC5sZW5ndGggPSB4LCBBID09PSAwKSB7CiAgICAgICAgICAgICAgICB0Lm1vZGUgPSBKdDsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChBICYgMzIpIHsKICAgICAgICAgICAgICAgIHQuYmFjayA9IC0xLCB0Lm1vZGUgPSBIOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKEEgJiA2NCkgewogICAgICAgICAgICAgICAgZS5tc2cgPSAiaW52YWxpZCBsaXRlcmFsL2xlbmd0aCBjb2RlIiwgdC5tb2RlID0gVDE7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICB0LmV4dHJhID0gQSAmIDE1LCB0Lm1vZGUgPSBHdDsKICAgICAgICBjYXNlIEd0OgogICAgICAgICAgICBpZiAodC5leHRyYSkgewogICAgICAgICAgICAgICAgZm9yKHAgPSB0LmV4dHJhOyBfIDwgcDspewogICAgICAgICAgICAgICAgICAgIGlmIChmID09PSAwKSBicmVhayBlOwogICAgICAgICAgICAgICAgICAgIGYtLSwgciArPSBuW2wrK10gPDwgXywgXyArPSA4OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdC5sZW5ndGggKz0gciAmICgxIDw8IHQuZXh0cmEpIC0gMSwgciA+Pj49IHQuZXh0cmEsIF8gLT0gdC5leHRyYSwgdC5iYWNrICs9IHQuZXh0cmE7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdC53YXMgPSB0Lmxlbmd0aCwgdC5tb2RlID0ganQ7CiAgICAgICAgY2FzZSBqdDoKICAgICAgICAgICAgZm9yKDsgdiA9IHQuZGlzdGNvZGVbciAmICgxIDw8IHQuZGlzdGJpdHMpIC0gMV0sIHcgPSB2ID4+PiAyNCwgQSA9IHYgPj4+IDE2ICYgMjU1LCB4ID0gdiAmIDY1NTM1LCAhKHcgPD0gXyk7KXsKICAgICAgICAgICAgICAgIGlmIChmID09PSAwKSBicmVhayBlOwogICAgICAgICAgICAgICAgZi0tLCByICs9IG5bbCsrXSA8PCBfLCBfICs9IDg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCEoQSAmIDI0MCkpIHsKICAgICAgICAgICAgICAgIGZvcihkID0gdywgUyA9IEEsIFogPSB4OyB2ID0gdC5kaXN0Y29kZVtaICsgKChyICYgKDEgPDwgZCArIFMpIC0gMSkgPj4gZCldLCB3ID0gdiA+Pj4gMjQsIEEgPSB2ID4+PiAxNiAmIDI1NSwgeCA9IHYgJiA2NTUzNSwgIShkICsgdyA8PSBfKTspewogICAgICAgICAgICAgICAgICAgIGlmIChmID09PSAwKSBicmVhayBlOwogICAgICAgICAgICAgICAgICAgIGYtLSwgciArPSBuW2wrK10gPDwgXywgXyArPSA4OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgciA+Pj49IGQsIF8gLT0gZCwgdC5iYWNrICs9IGQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHIgPj4+PSB3LCBfIC09IHcsIHQuYmFjayArPSB3LCBBICYgNjQpIHsKICAgICAgICAgICAgICAgIGUubXNnID0gImludmFsaWQgZGlzdGFuY2UgY29kZSIsIHQubW9kZSA9IFQxOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdC5vZmZzZXQgPSB4LCB0LmV4dHJhID0gQSAmIDE1LCB0Lm1vZGUgPSBXdDsKICAgICAgICBjYXNlIFd0OgogICAgICAgICAgICBpZiAodC5leHRyYSkgewogICAgICAgICAgICAgICAgZm9yKHAgPSB0LmV4dHJhOyBfIDwgcDspewogICAgICAgICAgICAgICAgICAgIGlmIChmID09PSAwKSBicmVhayBlOwogICAgICAgICAgICAgICAgICAgIGYtLSwgciArPSBuW2wrK10gPDwgXywgXyArPSA4OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdC5vZmZzZXQgKz0gciAmICgxIDw8IHQuZXh0cmEpIC0gMSwgciA+Pj49IHQuZXh0cmEsIF8gLT0gdC5leHRyYSwgdC5iYWNrICs9IHQuZXh0cmE7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHQub2Zmc2V0ID4gdC5kbWF4KSB7CiAgICAgICAgICAgICAgICBlLm1zZyA9ICJpbnZhbGlkIGRpc3RhbmNlIHRvbyBmYXIgYmFjayIsIHQubW9kZSA9IFQxOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdC5tb2RlID0gVnQ7CiAgICAgICAgY2FzZSBWdDoKICAgICAgICAgICAgaWYgKGMgPT09IDApIGJyZWFrIGU7CiAgICAgICAgICAgIGlmIChoID0gcyAtIGMsIHQub2Zmc2V0ID4gaCkgewogICAgICAgICAgICAgICAgaWYgKGggPSB0Lm9mZnNldCAtIGgsIGggPiB0LndoYXZlICYmIHQuc2FuZSkgewogICAgICAgICAgICAgICAgICAgIGUubXNnID0gImludmFsaWQgZGlzdGFuY2UgdG9vIGZhciBiYWNrIiwgdC5tb2RlID0gVDE7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBoID4gdC53bmV4dCA/IChoIC09IHQud25leHQsIHUgPSB0LndzaXplIC0gaCkgOiB1ID0gdC53bmV4dCAtIGgsIGggPiB0Lmxlbmd0aCAmJiAoaCA9IHQubGVuZ3RoKSwgbSA9IHQud2luZG93OwogICAgICAgICAgICB9IGVsc2UgbSA9IGEsIHUgPSBvIC0gdC5vZmZzZXQsIGggPSB0Lmxlbmd0aDsKICAgICAgICAgICAgaCA+IGMgJiYgKGggPSBjKSwgYyAtPSBoLCB0Lmxlbmd0aCAtPSBoOwogICAgICAgICAgICBkbyBhW28rK10gPSBtW3UrK107CiAgICAgICAgICAgIHdoaWxlICgtLWgpCiAgICAgICAgICAgIHQubGVuZ3RoID09PSAwICYmICh0Lm1vZGUgPSBVZSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgSnQ6CiAgICAgICAgICAgIGlmIChjID09PSAwKSBicmVhayBlOwogICAgICAgICAgICBhW28rK10gPSB0Lmxlbmd0aCwgYy0tLCB0Lm1vZGUgPSBVZTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBpdDoKICAgICAgICAgICAgaWYgKHQud3JhcCkgewogICAgICAgICAgICAgICAgZm9yKDsgXyA8IDMyOyl7CiAgICAgICAgICAgICAgICAgICAgaWYgKGYgPT09IDApIGJyZWFrIGU7CiAgICAgICAgICAgICAgICAgICAgZi0tLCByIHw9IG5bbCsrXSA8PCBfLCBfICs9IDg7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAocyAtPSBjLCBlLnRvdGFsX291dCArPSBzLCB0LnRvdGFsICs9IHMsIHMgJiYgKGUuYWRsZXIgPSB0LmNoZWNrID0gdC5mbGFncyA/IEkodC5jaGVjaywgYSwgcywgbyAtIHMpIDogdmUodC5jaGVjaywgYSwgcywgbyAtIHMpKSwgcyA9IGMsICh0LmZsYWdzID8gciA6IGVpKHIpKSAhPT0gdC5jaGVjaykgewogICAgICAgICAgICAgICAgICAgIGUubXNnID0gImluY29ycmVjdCBkYXRhIGNoZWNrIiwgdC5tb2RlID0gVDE7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByID0gMCwgXyA9IDA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdC5tb2RlID0gUXQ7CiAgICAgICAgY2FzZSBRdDoKICAgICAgICAgICAgaWYgKHQud3JhcCAmJiB0LmZsYWdzKSB7CiAgICAgICAgICAgICAgICBmb3IoOyBfIDwgMzI7KXsKICAgICAgICAgICAgICAgICAgICBpZiAoZiA9PT0gMCkgYnJlYWsgZTsKICAgICAgICAgICAgICAgICAgICBmLS0sIHIgKz0gbltsKytdIDw8IF8sIF8gKz0gODsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChyICE9PSAodC50b3RhbCAmIDQyOTQ5NjcyOTUpKSB7CiAgICAgICAgICAgICAgICAgICAgZS5tc2cgPSAiaW5jb3JyZWN0IGxlbmd0aCBjaGVjayIsIHQubW9kZSA9IFQxOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgciA9IDAsIF8gPSAwOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHQubW9kZSA9IHF0OwogICAgICAgIGNhc2UgcXQ6CiAgICAgICAgICAgIHogPSBVbjsKICAgICAgICAgICAgYnJlYWsgZTsKICAgICAgICBjYXNlIFQxOgogICAgICAgICAgICB6ID0gemk7CiAgICAgICAgICAgIGJyZWFrIGU7CiAgICAgICAgY2FzZSBEaToKICAgICAgICAgICAgcmV0dXJuIFRpOwogICAgICAgIGNhc2UgRm46CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgcmV0dXJuIFU7CiAgICB9CiAgICByZXR1cm4gZS5uZXh0X291dCA9IG8sIGUuYXZhaWxfb3V0ID0gYywgZS5uZXh0X2luID0gbCwgZS5hdmFpbF9pbiA9IGYsIHQuaG9sZCA9IHIsIHQuYml0cyA9IF8sICh0LndzaXplIHx8IHMgIT09IGUuYXZhaWxfb3V0ICYmIHQubW9kZSA8IFQxICYmICh0Lm1vZGUgPCBpdCB8fCBpICE9PSBadCkpICYmIExpKGUsIGUub3V0cHV0LCBlLm5leHRfb3V0LCBzIC0gZS5hdmFpbF9vdXQpLCBFIC09IGUuYXZhaWxfaW4sIHMgLT0gZS5hdmFpbF9vdXQsIGUudG90YWxfaW4gKz0gRSwgZS50b3RhbF9vdXQgKz0gcywgdC50b3RhbCArPSBzLCB0LndyYXAgJiYgcyAmJiAoZS5hZGxlciA9IHQuY2hlY2sgPSB0LmZsYWdzID8gSSh0LmNoZWNrLCBhLCBzLCBlLm5leHRfb3V0IC0gcykgOiB2ZSh0LmNoZWNrLCBhLCBzLCBlLm5leHRfb3V0IC0gcykpLCBlLmRhdGFfdHlwZSA9IHQuYml0cyArICh0Lmxhc3QgPyA2NCA6IDApICsgKHQubW9kZSA9PT0gSCA/IDEyOCA6IDApICsgKHQubW9kZSA9PT0gTGUgfHwgdC5tb2RlID09PSB0dCA/IDI1NiA6IDApLCAoRSA9PT0gMCAmJiBzID09PSAwIHx8IGkgPT09IFp0KSAmJiB6ID09PSBhZSAmJiAoeiA9IENuKSwgejsKfSwgam4gPSAoZSk9PnsKICAgIGlmICghZSB8fCAhZS5zdGF0ZSkgcmV0dXJuIFU7CiAgICBsZXQgaSA9IGUuc3RhdGU7CiAgICByZXR1cm4gaS53aW5kb3cgJiYgKGkud2luZG93ID0gbnVsbCksIGUuc3RhdGUgPSBudWxsLCBhZTsKfSwgV24gPSAoZSwgaSk9PnsKICAgIGlmICghZSB8fCAhZS5zdGF0ZSkgcmV0dXJuIFU7CiAgICBsZXQgdCA9IGUuc3RhdGU7CiAgICByZXR1cm4gdC53cmFwICYgMiA/ICh0LmhlYWQgPSBpLCBpLmRvbmUgPSAhMSwgYWUpIDogVTsKfSwgVm4gPSAoZSwgaSk9PnsKICAgIGxldCB0ID0gaS5sZW5ndGgsIG4sIGEsIGw7CiAgICByZXR1cm4gIWUgfHwgIWUuc3RhdGUgfHwgKG4gPSBlLnN0YXRlLCBuLndyYXAgIT09IDAgJiYgbi5tb2RlICE9PSBLZSkgPyBVIDogbi5tb2RlID09PSBLZSAmJiAoYSA9IDEsIGEgPSB2ZShhLCBpLCB0LCAwKSwgYSAhPT0gbi5jaGVjaykgPyB6aSA6IChsID0gTGkoZSwgaSwgdCwgdCksIGwgPyAobi5tb2RlID0gRGksIFRpKSA6IChuLmhhdmVkaWN0ID0gMSwgYWUpKTsKfSwgSm4gPSBJaSwgUW4gPSBPaSwgcW4gPSBaaSwgZWwgPSBYbiwgdGwgPSBOaSwgaWwgPSBHbiwgYWwgPSBqbiwgbmwgPSBXbiwgbGwgPSBWbiwgcmwgPSAicGFrbyBpbmZsYXRlIChmcm9tIE5vZGVjYSBwcm9qZWN0KSIsIEsgPSB7CiAgICBpbmZsYXRlUmVzZXQ6IEpuLAogICAgaW5mbGF0ZVJlc2V0MjogUW4sCiAgICBpbmZsYXRlUmVzZXRLZWVwOiBxbiwKICAgIGluZmxhdGVJbml0OiBlbCwKICAgIGluZmxhdGVJbml0MjogdGwsCiAgICBpbmZsYXRlOiBpbCwKICAgIGluZmxhdGVFbmQ6IGFsLAogICAgaW5mbGF0ZUdldEhlYWRlcjogbmwsCiAgICBpbmZsYXRlU2V0RGljdGlvbmFyeTogbGwsCiAgICBpbmZsYXRlSW5mbzogcmwKfTsKZnVuY3Rpb24gZmwoKSB7CiAgICB0aGlzLnRleHQgPSAwLCB0aGlzLnRpbWUgPSAwLCB0aGlzLnhmbGFncyA9IDAsIHRoaXMub3MgPSAwLCB0aGlzLmV4dHJhID0gbnVsbCwgdGhpcy5leHRyYV9sZW4gPSAwLCB0aGlzLm5hbWUgPSAiIiwgdGhpcy5jb21tZW50ID0gIiIsIHRoaXMuaGNyYyA9IDAsIHRoaXMuZG9uZSA9ICExOwp9CnZhciBvbCA9IGZsLCBVaSA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcsIHsgWl9OT19GTFVTSDogX2wgLCBaX0ZJTklTSDogaGwgLCBaX09LOiBTZSAsIFpfU1RSRUFNX0VORDogbHQgLCBaX05FRURfRElDVDogcnQgLCBaX1NUUkVBTV9FUlJPUjogZGwgLCBaX0RBVEFfRVJST1I6IGlpICwgWl9NRU1fRVJST1I6IHNsICB9ID0gbmU7CmZ1bmN0aW9uIFRlKGUpIHsKICAgIHRoaXMub3B0aW9ucyA9IFllLmFzc2lnbih7CiAgICAgICAgY2h1bmtTaXplOiAxMDI0ICogNjQsCiAgICAgICAgd2luZG93Qml0czogMTUsCiAgICAgICAgdG86ICIiCiAgICB9LCBlIHx8IHt9KTsKICAgIGxldCBpID0gdGhpcy5vcHRpb25zOwogICAgaS5yYXcgJiYgaS53aW5kb3dCaXRzID49IDAgJiYgaS53aW5kb3dCaXRzIDwgMTYgJiYgKGkud2luZG93Qml0cyA9IC1pLndpbmRvd0JpdHMsIGkud2luZG93Qml0cyA9PT0gMCAmJiAoaS53aW5kb3dCaXRzID0gLTE1KSksIGkud2luZG93Qml0cyA+PSAwICYmIGkud2luZG93Qml0cyA8IDE2ICYmICEoZSAmJiBlLndpbmRvd0JpdHMpICYmIChpLndpbmRvd0JpdHMgKz0gMzIpLCBpLndpbmRvd0JpdHMgPiAxNSAmJiBpLndpbmRvd0JpdHMgPCA0OCAmJiAoaS53aW5kb3dCaXRzICYgMTUgfHwgKGkud2luZG93Qml0cyB8PSAxNSkpLCB0aGlzLmVyciA9IDAsIHRoaXMubXNnID0gIiIsIHRoaXMuZW5kZWQgPSAhMSwgdGhpcy5jaHVua3MgPSBbXSwgdGhpcy5zdHJtID0gbmV3IHlpLCB0aGlzLnN0cm0uYXZhaWxfb3V0ID0gMDsKICAgIGxldCB0ID0gSy5pbmZsYXRlSW5pdDIodGhpcy5zdHJtLCBpLndpbmRvd0JpdHMpOwogICAgaWYgKHQgIT09IFNlKSB0aHJvdyBuZXcgRXJyb3IoZWVbdF0pOwogICAgaWYgKHRoaXMuaGVhZGVyID0gbmV3IG9sLCBLLmluZmxhdGVHZXRIZWFkZXIodGhpcy5zdHJtLCB0aGlzLmhlYWRlciksIGkuZGljdGlvbmFyeSAmJiAodHlwZW9mIGkuZGljdGlvbmFyeSA9PSAic3RyaW5nIiA/IGkuZGljdGlvbmFyeSA9IHllLnN0cmluZzJidWYoaS5kaWN0aW9uYXJ5KSA6IFVpLmNhbGwoaS5kaWN0aW9uYXJ5KSA9PT0gIltvYmplY3QgQXJyYXlCdWZmZXJdIiAmJiAoaS5kaWN0aW9uYXJ5ID0gbmV3IFVpbnQ4QXJyYXkoaS5kaWN0aW9uYXJ5KSksIGkucmF3ICYmICh0ID0gSy5pbmZsYXRlU2V0RGljdGlvbmFyeSh0aGlzLnN0cm0sIGkuZGljdGlvbmFyeSksIHQgIT09IFNlKSkpIHRocm93IG5ldyBFcnJvcihlZVt0XSk7Cn0KVGUucHJvdG90eXBlLnB1c2ggPSBmdW5jdGlvbihlLCBpKSB7CiAgICBsZXQgdCA9IHRoaXMuc3RybSwgbiA9IHRoaXMub3B0aW9ucy5jaHVua1NpemUsIGEgPSB0aGlzLm9wdGlvbnMuZGljdGlvbmFyeSwgbCwgbywgZjsKICAgIGlmICh0aGlzLmVuZGVkKSByZXR1cm4gITE7CiAgICBmb3IoaSA9PT0gfn5pID8gbyA9IGkgOiBvID0gaSA9PT0gITAgPyBobCA6IF9sLCBVaS5jYWxsKGUpID09PSAiW29iamVjdCBBcnJheUJ1ZmZlcl0iID8gdC5pbnB1dCA9IG5ldyBVaW50OEFycmF5KGUpIDogdC5pbnB1dCA9IGUsIHQubmV4dF9pbiA9IDAsIHQuYXZhaWxfaW4gPSB0LmlucHV0Lmxlbmd0aDs7KXsKICAgICAgICBmb3IodC5hdmFpbF9vdXQgPT09IDAgJiYgKHQub3V0cHV0ID0gbmV3IFVpbnQ4QXJyYXkobiksIHQubmV4dF9vdXQgPSAwLCB0LmF2YWlsX291dCA9IG4pLCBsID0gSy5pbmZsYXRlKHQsIG8pLCBsID09PSBydCAmJiBhICYmIChsID0gSy5pbmZsYXRlU2V0RGljdGlvbmFyeSh0LCBhKSwgbCA9PT0gU2UgPyBsID0gSy5pbmZsYXRlKHQsIG8pIDogbCA9PT0gaWkgJiYgKGwgPSBydCkpOyB0LmF2YWlsX2luID4gMCAmJiBsID09PSBsdCAmJiB0LnN0YXRlLndyYXAgPiAwICYmIGVbdC5uZXh0X2luXSAhPT0gMDspSy5pbmZsYXRlUmVzZXQodCksIGwgPSBLLmluZmxhdGUodCwgbyk7CiAgICAgICAgc3dpdGNoKGwpewogICAgICAgICAgICBjYXNlIGRsOgogICAgICAgICAgICBjYXNlIGlpOgogICAgICAgICAgICBjYXNlIHJ0OgogICAgICAgICAgICBjYXNlIHNsOgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMub25FbmQobCksIHRoaXMuZW5kZWQgPSAhMCwgITE7CiAgICAgICAgfQogICAgICAgIGlmIChmID0gdC5hdmFpbF9vdXQsIHQubmV4dF9vdXQgJiYgKHQuYXZhaWxfb3V0ID09PSAwIHx8IGwgPT09IGx0KSkgaWYgKHRoaXMub3B0aW9ucy50byA9PT0gInN0cmluZyIpIHsKICAgICAgICAgICAgbGV0IGMgPSB5ZS51dGY4Ym9yZGVyKHQub3V0cHV0LCB0Lm5leHRfb3V0KSwgciA9IHQubmV4dF9vdXQgLSBjLCBfID0geWUuYnVmMnN0cmluZyh0Lm91dHB1dCwgYyk7CiAgICAgICAgICAgIHQubmV4dF9vdXQgPSByLCB0LmF2YWlsX291dCA9IG4gLSByLCByICYmIHQub3V0cHV0LnNldCh0Lm91dHB1dC5zdWJhcnJheShjLCBjICsgciksIDApLCB0aGlzLm9uRGF0YShfKTsKICAgICAgICB9IGVsc2UgdGhpcy5vbkRhdGEodC5vdXRwdXQubGVuZ3RoID09PSB0Lm5leHRfb3V0ID8gdC5vdXRwdXQgOiB0Lm91dHB1dC5zdWJhcnJheSgwLCB0Lm5leHRfb3V0KSk7CiAgICAgICAgaWYgKCEobCA9PT0gU2UgJiYgZiA9PT0gMCkpIHsKICAgICAgICAgICAgaWYgKGwgPT09IGx0KSByZXR1cm4gbCA9IEsuaW5mbGF0ZUVuZCh0aGlzLnN0cm0pLCB0aGlzLm9uRW5kKGwpLCB0aGlzLmVuZGVkID0gITAsICEwOwogICAgICAgICAgICBpZiAodC5hdmFpbF9pbiA9PT0gMCkgYnJlYWs7CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuICEwOwp9OwpUZS5wcm90b3R5cGUub25EYXRhID0gZnVuY3Rpb24oZSkgewogICAgdGhpcy5jaHVua3MucHVzaChlKTsKfTsKVGUucHJvdG90eXBlLm9uRW5kID0gZnVuY3Rpb24oZSkgewogICAgZSA9PT0gU2UgJiYgKHRoaXMub3B0aW9ucy50byA9PT0gInN0cmluZyIgPyB0aGlzLnJlc3VsdCA9IHRoaXMuY2h1bmtzLmpvaW4oIiIpIDogdGhpcy5yZXN1bHQgPSBZZS5mbGF0dGVuQ2h1bmtzKHRoaXMuY2h1bmtzKSksIHRoaXMuY2h1bmtzID0gW10sIHRoaXMuZXJyID0gZSwgdGhpcy5tc2cgPSB0aGlzLnN0cm0ubXNnOwp9OwpmdW5jdGlvbiB3dChlLCBpKSB7CiAgICBsZXQgdCA9IG5ldyBUZShpKTsKICAgIGlmICh0LnB1c2goZSksIHQuZXJyKSB0aHJvdyB0Lm1zZyB8fCBlZVt0LmVycl07CiAgICByZXR1cm4gdC5yZXN1bHQ7Cn0KZnVuY3Rpb24gY2woZSwgaSkgewogICAgcmV0dXJuIGkgPSBpIHx8IHt9LCBpLnJhdyA9ICEwLCB3dChlLCBpKTsKfQp2YXIgdWwgPSBUZSwgYmwgPSB3dCwgd2wgPSBjbCwgZ2wgPSB3dCwgcGwgPSBuZSwgeGwgPSB7CiAgICBJbmZsYXRlOiB1bCwKICAgIGluZmxhdGU6IGJsLAogICAgaW5mbGF0ZVJhdzogd2wsCiAgICB1bmd6aXA6IGdsLAogICAgY29uc3RhbnRzOiBwbAp9LCB7IERlZmxhdGU6IGtsICwgZGVmbGF0ZTogdmwgLCBkZWZsYXRlUmF3OiBFbCAsIGd6aXA6IHlsICB9ID0gUm4sIHsgSW5mbGF0ZTogU2wgLCBpbmZsYXRlOiBBbCAsIGluZmxhdGVSYXc6IFJsICwgdW5nemlwOiB6bCAgfSA9IHhsLCBtbCA9IHZsLCBPbCA9IEFsOwpjb25zdCBVcGRhdGVPYnNlcnZhYmxlID0gIjAiOwpjbGFzcyBSZXRhaW4gewogICAgY29uc3RydWN0b3IodmFsdWUpewogICAgICAgIHRoaXMudmFsdWUgPSB2YWx1ZTsKICAgIH0KfQpjb25zdCBPbmpzQ2FsbGJhY2sgPSAiMSI7CmNvbnN0IEV2YWxKYXZhc2NyaXB0ID0gIjIiOwpjb25zdCBKYXZhc2NyaXB0RXJyb3IgPSAiMyI7CmNvbnN0IEphdmFzY3JpcHRXYXJuaW5nID0gIjQiOwpjb25zdCBSZWdpc3Rlck9ic2VydmFibGUgPSAiNSI7CmNvbnN0IEpTRG9uZUxvYWRpbmcgPSAiOCI7CmNvbnN0IEZ1c2VkTWVzc2FnZSA9ICI5IjsKY29uc3QgQ2xvc2VTZXNzaW9uID0gIjEwIjsKY29uc3QgUGluZ1BvbmcgPSAiMTEiOwpjb25zdCBVcGRhdGVTZXNzaW9uID0gIjEyIjsKY29uc3QgUElOR19JTlRFUlZBTCA9IDUwMDA7CmZ1bmN0aW9uIGNsZWFuX3N0YWNrKHN0YWNrKSB7CiAgICByZXR1cm4gc3RhY2sucmVwbGFjZUFsbCgvKGRhdGE6XHcrXC9cdys7YmFzZTY0LClbYS16QS1aMC05XCtcLz1dKzovZywgIiQxPDxCQVNFNjQ+PjoiKTsKfQpjb25zdCBDT05ORUNUSU9OID0gewogICAgc2VuZF9tZXNzYWdlOiB1bmRlZmluZWQsCiAgICBxdWV1ZTogW10sCiAgICBzdGF0dXM6ICJjbG9zZWQiLAogICAgY29tcHJlc3Npb25fZW5hYmxlZDogZmFsc2UsCiAgICBsYXN0UGluZzogRGF0ZS5ub3coKQp9OwpmdW5jdGlvbiBvbl9jb25uZWN0aW9uX29wZW4oc2VuZF9tZXNzYWdlX2NhbGxiYWNrLCBjb21wcmVzc2lvbl9lbmFibGVkLCBlbmFibGVfcGluZ3MgPSB0cnVlKSB7CiAgICBDT05ORUNUSU9OLnNlbmRfbWVzc2FnZSA9IHNlbmRfbWVzc2FnZV9jYWxsYmFjazsKICAgIENPTk5FQ1RJT04uc3RhdHVzID0gIm9wZW4iOwogICAgQ09OTkVDVElPTi5jb21wcmVzc2lvbl9lbmFibGVkID0gY29tcHJlc3Npb25fZW5hYmxlZDsKICAgIENPTk5FQ1RJT04ucXVldWUuZm9yRWFjaCgobWVzc2FnZSk9PnNlbmRfdG9fanVsaWEobWVzc2FnZSkpOwogICAgaWYgKGVuYWJsZV9waW5ncykgewogICAgICAgIHNlbmRfcGluZ3MoKTsKICAgIH0KfQpmdW5jdGlvbiBvbl9jb25uZWN0aW9uX2Nsb3NlKCkgewogICAgQ09OTkVDVElPTi5zdGF0dXMgPSAiY2xvc2VkIjsKfQpmdW5jdGlvbiBjYW5fc2VuZF90b19qdWxpYSgpIHsKICAgIHJldHVybiBDT05ORUNUSU9OLnN0YXR1cyA9PT0gIm9wZW4iOwp9CmZ1bmN0aW9uIGlzX2p1bGlhX3Jlc3BvbnNpdmUoKSB7CiAgICByZXR1cm4gRGF0ZS5ub3coKSAtIENPTk5FQ1RJT04ubGFzdFBpbmcgPCAyICogNTAwMDsKfQpjb25zdCBFWFRFTlNJT05fQ09ERUMgPSBuZXcgRXh0ZW5zaW9uQ29kZWMoKTsKd2luZG93LkVYVEVOU0lPTl9DT0RFQyA9IEVYVEVOU0lPTl9DT0RFQzsKZnVuY3Rpb24gdW5wYWNrKHVpbnQ4YXJyYXkpIHsKICAgIHJldHVybiBkZWNvZGUodWludDhhcnJheSwgewogICAgICAgIGV4dGVuc2lvbkNvZGVjOiBFWFRFTlNJT05fQ09ERUMKICAgIH0pOwp9CmZ1bmN0aW9uIHBhY2sob2JqZWN0KSB7CiAgICByZXR1cm4gZW5jb2RlKG9iamVjdCwgewogICAgICAgIGV4dGVuc2lvbkNvZGVjOiBFWFRFTlNJT05fQ09ERUMKICAgIH0pOwp9CmZ1bmN0aW9uIHJlaW50ZXJwcmV0X2FycmF5KEFycmF5VHlwZSwgdWludDhhcnJheSkgewogICAgaWYgKEFycmF5VHlwZSA9PT0gVWludDhBcnJheSkgewogICAgICAgIHJldHVybiB1aW50OGFycmF5OwogICAgfSBlbHNlIHsKICAgICAgICBjb25zdCBibyA9IHVpbnQ4YXJyYXkuYnl0ZU9mZnNldDsKICAgICAgICBjb25zdCBicGUgPSBBcnJheVR5cGUuQllURVNfUEVSX0VMRU1FTlQ7CiAgICAgICAgY29uc3QgbmV3X2FycmF5X2xlbmd0aCA9IHVpbnQ4YXJyYXkuYnl0ZUxlbmd0aCAvIGJwZTsKICAgICAgICBjb25zdCBidWZmZXIgPSB1aW50OGFycmF5LmJ1ZmZlci5zbGljZShibywgYm8gKyB1aW50OGFycmF5LmJ5dGVMZW5ndGgpOwogICAgICAgIHJldHVybiBuZXcgQXJyYXlUeXBlKGJ1ZmZlciwgMCwgbmV3X2FycmF5X2xlbmd0aCk7CiAgICB9Cn0KZnVuY3Rpb24gcmVnaXN0ZXJfZXh0X2FycmF5KHR5cGVfdGFnLCBhcnJheV90eXBlKSB7CiAgICBFWFRFTlNJT05fQ09ERUMucmVnaXN0ZXIoewogICAgICAgIHR5cGU6IHR5cGVfdGFnLAogICAgICAgIGRlY29kZTogKHVpbnQ4YXJyYXkpPT5yZWludGVycHJldF9hcnJheShhcnJheV90eXBlLCB1aW50OGFycmF5KSwKICAgICAgICBlbmNvZGU6IChvYmplY3QpPT57CiAgICAgICAgICAgIGlmIChvYmplY3QgaW5zdGFuY2VvZiBhcnJheV90eXBlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFVpbnQ4QXJyYXkob2JqZWN0LmJ1ZmZlciwgb2JqZWN0LmJ5dGVPZmZzZXQsIG9iamVjdC5ieXRlTGVuZ3RoKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSk7Cn0KcmVnaXN0ZXJfZXh0X2FycmF5KDB4MTEsIEludDhBcnJheSk7CnJlZ2lzdGVyX2V4dF9hcnJheSgweDEyLCBVaW50OEFycmF5KTsKcmVnaXN0ZXJfZXh0X2FycmF5KDB4MTMsIEludDE2QXJyYXkpOwpyZWdpc3Rlcl9leHRfYXJyYXkoMHgxNCwgVWludDE2QXJyYXkpOwpyZWdpc3Rlcl9leHRfYXJyYXkoMHgxNSwgSW50MzJBcnJheSk7CnJlZ2lzdGVyX2V4dF9hcnJheSgweDE2LCBVaW50MzJBcnJheSk7CnJlZ2lzdGVyX2V4dF9hcnJheSgweDE3LCBGbG9hdDMyQXJyYXkpOwpyZWdpc3Rlcl9leHRfYXJyYXkoMHgxOCwgRmxvYXQ2NEFycmF5KTsKZnVuY3Rpb24gcmVnaXN0ZXJfZXh0KHR5cGVfdGFnLCBkZWNvZGUsIGVuY29kZSkgewogICAgRVhURU5TSU9OX0NPREVDLnJlZ2lzdGVyKHsKICAgICAgICB0eXBlOiB0eXBlX3RhZywKICAgICAgICBkZWNvZGUsCiAgICAgICAgZW5jb2RlCiAgICB9KTsKfQpjbGFzcyBKTEFycmF5IHsKICAgIGNvbnN0cnVjdG9yKHNpemUsIGFycmF5KXsKICAgICAgICB0aGlzLnNpemUgPSBzaXplOwogICAgICAgIHRoaXMuYXJyYXkgPSBhcnJheTsKICAgIH0KfQpyZWdpc3Rlcl9leHQoOTksICh1aW50XzhfYXJyYXkpPT57CiAgICBjb25zdCBbc2l6ZSwgYXJyYXldID0gdW5wYWNrKHVpbnRfOF9hcnJheSk7CiAgICByZXR1cm4gbmV3IEpMQXJyYXkoc2l6ZSwgYXJyYXkpOwp9LCAob2JqZWN0KT0+ewogICAgaWYgKG9iamVjdCBpbnN0YW5jZW9mIEpMQXJyYXkpIHsKICAgICAgICByZXR1cm4gcGFjayhbCiAgICAgICAgICAgIG9iamVjdC5zaXplLAogICAgICAgICAgICBvYmplY3QuYXJyYXkKICAgICAgICBdKTsKICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9Cn0pOwpjb25zdCBTRVNTSU9OUyA9IHt9Owpjb25zdCBHTE9CQUxfT0JKRUNUX0NBQ0hFID0ge307CmNvbnN0IE9CSkVDVF9GUkVFSU5HX0xPQ0sgPSBuZXcgbCh7CiAgICBjb25jdXJyZW5jeTogMQp9KTsKZnVuY3Rpb24gbG9ja19sb2FkaW5nKGYpIHsKICAgIE9CSkVDVF9GUkVFSU5HX0xPQ0suYWRkKGYpOwp9CmZ1bmN0aW9uIGxvb2t1cF9nbG9iYWxfb2JqZWN0KGtleSkgewogICAgY29uc3Qgb2JqZWN0ID0gR0xPQkFMX09CSkVDVF9DQUNIRVtrZXldOwogICAgaWYgKG9iamVjdCkgewogICAgICAgIGlmIChvYmplY3QgaW5zdGFuY2VvZiBSZXRhaW4pIHsKICAgICAgICAgICAgcmV0dXJuIG9iamVjdC52YWx1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gb2JqZWN0OwogICAgICAgIH0KICAgIH0KICAgIGNvbnNvbGUud2FybihgS2V5ICR7a2V5fSBub3QgZm91bmQhICR7b2JqZWN0fWApOwogICAgcmV0dXJuIG51bGw7Cn0KZnVuY3Rpb24gc2VuZF9lcnJvcihtZXNzYWdlLCBleGNlcHRpb24pIHsKICAgIGNvbnNvbGUuZXJyb3IobWVzc2FnZSk7CiAgICBjb25zb2xlLmVycm9yKGV4Y2VwdGlvbik7CiAgICBzZW5kX3RvX2p1bGlhKHsKICAgICAgICBtc2dfdHlwZTogSmF2YXNjcmlwdEVycm9yLAogICAgICAgIG1lc3NhZ2U6IG1lc3NhZ2UsCiAgICAgICAgZXhjZXB0aW9uOiBTdHJpbmcoZXhjZXB0aW9uKSwKICAgICAgICBzdGFja3RyYWNlOiBleGNlcHRpb24gPT09IG51bGwgPyAiIiA6IGNsZWFuX3N0YWNrKGV4Y2VwdGlvbi5zdGFjaykKICAgIH0pOwp9CmZ1bmN0aW9uIGlzX3N0aWxsX3JlZmVyZW5jZWQoaWQpIHsKICAgIGZvcihjb25zdCBzZXNzaW9uX2lkIGluIFNFU1NJT05TKXsKICAgICAgICBjb25zdCBbdHJhY2tlZF9vYmplY3RzLCBhbGxvd19kZWxldGVdID0gU0VTU0lPTlNbc2Vzc2lvbl9pZF07CiAgICAgICAgaWYgKGFsbG93X2RlbGV0ZSAmJiB0cmFja2VkX29iamVjdHMuaGFzKGlkKSkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gZmFsc2U7Cn0KZnVuY3Rpb24gZm9yY2VfZnJlZV9vYmplY3QoaWQpIHsKICAgIGZvcihjb25zdCBzZXNzaW9uX2lkIGluIFNFU1NJT05TKXsKICAgICAgICBjb25zdCBbdHJhY2tlZF9vYmplY3RzLCBhbGxvd19kZWxldGVdID0gU0VTU0lPTlNbc2Vzc2lvbl9pZF07CiAgICAgICAgdHJhY2tlZF9vYmplY3RzLmRlbGV0ZShpZCk7CiAgICB9CiAgICBkZWxldGUgR0xPQkFMX09CSkVDVF9DQUNIRVtpZF07Cn0KZnVuY3Rpb24gZnJlZV9vYmplY3QoaWQpIHsKICAgIGNvbnN0IGRhdGEgPSBHTE9CQUxfT0JKRUNUX0NBQ0hFW2lkXTsKICAgIGlmIChkYXRhKSB7CiAgICAgICAgaWYgKGRhdGEgaW5zdGFuY2VvZiBQcm9taXNlKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKGRhdGEgaW5zdGFuY2VvZiBSZXRhaW4pIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZiAoIWlzX3N0aWxsX3JlZmVyZW5jZWQoaWQpKSB7CiAgICAgICAgICAgIGRlbGV0ZSBHTE9CQUxfT0JKRUNUX0NBQ0hFW2lkXTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuOwogICAgfSBlbHNlIHsKICAgICAgICBjb25zb2xlLndhcm4oYFRyeWluZyB0byBkZWxldGUgb2JqZWN0ICR7aWR9LCB3aGljaCBpcyBub3QgaW4gZ2xvYmFsIHNlc3Npb24gY2FjaGUuYCk7CiAgICB9CiAgICByZXR1cm47Cn0KbGV0IERFTEVURV9PQlNFUlZFUiA9IHVuZGVmaW5lZDsKZnVuY3Rpb24gdHJhY2tfZGVsZXRlZF9zZXNzaW9ucygpIHsKICAgIGlmICghREVMRVRFX09CU0VSVkVSKSB7CiAgICAgICAgY29uc3Qgb2JzZXJ2ZXIgPSBuZXcgTXV0YXRpb25PYnNlcnZlcihmdW5jdGlvbihtdXRhdGlvbnMpIHsKICAgICAgICAgICAgbGV0IHJlbW92YWxfb2NjdXJlZCA9IGZhbHNlOwogICAgICAgICAgICBjb25zdCB0b19kZWxldGUgPSBuZXcgU2V0KCk7CiAgICAgICAgICAgIG11dGF0aW9ucy5mb3JFYWNoKChtdXRhdGlvbik9PnsKICAgICAgICAgICAgICAgIG11dGF0aW9uLnJlbW92ZWROb2Rlcy5mb3JFYWNoKCh4KT0+ewogICAgICAgICAgICAgICAgICAgIGlmICh4LmlkIGluIFNFU1NJT05TKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0YXR1cyA9IFNFU1NJT05TW3guaWRdWzFdOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RhdHVzID09PSAiZGVsZXRlIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9fZGVsZXRlLmFkZCh4LmlkKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlbW92YWxfb2NjdXJlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBpZiAocmVtb3ZhbF9vY2N1cmVkKSB7CiAgICAgICAgICAgICAgICBPYmplY3Qua2V5cyhTRVNTSU9OUykuZm9yRWFjaCgoaWQpPT57CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RhdHVzID0gU0VTU0lPTlNbaWRdWzFdOwogICAgICAgICAgICAgICAgICAgIGlmIChzdGF0dXMgPT09ICJkZWxldGUiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmRlYnVnKGBhZGRpbmcgc2Vzc2lvbiB0byBkZWxldGUgY2FuZGlkYXRlczogJHtpZH1gKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvX2RlbGV0ZS5hZGQoaWQpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdG9fZGVsZXRlLmZvckVhY2goKGlkKT0+ewogICAgICAgICAgICAgICAgY2xvc2Vfc2Vzc2lvbihpZCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICAgIG9ic2VydmVyLm9ic2VydmUoZG9jdW1lbnQsIHsKICAgICAgICAgICAgYXR0cmlidXRlczogZmFsc2UsCiAgICAgICAgICAgIGNoaWxkTGlzdDogdHJ1ZSwKICAgICAgICAgICAgY2hhcmFjdGVyRGF0YTogZmFsc2UsCiAgICAgICAgICAgIHN1YnRyZWU6IHRydWUKICAgICAgICB9KTsKICAgICAgICBERUxFVEVfT0JTRVJWRVIgPSBvYnNlcnZlcjsKICAgIH0KfQpmdW5jdGlvbiBzZW5kX3Bpbmdwb25nKCkgewogICAgc2VuZF90b19qdWxpYSh7CiAgICAgICAgbXNnX3R5cGU6IFBpbmdQb25nCiAgICB9KTsKfQpsZXQgdGltZW91dCA9IG51bGw7CmZ1bmN0aW9uIHNlbmRfcGluZ3MoKSB7CiAgICBjbGVhclRpbWVvdXQodGltZW91dCk7CiAgICBpZiAoIWNhbl9zZW5kX3RvX2p1bGlhKCkpIHsKICAgICAgICByZXR1cm47CiAgICB9CiAgICBzZW5kX3Bpbmdwb25nKCk7CiAgICB0aW1lb3V0ID0gc2V0VGltZW91dChzZW5kX3BpbmdzLCBQSU5HX0lOVEVSVkFMKTsKfQpmdW5jdGlvbiBlbmNvZGVfYmluYXJ5KGRhdGEsIGNvbXByZXNzaW9uX2VuYWJsZWQpIHsKICAgIGlmIChjb21wcmVzc2lvbl9lbmFibGVkKSB7CiAgICAgICAgcmV0dXJuIG1sKHBhY2soZGF0YSkpOwogICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gcGFjayhkYXRhKTsKICAgIH0KfQpmdW5jdGlvbiBzZW5kX3RvX2p1bGlhKG1lc3NhZ2UpIHsKICAgIGNvbnN0IHsgc2VuZF9tZXNzYWdlICwgc3RhdHVzICwgY29tcHJlc3Npb25fZW5hYmxlZCAgfSA9IENPTk5FQ1RJT047CiAgICBpZiAoc2VuZF9tZXNzYWdlICE9PSB1bmRlZmluZWQgJiYgc3RhdHVzID09PSAib3BlbiIpIHsKICAgICAgICBzZW5kX21lc3NhZ2UoZW5jb2RlX2JpbmFyeShtZXNzYWdlLCBjb21wcmVzc2lvbl9lbmFibGVkKSk7CiAgICB9IGVsc2UgaWYgKHN0YXR1cyA9PT0gImNsb3NlZCIpIHsKICAgICAgICBDT05ORUNUSU9OLnF1ZXVlLnB1c2gobWVzc2FnZSk7CiAgICB9IGVsc2UgewogICAgICAgIGNvbnNvbGUubG9nKCJUcnlpbmcgdG8gc2VuZCBtZXNzYWdlcyB3aGlsZSBjb25uZWN0aW9uIGlzIG9mZmxpbmUiKTsKICAgIH0KfQpjbGFzcyBPYnNlcnZhYmxlIHsKICAgICNjYWxsYmFja3MgPSBbXTsKICAgIGNvbnN0cnVjdG9yKGlkLCB2YWx1ZSl7CiAgICAgICAgdGhpcy5pZCA9IGlkOwogICAgICAgIHRoaXMudmFsdWUgPSB2YWx1ZTsKICAgIH0KICAgIG5vdGlmeSh2YWx1ZSwgZG9udF9ub3RpZnlfanVsaWEpIHsKICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7CiAgICAgICAgdGhpcy4jY2FsbGJhY2tzLmZvckVhY2goKGNhbGxiYWNrKT0+ewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgY29uc3QgZGVyZWdpc3RlciA9IGNhbGxiYWNrKHZhbHVlKTsKICAgICAgICAgICAgICAgIGlmIChkZXJlZ2lzdGVyID09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4jY2FsbGJhY2tzLnNwbGljZSh0aGlzLiNjYWxsYmFja3MuaW5kZXhPZihjYWxsYmFjayksIDEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGNhdGNoIChleGNlcHRpb24pIHsKICAgICAgICAgICAgICAgIHNlbmRfZXJyb3IoIkVycm9yIGR1cmluZyBydW5uaW5nIG9uanMgY2FsbGJhY2tcbiIgKyAiQ2FsbGJhY2s6XG4iICsgY2FsbGJhY2sudG9TdHJpbmcoKSwgZXhjZXB0aW9uKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIGlmICghZG9udF9ub3RpZnlfanVsaWEpIHsKICAgICAgICAgICAgc2VuZF90b19qdWxpYSh7CiAgICAgICAgICAgICAgICBtc2dfdHlwZTogVXBkYXRlT2JzZXJ2YWJsZSwKICAgICAgICAgICAgICAgIGlkOiB0aGlzLmlkLAogICAgICAgICAgICAgICAgcGF5bG9hZDogdmFsdWUKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfQogICAgb24oY2FsbGJhY2spIHsKICAgICAgICB0aGlzLiNjYWxsYmFja3MucHVzaChjYWxsYmFjayk7CiAgICB9Cn0KcmVnaXN0ZXJfZXh0KDEwMSwgKHVpbnRfOF9hcnJheSk9PnsKICAgIGNvbnN0IFtpZCwgdmFsdWVdID0gdW5wYWNrKHVpbnRfOF9hcnJheSk7CiAgICByZXR1cm4gbmV3IE9ic2VydmFibGUoaWQsIHZhbHVlKTsKfSk7CnJlZ2lzdGVyX2V4dCgxMDIsICh1aW50XzhfYXJyYXkpPT57CiAgICBjb25zdCBbaW50ZXJwb2xhdGVkX29iamVjdHMsIHNvdXJjZSwganVsaWFfZmlsZV0gPSB1bnBhY2sodWludF84X2FycmF5KTsKICAgIGNvbnN0IGxvb2t1cF9pbnRlcnBvbGF0ZWQgPSAoaWQpPT5pbnRlcnBvbGF0ZWRfb2JqZWN0c1tpZF07CiAgICB0cnkgewogICAgICAgIGNvbnN0IGV2YWxfZnVuYyA9IG5ldyBGdW5jdGlvbigiX19sb29rdXBfaW50ZXJwb2xhdGVkIiwgIkJvbml0byIsIHNvdXJjZSk7CiAgICAgICAgcmV0dXJuICgpPT57CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZXZhbF9mdW5jKGxvb2t1cF9pbnRlcnBvbGF0ZWQsIHdpbmRvdy5Cb25pdG8pOwogICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBlcnJvciBpbiBjbG9zdXJlIGZyb206ICR7anVsaWFfZmlsZX1gKTsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBTb3VyY2U6YCk7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhzb3VyY2UpOwogICAgICAgICAgICAgICAgdGhyb3cgZXJyOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIGNvbnNvbGUubG9nKGBlcnJvciBpbiBjbG9zdXJlIGZyb206ICR7anVsaWFfZmlsZX1gKTsKICAgICAgICBjb25zb2xlLmxvZyhgU291cmNlOmApOwogICAgICAgIGNvbnNvbGUubG9nKHNvdXJjZSk7CiAgICAgICAgdGhyb3cgZXJyOwogICAgfQp9KTsKcmVnaXN0ZXJfZXh0KDEwMywgKHVpbnRfOF9hcnJheSk9PnsKICAgIGNvbnN0IHJlYWxfdmFsdWUgPSB1bnBhY2sodWludF84X2FycmF5KTsKICAgIHJldHVybiBuZXcgUmV0YWluKHJlYWxfdmFsdWUpOwp9KTsKcmVnaXN0ZXJfZXh0KDEwNCwgKHVpbnRfOF9hcnJheSk9PnsKICAgIGNvbnN0IGtleSA9IHVucGFjayh1aW50XzhfYXJyYXkpOwogICAgcmV0dXJuIGxvb2t1cF9nbG9iYWxfb2JqZWN0KGtleSk7Cn0pOwpmdW5jdGlvbiBjcmVhdGVfdGFnKHRhZywgYXR0cmlidXRlcykgewogICAgaWYgKGF0dHJpYnV0ZXMuanVsaWFzdmdub2RlKSB7CiAgICAgICAgcmV0dXJuIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciLCB0YWcpOwogICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpOwogICAgfQp9CnJlZ2lzdGVyX2V4dCgxMDUsICh1aW50XzhfYXJyYXkpPT57CiAgICBjb25zdCBbdGFnLCBjaGlsZHJlbiwgYXR0cmlidXRlc10gPSB1bnBhY2sodWludF84X2FycmF5KTsKICAgIGNvbnN0IG5vZGUgPSBjcmVhdGVfdGFnKHRhZywgYXR0cmlidXRlcyk7CiAgICBPYmplY3Qua2V5cyhhdHRyaWJ1dGVzKS5mb3JFYWNoKChrZXkpPT57CiAgICAgICAgaWYgKGtleSA9PSAianVsaWFzdmdub2RlIikgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmIChrZXkgPT0gImNsYXNzIikgewogICAgICAgICAgICBub2RlLmNsYXNzTmFtZSA9IGF0dHJpYnV0ZXNba2V5XTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBub2RlLnNldEF0dHJpYnV0ZShrZXksIGF0dHJpYnV0ZXNba2V5XSk7CiAgICAgICAgfQogICAgfSk7CiAgICBjaGlsZHJlbi5mb3JFYWNoKChjaGlsZCk9Pm5vZGUuYXBwZW5kKGNoaWxkKSk7CiAgICByZXR1cm4gbm9kZTsKfSk7CnJlZ2lzdGVyX2V4dCgxMDgsICh1aW50XzhfYXJyYXkpPT57CiAgICBjb25zdCBodG1sID0gdW5wYWNrKHVpbnRfOF9hcnJheSk7CiAgICBjb25zdCBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgIGRpdi5pbm5lckhUTUwgPSBodG1sOwogICAgcmV0dXJuIGRpdjsKfSk7CmZ1bmN0aW9uIHNlbmRfZG9uZV9sb2FkaW5nKHNlc3Npb24sIGV4Y2VwdGlvbikgewogICAgc2VuZF90b19qdWxpYSh7CiAgICAgICAgbXNnX3R5cGU6IEpTRG9uZUxvYWRpbmcsCiAgICAgICAgc2Vzc2lvbiwKICAgICAgICBtZXNzYWdlOiAiIiwKICAgICAgICBleGNlcHRpb246IGV4Y2VwdGlvbiA9PT0gbnVsbCA/ICJub3RoaW5nIiA6IFN0cmluZyhleGNlcHRpb24pLAogICAgICAgIHN0YWNrdHJhY2U6IGV4Y2VwdGlvbiA9PT0gbnVsbCA/ICIiIDogY2xlYW5fc3RhY2soZXhjZXB0aW9uLnN0YWNrKQogICAgfSk7Cn0KZnVuY3Rpb24gZG9uZV9pbml0aWFsaXppbmdfc2Vzc2lvbihzZXNzaW9uX2lkKSB7CiAgICBpZiAoIShzZXNzaW9uX2lkIGluIFNFU1NJT05TKSkgewogICAgICAgIGNvbnNvbGUud2FybihgU2Vzc2lvbiAke3Nlc3Npb25faWR9IGdvdCBkZWxldGVkIGJlZm9yZSBkb25lIGluaXRpYWxpemluZyFgKTsKICAgICAgICByZXR1cm47CiAgICB9CiAgICBzZW5kX2RvbmVfbG9hZGluZyhzZXNzaW9uX2lkLCBudWxsKTsKICAgIGlmIChTRVNTSU9OU1tzZXNzaW9uX2lkXVsxXSAhPSAicm9vdCIpIHsKICAgICAgICBTRVNTSU9OU1tzZXNzaW9uX2lkXVsxXSA9ICJkZWxldGUiOwogICAgfQp9CmZ1bmN0aW9uIGluaXRfc2Vzc2lvbl9mcm9tX21zZ3Moc2Vzc2lvbl9pZCwgbWVzc2FnZXMpIHsKICAgIHRyeSB7CiAgICAgICAgbWVzc2FnZXMuZm9yRWFjaChwcm9jZXNzX21lc3NhZ2UpOwogICAgICAgIGRvbmVfaW5pdGlhbGl6aW5nX3Nlc3Npb24oc2Vzc2lvbl9pZCk7CiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIHNlbmRfZG9uZV9sb2FkaW5nKHNlc3Npb25faWQsIGVycm9yKTsKICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yLnN0YWNrKTsKICAgICAgICB0aHJvdyBlcnJvcjsKICAgIH0KfQpmdW5jdGlvbiBkZWNvZGVfYmluYXJ5KGJpbmFyeSwgY29tcHJlc3Npb25fZW5hYmxlZCkgewogICAgY29uc3Qgc2VyaWFsaXplZF9tZXNzYWdlID0gdW5wYWNrX2JpbmFyeShiaW5hcnksIGNvbXByZXNzaW9uX2VuYWJsZWQpOwogICAgY29uc3QgW3Nlc3Npb25faWQsIG1lc3NhZ2VfZGF0YV0gPSBzZXJpYWxpemVkX21lc3NhZ2U7CiAgICByZXR1cm4gbWVzc2FnZV9kYXRhOwp9CmZ1bmN0aW9uIGluaXRfc2Vzc2lvbihzZXNzaW9uX2lkLCBtZXNzYWdlX3Byb21pc2UsIHNlc3Npb25fc3RhdHVzLCBjb21wcmVzc2lvbikgewogICAgU0VTU0lPTlNbc2Vzc2lvbl9pZF0gPSBbCiAgICAgICAgbmV3IFNldCgpLAogICAgICAgIHNlc3Npb25fc3RhdHVzCiAgICBdOwogICAgdHJhY2tfZGVsZXRlZF9zZXNzaW9ucygpOwogICAgbG9ja19sb2FkaW5nKCgpPT57CiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShtZXNzYWdlX3Byb21pc2UpLnRoZW4oKGJpbmFyeSk9PnsKICAgICAgICAgICAgY29uc3QgbWVzc2FnZXMgPSBiaW5hcnkgPyBkZWNvZGVfYmluYXJ5KGJpbmFyeSwgY29tcHJlc3Npb24pIDogW107CiAgICAgICAgICAgIGluaXRfc2Vzc2lvbl9mcm9tX21zZ3Moc2Vzc2lvbl9pZCwgbWVzc2FnZXMpOwogICAgICAgIH0pLmNhdGNoKChlcnJvcik9PnsKICAgICAgICAgICAgc2VuZF9kb25lX2xvYWRpbmcoc2Vzc2lvbl9pZCwgZXJyb3IpOwogICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yLnN0YWNrKTsKICAgICAgICAgICAgdGhyb3cgZXJyb3I7CiAgICAgICAgfSk7CiAgICB9KTsKfQpmdW5jdGlvbiBjbG9zZV9zZXNzaW9uKHNlc3Npb25faWQpIHsKICAgIGNvbnN0IHNlc3Npb24gPSBTRVNTSU9OU1tzZXNzaW9uX2lkXTsKICAgIGlmICghc2Vzc2lvbikgewogICAgICAgIGNvbnNvbGUud2FybigiZG91YmxlIGZyZWVpbmcgc2Vzc2lvbiBmcm9tIEpTISIpOwogICAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IFtzZXNzaW9uX29iamVjdHMsIHN0YXR1c10gPSBzZXNzaW9uOwogICAgY29uc3Qgcm9vdF9ub2RlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoc2Vzc2lvbl9pZCk7CiAgICBpZiAocm9vdF9ub2RlKSB7CiAgICAgICAgcm9vdF9ub2RlLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CiAgICAgICAgcm9vdF9ub2RlLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQocm9vdF9ub2RlKTsKICAgIH0KICAgIGlmIChzdGF0dXMgPT09ICJkZWxldGUiKSB7CiAgICAgICAgc2VuZF9jbG9zZV9zZXNzaW9uKHNlc3Npb25faWQsIHN0YXR1cyk7CiAgICAgICAgU0VTU0lPTlNbc2Vzc2lvbl9pZF0gPSBbCiAgICAgICAgICAgIHNlc3Npb25fb2JqZWN0cywKICAgICAgICAgICAgZmFsc2UKICAgICAgICBdOwogICAgfQogICAgcmV0dXJuOwp9CmZ1bmN0aW9uIGZyZWVfc2Vzc2lvbihzZXNzaW9uX2lkKSB7CiAgICBsb2NrX2xvYWRpbmcoKCk9PnsKICAgICAgICBjb25zdCBzZXNzaW9uID0gU0VTU0lPTlNbc2Vzc2lvbl9pZF07CiAgICAgICAgaWYgKCFzZXNzaW9uKSB7CiAgICAgICAgICAgIGNvbnNvbGUud2FybigiZG91YmxlIGZyZWVpbmcgc2Vzc2lvbiBmcm9tIEp1bGlhISIpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGNvbnN0IFt0cmFja2VkX29iamVjdHMsIHN0YXR1c10gPSBzZXNzaW9uOwogICAgICAgIGRlbGV0ZSBTRVNTSU9OU1tzZXNzaW9uX2lkXTsKICAgICAgICB0cmFja2VkX29iamVjdHMuZm9yRWFjaChmcmVlX29iamVjdCk7CiAgICAgICAgdHJhY2tlZF9vYmplY3RzLmNsZWFyKCk7CiAgICB9KTsKfQpmdW5jdGlvbiBvbl9ub2RlX2F2YWlsYWJsZShub2RlX2lkLCB0aW1lb3V0KSB7CiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpPT57CiAgICAgICAgZnVuY3Rpb24gdGVzdF9ub2RlKHRpbWVvdXQpIHsKICAgICAgICAgICAgY29uc3Qgbm9kZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYFtkYXRhLWpzY2FsbC1pZD0nJHtub2RlX2lkfSddYCk7CiAgICAgICAgICAgIGlmIChub2RlKSB7CiAgICAgICAgICAgICAgICByZXNvbHZlKG5vZGUpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29uc3QgbmV3X3RpbWVvdXQgPSAyICogdGltZW91dDsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKG5ld190aW1lb3V0KTsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQodGVzdF9ub2RlLCBuZXdfdGltZW91dCwgbmV3X3RpbWVvdXQpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHRlc3Rfbm9kZSh0aW1lb3V0KTsKICAgIH0pOwp9CmZ1bmN0aW9uIHVwZGF0ZV9vcl9yZXBsYWNlKG5vZGUsIG5ld19odG1sLCByZXBsYWNlKSB7CiAgICBpZiAocmVwbGFjZSkgewogICAgICAgIG5vZGUucGFyZW50Tm9kZS5yZXBsYWNlQ2hpbGQobmV3X2h0bWwsIG5vZGUpOwogICAgfSBlbHNlIHsKICAgICAgICB3aGlsZShub2RlLmNoaWxkRWxlbWVudENvdW50ID4gMCl7CiAgICAgICAgICAgIG5vZGUucmVtb3ZlQ2hpbGQobm9kZS5maXJzdENoaWxkKTsKICAgICAgICB9CiAgICAgICAgbm9kZS5hcHBlbmQobmV3X2h0bWwpOwogICAgfQp9CmZ1bmN0aW9uIHVwZGF0ZV9zZXNzaW9uX2RvbShtZXNzYWdlKSB7CiAgICBsb2NrX2xvYWRpbmcoKCk9PnsKICAgICAgICBjb25zdCB7IHNlc3Npb25faWQgLCBtZXNzYWdlcyAsIGh0bWwgLCBkb21fbm9kZV9zZWxlY3RvciAsIHJlcGxhY2UgIH0gPSBtZXNzYWdlOwogICAgICAgIHJldHVybiBvbl9ub2RlX2F2YWlsYWJsZShkb21fbm9kZV9zZWxlY3RvciwgMSkudGhlbigoZG9tKT0+ewogICAgICAgICAgICB1cGRhdGVfb3JfcmVwbGFjZShkb20sIGh0bWwsIHJlcGxhY2UpOwogICAgICAgICAgICBpbml0X3Nlc3Npb25fZnJvbV9tc2dzKHNlc3Npb25faWQsIG1lc3NhZ2VzKTsKICAgICAgICB9KS5jYXRjaCgoZXJyb3IpPT57CiAgICAgICAgICAgIHNlbmRfZG9uZV9sb2FkaW5nKHNlc3Npb25faWQsIGVycm9yKTsKICAgICAgICB9KTsKICAgIH0pOwp9CmZ1bmN0aW9uIHVwZGF0ZV9zZXNzaW9uX2NhY2hlKHNlc3Npb25faWQsIG5ld19qbF9vYmplY3RzLCBzZXNzaW9uX3N0YXR1cykgewogICAgZnVuY3Rpb24gdXBkYXRlX2NhY2hlKHRyYWNrZWRfb2JqZWN0cykgewogICAgICAgIGZvcihjb25zdCBrZXkgaW4gbmV3X2psX29iamVjdHMpewogICAgICAgICAgICB0cmFja2VkX29iamVjdHMuYWRkKGtleSk7CiAgICAgICAgICAgIGNvbnN0IG5ld19vYmplY3QgPSBuZXdfamxfb2JqZWN0c1trZXldOwogICAgICAgICAgICBpZiAobmV3X29iamVjdCA9PSAidHJhY2tpbmctb25seSIpIHsKICAgICAgICAgICAgICAgIGlmICghKGtleSBpbiBHTE9CQUxfT0JKRUNUX0NBQ0hFKSkgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgS2V5ICR7a2V5fSBvbmx5IHNlbmQgZm9yIHRyYWNraW5nLCBidXQgbm90IGFscmVhZHkgdHJhY2tlZCEhIWApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaWYgKGtleSBpbiBHTE9CQUxfT0JKRUNUX0NBQ0hFKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKGAke2tleX0gaW4gc2Vzc2lvbiBjYWNoZSBhbmQgc2VuZCBhZ2FpbiEhICR7bmV3X29iamVjdH1gKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIEdMT0JBTF9PQkpFQ1RfQ0FDSEVba2V5XSA9IG5ld19vYmplY3Q7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBjb25zdCBzZXNzaW9uID0gU0VTU0lPTlNbc2Vzc2lvbl9pZF07CiAgICBpZiAoc2Vzc2lvbikgewogICAgICAgIHVwZGF0ZV9jYWNoZShzZXNzaW9uWzBdKTsKICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgdHJhY2tlZF9pdGVtcyA9IG5ldyBTZXQoKTsKICAgICAgICBTRVNTSU9OU1tzZXNzaW9uX2lkXSA9IFsKICAgICAgICAgICAgdHJhY2tlZF9pdGVtcywKICAgICAgICAgICAgc2Vzc2lvbl9zdGF0dXMKICAgICAgICBdOwogICAgICAgIHVwZGF0ZV9jYWNoZSh0cmFja2VkX2l0ZW1zKTsKICAgIH0KfQpjb25zdCBtb2QgPSB7CiAgICBTRVNTSU9OUzogU0VTU0lPTlMsCiAgICBHTE9CQUxfT0JKRUNUX0NBQ0hFOiBHTE9CQUxfT0JKRUNUX0NBQ0hFLAogICAgT0JKRUNUX0ZSRUVJTkdfTE9DSzogT0JKRUNUX0ZSRUVJTkdfTE9DSywKICAgIGxvY2tfbG9hZGluZzogbG9ja19sb2FkaW5nLAogICAgbG9va3VwX2dsb2JhbF9vYmplY3Q6IGxvb2t1cF9nbG9iYWxfb2JqZWN0LAogICAgZm9yY2VfZnJlZV9vYmplY3Q6IGZvcmNlX2ZyZWVfb2JqZWN0LAogICAgZnJlZV9vYmplY3Q6IGZyZWVfb2JqZWN0LAogICAgdHJhY2tfZGVsZXRlZF9zZXNzaW9uczogdHJhY2tfZGVsZXRlZF9zZXNzaW9ucywKICAgIGRvbmVfaW5pdGlhbGl6aW5nX3Nlc3Npb246IGRvbmVfaW5pdGlhbGl6aW5nX3Nlc3Npb24sCiAgICBpbml0X3Nlc3Npb246IGluaXRfc2Vzc2lvbiwKICAgIGNsb3NlX3Nlc3Npb246IGNsb3NlX3Nlc3Npb24sCiAgICBmcmVlX3Nlc3Npb246IGZyZWVfc2Vzc2lvbiwKICAgIG9uX25vZGVfYXZhaWxhYmxlOiBvbl9ub2RlX2F2YWlsYWJsZSwKICAgIHVwZGF0ZV9vcl9yZXBsYWNlOiB1cGRhdGVfb3JfcmVwbGFjZSwKICAgIHVwZGF0ZV9zZXNzaW9uX2RvbTogdXBkYXRlX3Nlc3Npb25fZG9tLAogICAgdXBkYXRlX3Nlc3Npb25fY2FjaGU6IHVwZGF0ZV9zZXNzaW9uX2NhY2hlCn07CnJlZ2lzdGVyX2V4dCgxMDYsICh1aW50XzhfYXJyYXkpPT57CiAgICBjb25zdCBbc2Vzc2lvbl9pZCwgb2JqZWN0cywgc2Vzc2lvbl9zdGF0dXNdID0gdW5wYWNrKHVpbnRfOF9hcnJheSk7CiAgICB1cGRhdGVfc2Vzc2lvbl9jYWNoZShzZXNzaW9uX2lkLCBvYmplY3RzLCBzZXNzaW9uX3N0YXR1cyk7CiAgICByZXR1cm4gc2Vzc2lvbl9pZDsKfSk7CnJlZ2lzdGVyX2V4dCgxMDcsICh1aW50XzhfYXJyYXkpPT57CiAgICBjb25zdCBbc2Vzc2lvbl9pZCwgbWVzc2FnZV0gPSB1bnBhY2sodWludF84X2FycmF5KTsKICAgIHJldHVybiBtZXNzYWdlOwp9KTsKZnVuY3Rpb24gYmFzZTY0ZW5jb2RlKGRhdGFfYXNfdWludDhhcnJheSkgewogICAgY29uc3QgYmFzZTY0X3Byb21pc2UgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSk9PnsKICAgICAgICBjb25zdCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOwogICAgICAgIHJlYWRlci5vbmxvYWQgPSAoKT0+ewogICAgICAgICAgICBjb25zdCBsZW4gPSAzNzsKICAgICAgICAgICAgY29uc3QgYmFzZTY0dXJsID0gcmVhZGVyLnJlc3VsdDsKICAgICAgICAgICAgcmVzb2x2ZShiYXNlNjR1cmwuc2xpY2UobGVuLCBiYXNlNjR1cmwubGVuZ3RoKSk7CiAgICAgICAgfTsKICAgICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChuZXcgQmxvYihbCiAgICAgICAgICAgIGRhdGFfYXNfdWludDhhcnJheQogICAgICAgIF0pKTsKICAgIH0pOwogICAgcmV0dXJuIGJhc2U2NF9wcm9taXNlOwp9CmZ1bmN0aW9uIGJhc2U2NGRlY29kZShiYXNlNjRfc3RyKSB7CiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpPT57CiAgICAgICAgZmV0Y2goImRhdGE6YXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtO2Jhc2U2NCwiICsgYmFzZTY0X3N0cikudGhlbigocmVzcG9uc2UpPT57CiAgICAgICAgICAgIHJlc3BvbnNlLmFycmF5QnVmZmVyKCkudGhlbigoYXJyYXkpPT57CiAgICAgICAgICAgICAgICByZXNvbHZlKG5ldyBVaW50OEFycmF5KGFycmF5KSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgfSk7Cn0KZnVuY3Rpb24gZGVjb2RlX2Jhc2U2NF9tZXNzYWdlKGJhc2U2NF9zdHJpbmcsIGNvbXByZXNzaW9uX2VuYWJsZWQpIHsKICAgIHJldHVybiBiYXNlNjRkZWNvZGUoYmFzZTY0X3N0cmluZykudGhlbigoeCk9PmRlY29kZV9iaW5hcnkoeCwgY29tcHJlc3Npb25fZW5hYmxlZCkpOwp9CmZ1bmN0aW9uIHVucGFja19iaW5hcnkoYmluYXJ5LCBjb21wcmVzc2lvbl9lbmFibGVkKSB7CiAgICBpZiAoY29tcHJlc3Npb25fZW5hYmxlZCkgewogICAgICAgIHJldHVybiB1bnBhY2soT2woYmluYXJ5KSk7CiAgICB9IGVsc2UgewogICAgICAgIHJldHVybiB1bnBhY2soYmluYXJ5KTsKICAgIH0KfQpjb25zdCBtb2QxID0gewogICAgUmV0YWluOiBSZXRhaW4sCiAgICBiYXNlNjRlbmNvZGU6IGJhc2U2NGVuY29kZSwKICAgIGJhc2U2NGRlY29kZTogYmFzZTY0ZGVjb2RlLAogICAgZGVjb2RlX2Jhc2U2NF9tZXNzYWdlOiBkZWNvZGVfYmFzZTY0X21lc3NhZ2UsCiAgICBkZWNvZGVfYmluYXJ5OiBkZWNvZGVfYmluYXJ5LAogICAgdW5wYWNrX2JpbmFyeTogdW5wYWNrX2JpbmFyeSwKICAgIGVuY29kZV9iaW5hcnk6IGVuY29kZV9iaW5hcnkKfTsKZnVuY3Rpb24gc2VuZF93YXJuaW5nKG1lc3NhZ2UpIHsKICAgIGNvbnNvbGUud2FybihtZXNzYWdlKTsKICAgIHNlbmRfdG9fanVsaWEoewogICAgICAgIG1zZ190eXBlOiBKYXZhc2NyaXB0V2FybmluZywKICAgICAgICBtZXNzYWdlOiBtZXNzYWdlCiAgICB9KTsKfQpmdW5jdGlvbiBzZW5kX2Nsb3NlX3Nlc3Npb24oc2Vzc2lvbiwgc3Vic2Vzc2lvbikgewogICAgc2VuZF90b19qdWxpYSh7CiAgICAgICAgbXNnX3R5cGU6IENsb3NlU2Vzc2lvbiwKICAgICAgICBzZXNzaW9uLAogICAgICAgIHN1YnNlc3Npb24KICAgIH0pOwp9CmZ1bmN0aW9uIHByb2Nlc3NfbWVzc2FnZShkYXRhKSB7CiAgICB0cnkgewogICAgICAgIHN3aXRjaChkYXRhLm1zZ190eXBlKXsKICAgICAgICAgICAgY2FzZSBVcGRhdGVPYnNlcnZhYmxlOgogICAgICAgICAgICAgICAgbG9va3VwX2dsb2JhbF9vYmplY3QoZGF0YS5pZCkubm90aWZ5KGRhdGEucGF5bG9hZCwgdHJ1ZSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBPbmpzQ2FsbGJhY2s6CiAgICAgICAgICAgICAgICBkYXRhLm9icy5vbihkYXRhLnBheWxvYWQoKSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBFdmFsSmF2YXNjcmlwdDoKICAgICAgICAgICAgICAgIGRhdGEucGF5bG9hZCgpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgRnVzZWRNZXNzYWdlOgogICAgICAgICAgICAgICAgZGF0YS5wYXlsb2FkLmZvckVhY2gocHJvY2Vzc19tZXNzYWdlKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIFBpbmdQb25nOgogICAgICAgICAgICAgICAgY29uc29sZS5kZWJ1ZygicGluZyIpOwogICAgICAgICAgICAgICAgQ09OTkVDVElPTi5sYXN0UGluZyA9IERhdGUubm93KCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBVcGRhdGVTZXNzaW9uOgogICAgICAgICAgICAgICAgdXBkYXRlX3Nlc3Npb25fZG9tKGRhdGEpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlVucmVjb2duaXplZCBtZXNzYWdlIHR5cGU6ICIgKyBkYXRhLm1zZ190eXBlICsgIi4iKTsKICAgICAgICB9CiAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgc2VuZF9lcnJvcihgRXJyb3Igd2hpbGUgcHJvY2Vzc2luZyBtZXNzYWdlICR7SlNPTi5zdHJpbmdpZnkoZGF0YSl9YCwgZSk7CiAgICB9Cn0KY29uc3QgbW9kMiA9IHsKICAgIFVwZGF0ZU9ic2VydmFibGU6IFVwZGF0ZU9ic2VydmFibGUsCiAgICBPbmpzQ2FsbGJhY2s6IE9uanNDYWxsYmFjaywKICAgIEV2YWxKYXZhc2NyaXB0OiBFdmFsSmF2YXNjcmlwdCwKICAgIEphdmFzY3JpcHRFcnJvcjogSmF2YXNjcmlwdEVycm9yLAogICAgSmF2YXNjcmlwdFdhcm5pbmc6IEphdmFzY3JpcHRXYXJuaW5nLAogICAgUmVnaXN0ZXJPYnNlcnZhYmxlOiBSZWdpc3Rlck9ic2VydmFibGUsCiAgICBKU0RvbmVMb2FkaW5nOiBKU0RvbmVMb2FkaW5nLAogICAgRnVzZWRNZXNzYWdlOiBGdXNlZE1lc3NhZ2UsCiAgICBvbl9jb25uZWN0aW9uX29wZW46IG9uX2Nvbm5lY3Rpb25fb3BlbiwKICAgIG9uX2Nvbm5lY3Rpb25fY2xvc2U6IG9uX2Nvbm5lY3Rpb25fY2xvc2UsCiAgICBjYW5fc2VuZF90b19qdWxpYTogY2FuX3NlbmRfdG9fanVsaWEsCiAgICBpc19qdWxpYV9yZXNwb25zaXZlOiBpc19qdWxpYV9yZXNwb25zaXZlLAogICAgc2VuZF90b19qdWxpYTogc2VuZF90b19qdWxpYSwKICAgIHNlbmRfcGluZ3Bvbmc6IHNlbmRfcGluZ3BvbmcsCiAgICBzZW5kX2Vycm9yOiBzZW5kX2Vycm9yLAogICAgc2VuZF93YXJuaW5nOiBzZW5kX3dhcm5pbmcsCiAgICBzZW5kX2RvbmVfbG9hZGluZzogc2VuZF9kb25lX2xvYWRpbmcsCiAgICBzZW5kX2Nsb3NlX3Nlc3Npb246IHNlbmRfY2xvc2Vfc2Vzc2lvbiwKICAgIHByb2Nlc3NfbWVzc2FnZTogcHJvY2Vzc19tZXNzYWdlCn07CmZ1bmN0aW9uIG9uYW55KG9ic2VydmFibGVzLCBmKSB7CiAgICBjb25zdCBjYWxsYmFjayA9ICh4KT0+ZihvYnNlcnZhYmxlcy5tYXAoKHgpPT54LnZhbHVlKSk7CiAgICBvYnNlcnZhYmxlcy5mb3JFYWNoKChvYnMpPT57CiAgICAgICAgb2JzLm9uKGNhbGxiYWNrKTsKICAgIH0pOwp9CmNvbnN0IHsgc2VuZF9lcnJvcjogc2VuZF9lcnJvcjEgLCBzZW5kX3dhcm5pbmc6IHNlbmRfd2FybmluZzEgLCBwcm9jZXNzX21lc3NhZ2U6IHByb2Nlc3NfbWVzc2FnZTEgLCBvbl9jb25uZWN0aW9uX29wZW46IG9uX2Nvbm5lY3Rpb25fb3BlbjEgLCBvbl9jb25uZWN0aW9uX2Nsb3NlOiBvbl9jb25uZWN0aW9uX2Nsb3NlMSAsIHNlbmRfY2xvc2Vfc2Vzc2lvbjogc2VuZF9jbG9zZV9zZXNzaW9uMSAsIHNlbmRfcGluZ3Bvbmc6IHNlbmRfcGluZ3BvbmcxICwgY2FuX3NlbmRfdG9fanVsaWE6IGNhbl9zZW5kX3RvX2p1bGlhMSAsIHNlbmRfdG9fanVsaWE6IHNlbmRfdG9fanVsaWExICB9ID0gbW9kMjsKY29uc3QgeyBiYXNlNjRkZWNvZGU6IGJhc2U2NGRlY29kZTEgLCBiYXNlNjRlbmNvZGU6IGJhc2U2NGVuY29kZTEgLCBkZWNvZGVfYmluYXJ5OiBkZWNvZGVfYmluYXJ5MSAsIGVuY29kZV9iaW5hcnk6IGVuY29kZV9iaW5hcnkxICwgZGVjb2RlX2Jhc2U2NF9tZXNzYWdlOiBkZWNvZGVfYmFzZTY0X21lc3NhZ2UxICB9ID0gbW9kMTsKY29uc3QgeyBpbml0X3Nlc3Npb246IGluaXRfc2Vzc2lvbjEgLCBmcmVlX3Nlc3Npb246IGZyZWVfc2Vzc2lvbjEgLCBsb29rdXBfZ2xvYmFsX29iamVjdDogbG9va3VwX2dsb2JhbF9vYmplY3QxICwgdXBkYXRlX29yX3JlcGxhY2U6IHVwZGF0ZV9vcl9yZXBsYWNlMSAsIGxvY2tfbG9hZGluZzogbG9ja19sb2FkaW5nMSAsIE9CSkVDVF9GUkVFSU5HX0xPQ0s6IE9CSkVDVF9GUkVFSU5HX0xPQ0sxICwgZnJlZV9vYmplY3Q6IGZyZWVfb2JqZWN0MSAsIGZvcmNlX2ZyZWVfb2JqZWN0OiBmb3JjZV9mcmVlX29iamVjdDEgIH0gPSBtb2Q7CmZ1bmN0aW9uIHVwZGF0ZV9ub2RlX2F0dHJpYnV0ZShub2RlLCBhdHRyaWJ1dGUsIHZhbHVlKSB7CiAgICBpZiAobm9kZSkgewogICAgICAgIGlmIChhdHRyaWJ1dGUgPT09ICJjbGFzcyIpIHsKICAgICAgICAgICAgbm9kZS5jbGFzc05hbWUgPSB2YWx1ZTsKICAgICAgICB9IGVsc2UgaWYgKG5vZGVbYXR0cmlidXRlXSAhPSB2YWx1ZSkgewogICAgICAgICAgICBub2RlW2F0dHJpYnV0ZV0gPSB2YWx1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KfQpmdW5jdGlvbiB1cGRhdGVfZG9tX25vZGUoZG9tLCBodG1sKSB7CiAgICBpZiAoZG9tKSB7CiAgICAgICAgZG9tLmlubmVySFRNTCA9IGh0bWw7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KfQpmdW5jdGlvbiBmZXRjaF9iaW5hcnkodXJsKSB7CiAgICByZXR1cm4gZmV0Y2godXJsKS50aGVuKChyZXNwb25zZSk9PnsKICAgICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiSFRUUCBlcnJvciwgc3RhdHVzID0gIiArIHJlc3BvbnNlLnN0YXR1cyk7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXNwb25zZS5hcnJheUJ1ZmZlcigpOwogICAgfSk7Cn0KZnVuY3Rpb24gdGhyb3R0bGVfZnVuY3Rpb24oZnVuYywgZGVsYXkpIHsKICAgIGxldCBwcmV2ID0gMDsKICAgIGxldCBmdXR1cmVfaWQgPSB1bmRlZmluZWQ7CiAgICBmdW5jdGlvbiBpbm5lcl90aHJvdHRsZSguLi5hcmdzKSB7CiAgICAgICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7CiAgICAgICAgaWYgKGZ1dHVyZV9pZCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIGNsZWFyVGltZW91dChmdXR1cmVfaWQpOwogICAgICAgICAgICBmdXR1cmVfaWQgPSB1bmRlZmluZWQ7CiAgICAgICAgfQogICAgICAgIGlmIChub3cgLSBwcmV2ID4gZGVsYXkpIHsKICAgICAgICAgICAgcHJldiA9IG5vdzsKICAgICAgICAgICAgcmV0dXJuIGZ1bmMoLi4uYXJncyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZnV0dXJlX2lkID0gc2V0VGltZW91dCgoKT0+aW5uZXJfdGhyb3R0bGUoLi4uYXJncyksIGRlbGF5IC0gKG5vdyAtIHByZXYpICsgMSk7CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIGlubmVyX3Rocm90dGxlOwp9CmZ1bmN0aW9uIGdlbmVyYXRlX3N0YXRlX2tleSh2KSB7CiAgICBpZiAodHlwZW9mIHYgPT09ICdudW1iZXInKSB7CiAgICAgICAgaWYgKGlzTmFOKHYpKSB7CiAgICAgICAgICAgIHJldHVybiAnTmFOJzsKICAgICAgICB9IGVsc2UgaWYgKCFpc0Zpbml0ZSh2KSkgewogICAgICAgICAgICByZXR1cm4gdiA+IDAgPyAnSW5maW5pdHknIDogJy1JbmZpbml0eSc7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbGV0IGZvcm1hdHRlZCA9IHYudG9GaXhlZCg2KTsKICAgICAgICAgICAgaWYgKGZvcm1hdHRlZC5pbmNsdWRlcygnLicpKSB7CiAgICAgICAgICAgICAgICBmb3JtYXR0ZWQgPSBmb3JtYXR0ZWQucmVwbGFjZSgvXC4/MCskLywgJycpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmb3JtYXR0ZWQ7CiAgICAgICAgfQogICAgfSBlbHNlIGlmICh0eXBlb2YgdiA9PT0gJ2Jvb2xlYW4nKSB7CiAgICAgICAgcmV0dXJuIHYgPyAndHJ1ZScgOiAnZmFsc2UnOwogICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gU3RyaW5nKHYpOwogICAgfQp9CmNvbnN0IEJvbml0byA9IHsKICAgIFByb3RvY29sOiBtb2QxLAogICAgYmFzZTY0ZGVjb2RlOiBiYXNlNjRkZWNvZGUxLAogICAgYmFzZTY0ZW5jb2RlOiBiYXNlNjRlbmNvZGUxLAogICAgZGVjb2RlX2JpbmFyeTogZGVjb2RlX2JpbmFyeTEsCiAgICBlbmNvZGVfYmluYXJ5OiBlbmNvZGVfYmluYXJ5MSwKICAgIGRlY29kZV9iYXNlNjRfbWVzc2FnZTogZGVjb2RlX2Jhc2U2NF9tZXNzYWdlMSwKICAgIGZldGNoX2JpbmFyeSwKICAgIENvbm5lY3Rpb246IG1vZDIsCiAgICBzZW5kX2Vycm9yOiBzZW5kX2Vycm9yMSwKICAgIHNlbmRfd2FybmluZzogc2VuZF93YXJuaW5nMSwKICAgIHByb2Nlc3NfbWVzc2FnZTogcHJvY2Vzc19tZXNzYWdlMSwKICAgIG9uX2Nvbm5lY3Rpb25fb3Blbjogb25fY29ubmVjdGlvbl9vcGVuMSwKICAgIG9uX2Nvbm5lY3Rpb25fY2xvc2U6IG9uX2Nvbm5lY3Rpb25fY2xvc2UxLAogICAgc2VuZF9jbG9zZV9zZXNzaW9uOiBzZW5kX2Nsb3NlX3Nlc3Npb24xLAogICAgc2VuZF9waW5ncG9uZzogc2VuZF9waW5ncG9uZzEsCiAgICBTZXNzaW9uczogbW9kLAogICAgaW5pdF9zZXNzaW9uOiBpbml0X3Nlc3Npb24xLAogICAgZnJlZV9zZXNzaW9uOiBmcmVlX3Nlc3Npb24xLAogICAgbG9ja19sb2FkaW5nOiBsb2NrX2xvYWRpbmcxLAogICAgdXBkYXRlX25vZGVfYXR0cmlidXRlLAogICAgdXBkYXRlX2RvbV9ub2RlLAogICAgbG9va3VwX2dsb2JhbF9vYmplY3Q6IGxvb2t1cF9nbG9iYWxfb2JqZWN0MSwKICAgIHVwZGF0ZV9vcl9yZXBsYWNlOiB1cGRhdGVfb3JfcmVwbGFjZTEsCiAgICBmb3JjZV9mcmVlX29iamVjdDogZm9yY2VfZnJlZV9vYmplY3QxLAogICAgT0JKRUNUX0ZSRUVJTkdfTE9DSzogT0JKRUNUX0ZSRUVJTkdfTE9DSzEsCiAgICBjYW5fc2VuZF90b19qdWxpYTogY2FuX3NlbmRfdG9fanVsaWExLAogICAgb25hbnksCiAgICBmcmVlX29iamVjdDogZnJlZV9vYmplY3QxLAogICAgc2VuZF90b19qdWxpYTogc2VuZF90b19qdWxpYTEsCiAgICB0aHJvdHRsZV9mdW5jdGlvbiwKICAgIGdlbmVyYXRlX3N0YXRlX2tleQp9Owp3aW5kb3cuQm9uaXRvID0gQm9uaXRvOwpleHBvcnQgeyBtb2QxIGFzIFByb3RvY29sLCBiYXNlNjRkZWNvZGUxIGFzIGJhc2U2NGRlY29kZSwgYmFzZTY0ZW5jb2RlMSBhcyBiYXNlNjRlbmNvZGUsIGRlY29kZV9iaW5hcnkxIGFzIGRlY29kZV9iaW5hcnksIGVuY29kZV9iaW5hcnkxIGFzIGVuY29kZV9iaW5hcnksIGRlY29kZV9iYXNlNjRfbWVzc2FnZTEgYXMgZGVjb2RlX2Jhc2U2NF9tZXNzYWdlLCBtb2QyIGFzIENvbm5lY3Rpb24sIHNlbmRfZXJyb3IxIGFzIHNlbmRfZXJyb3IsIHNlbmRfd2FybmluZzEgYXMgc2VuZF93YXJuaW5nLCBwcm9jZXNzX21lc3NhZ2UxIGFzIHByb2Nlc3NfbWVzc2FnZSwgb25fY29ubmVjdGlvbl9vcGVuMSBhcyBvbl9jb25uZWN0aW9uX29wZW4sIG9uX2Nvbm5lY3Rpb25fY2xvc2UxIGFzIG9uX2Nvbm5lY3Rpb25fY2xvc2UsIHNlbmRfY2xvc2Vfc2Vzc2lvbjEgYXMgc2VuZF9jbG9zZV9zZXNzaW9uLCBzZW5kX3Bpbmdwb25nMSBhcyBzZW5kX3Bpbmdwb25nLCBtb2QgYXMgU2Vzc2lvbnMsIGluaXRfc2Vzc2lvbjEgYXMgaW5pdF9zZXNzaW9uLCBmcmVlX3Nlc3Npb24xIGFzIGZyZWVfc2Vzc2lvbiwgbG9ja19sb2FkaW5nMSBhcyBsb2NrX2xvYWRpbmcsIHVwZGF0ZV9ub2RlX2F0dHJpYnV0ZSBhcyB1cGRhdGVfbm9kZV9hdHRyaWJ1dGUsIHVwZGF0ZV9kb21fbm9kZSBhcyB1cGRhdGVfZG9tX25vZGUsIGxvb2t1cF9nbG9iYWxfb2JqZWN0MSBhcyBsb29rdXBfZ2xvYmFsX29iamVjdCwgdXBkYXRlX29yX3JlcGxhY2UxIGFzIHVwZGF0ZV9vcl9yZXBsYWNlLCBvbmFueSBhcyBvbmFueSwgT0JKRUNUX0ZSRUVJTkdfTE9DSzEgYXMgT0JKRUNUX0ZSRUVJTkdfTE9DSywgY2FuX3NlbmRfdG9fanVsaWExIGFzIGNhbl9zZW5kX3RvX2p1bGlhLCBmcmVlX29iamVjdDEgYXMgZnJlZV9vYmplY3QsIHNlbmRfdG9fanVsaWExIGFzIHNlbmRfdG9fanVsaWEsIHRocm90dGxlX2Z1bmN0aW9uIGFzIHRocm90dGxlX2Z1bmN0aW9uIH07CmV4cG9ydCB7IGdlbmVyYXRlX3N0YXRlX2tleSBhcyBnZW5lcmF0ZV9zdGF0ZV9rZXkgfTsKCg==" type="module"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta charset="UTF-8" />
    <title>Bonito App</title>
    <style></style>
  </head>
  <body>
    <script type="module">Bonito.init_session("3d74c770-d320-445f-b30b-f17fa810d5e9", null, "root", false);
</script>
    <div id="3d74c770-d320-445f-b30b-f17fa810d5e9" data-jscall-id="root">
      <pre class="backtrace" style="overflow-x: auto;" data-jscall-id="1">
        <h3 style="color: red;" data-jscall-id="2">MethodError: no method matching _block&#40;::Type&#123;Button&#125;, ::String&#41;
The function &#96;_block&#96; exists, but no method is defined for this combination of argument types.

Closest candidates are:
  _block&#40;::Type&#123;&#60;:Makie.Block&#125;, &#33;Matched::Union&#123;GridPosition, GridSubposition&#125;, Any...; kwargs...&#41;
   &#64; Makie ~/.julia/packages/Makie/4JW9B/src/makielayout/blocks.jl:251
  _block&#40;::Type&#123;&#60;:Makie.Block&#125;, &#33;Matched::Union&#123;Figure, Scene&#125;, &#33;Matched::Any, &#33;Matched::Dict, &#33;Matched::Any; kwdict_complete&#41;
   &#64; Makie ~/.julia/packages/Makie/4JW9B/src/makielayout/blocks.jl:321
  _block&#40;::Type&#123;&#60;:Makie.Block&#125;, &#33;Matched::Union&#123;Figure, Scene&#125;, Any...; bbox, kwargs...&#41;
   &#64; Makie ~/.julia/packages/Makie/4JW9B/src/makielayout/blocks.jl:265
</h3>
        <span data-jscall-id="3">Stacktrace:</span>
        <br data-jscall-id="4" />
        <span style="color: darkred; font-weight: bold;" data-jscall-id="5">  &#91;1&#93; Button&#40;args::String; kwargs::&#64;Kwargs&#123;&#125;&#41;</span>
        <br data-jscall-id="6" />
        <span data-jscall-id="7">    &#64; Makie ~/.julia/packages/Makie/4JW9B/src/makielayout/blocks.jl:242</span>
        <br data-jscall-id="8" />
        <span style="color: darkred; font-weight: bold;" data-jscall-id="9">  &#91;2&#93; Button&#40;args::String&#41;</span>
        <br data-jscall-id="10" />
        <span data-jscall-id="11">    &#64; Makie ~/.julia/packages/Makie/4JW9B/src/makielayout/blocks.jl:241</span>
        <br data-jscall-id="12" />
        <span style="color: darkred; font-weight: bold;" data-jscall-id="13">  &#91;3&#93; &#40;::var&#34;#198#199&#34;&#41;&#40;session::Session&#123;NoConnection&#125;&#41;</span>
        <br data-jscall-id="14" />
        <span data-jscall-id="15">    &#64; Main ~/Desktop/MIASHS/MasterM1SSD/CoursRJulia/GitHub_package/ImageClassification.jl/Rapports/Ornella/exemple.jl:5</span>
        <br data-jscall-id="16" />
        <span style="color: darkred; font-weight: bold;" data-jscall-id="17">  &#91;4&#93; &#40;::Bonito.var&#34;#19#20&#34;&#123;var&#34;#198#199&#34;&#125;&#41;&#40;session::Session&#123;NoConnection&#125;, request::HTTP.Messages.Request&#41;</span>
        <br data-jscall-id="18" />
        <span data-jscall-id="19">    &#64; Bonito ~/.julia/packages/Bonito/tWcqJ/src/types.jl:356</span>
        <br data-jscall-id="20" />
        <span style="color: darkred; font-weight: bold;" data-jscall-id="21">  &#91;5&#93; rendered_dom&#40;session::Session&#123;NoConnection&#125;, app::App, target::HTTP.Messages.Request&#41;</span>
        <br data-jscall-id="22" />
        <span data-jscall-id="23">    &#64; Bonito ~/.julia/packages/Bonito/tWcqJ/src/app.jl:42</span>
        <br data-jscall-id="24" />
        <span style="color: darkred; font-weight: bold;" data-jscall-id="25">  &#91;6&#93; rendered_dom</span>
        <br data-jscall-id="26" />
        <span data-jscall-id="27">    &#64; ~/.julia/packages/Bonito/tWcqJ/src/app.jl:39 &#91;inlined&#93;</span>
        <br data-jscall-id="28" />
        <span style="color: darkred; font-weight: bold;" data-jscall-id="29">  &#91;7&#93; session_dom&#40;session::Session&#123;NoConnection&#125;, app::App; init::Bool, html_document::Bool&#41;</span>
        <br data-jscall-id="30" />
        <span data-jscall-id="31">    &#64; Bonito ~/.julia/packages/Bonito/tWcqJ/src/session.jl:362</span>
        <br data-jscall-id="32" />
        <span style="color: darkred; font-weight: bold;" data-jscall-id="33">  &#91;8&#93; page_html&#40;io::IOStream, session::Session&#123;NoConnection&#125;, app_node::App&#41;</span>
        <br data-jscall-id="34" />
        <span data-jscall-id="35">    &#64; Bonito ~/.julia/packages/Bonito/tWcqJ/src/display.jl:113</span>
        <br data-jscall-id="36" />
        <span style="color: darkred; font-weight: bold;" data-jscall-id="37">  &#91;9&#93; export_static&#40;html_io::IOStream, app::App; asset_server::Nothing, connection::Nothing, session::Session&#123;NoConnection&#125;&#41;</span>
        <br data-jscall-id="38" />
        <span data-jscall-id="39">    &#64; Bonito ~/.julia/packages/Bonito/tWcqJ/src/export.jl:317</span>
        <br data-jscall-id="40" />
        <span style="color: darkred; font-weight: bold;" data-jscall-id="41"> &#91;10&#93; export_static</span>
        <br data-jscall-id="42" />
        <span data-jscall-id="43">    &#64; ~/.julia/packages/Bonito/tWcqJ/src/export.jl:309 &#91;inlined&#93;</span>
        <br data-jscall-id="44" />
        <span style="color: darkred; font-weight: bold;" data-jscall-id="45"> &#91;11&#93; #230</span>
        <br data-jscall-id="46" />
        <span data-jscall-id="47">    &#64; ~/.julia/packages/Bonito/tWcqJ/src/export.jl:298 &#91;inlined&#93;</span>
        <br data-jscall-id="48" />
        <span style="color: darkred; font-weight: bold;" data-jscall-id="49"> &#91;12&#93; open&#40;::Bonito.var&#34;#230#231&#34;&#123;App, Session&#123;NoConnection&#125;&#125;, ::String, ::Vararg&#123;String&#125;; kwargs::&#64;Kwargs&#123;&#125;&#41;</span>
        <br data-jscall-id="50" />
        <span data-jscall-id="51">    &#64; Base 
          <a href="vscode://file/./io.jl:410" data-jscall-id="52">./io.jl:410</a>
        </span>
        <br data-jscall-id="53" />
        <span style="color: darkred; font-weight: bold;" data-jscall-id="54"> &#91;13&#93; open</span>
        <br data-jscall-id="55" />
        <span data-jscall-id="56">    &#64; 
          <a href="vscode://file/./io.jl:407" data-jscall-id="57">./io.jl:407</a> &#91;inlined&#93;
        </span>
        <br data-jscall-id="58" />
        <span style="color: darkred; font-weight: bold;" data-jscall-id="59"> &#91;14&#93; export_static&#40;html_file::String, app::App; asset_server::Nothing, connection::Nothing, session::Nothing&#41;</span>
        <br data-jscall-id="60" />
        <span data-jscall-id="61">    &#64; Bonito ~/.julia/packages/Bonito/tWcqJ/src/export.jl:297</span>
        <br data-jscall-id="62" />
        <span style="color: darkred; font-weight: bold;" data-jscall-id="63"> &#91;15&#93; export_static&#40;html_file::String, app::App&#41;</span>
        <br data-jscall-id="64" />
        <span data-jscall-id="65">    &#64; Bonito ~/.julia/packages/Bonito/tWcqJ/src/export.jl:289</span>
        <br data-jscall-id="66" />
        <span style="color: darkred; font-weight: bold;" data-jscall-id="67"> &#91;16&#93; top-level scope</span>
        <br data-jscall-id="68" />
        <span data-jscall-id="69">    &#64; ~/Desktop/MIASHS/MasterM1SSD/CoursRJulia/GitHub_package/ImageClassification.jl/Rapports/Ornella/exemple.jl:10</span>
        <br data-jscall-id="70" />
        <span style="color: darkred; font-weight: bold;" data-jscall-id="71"> &#91;17&#93; eval&#40;m::Module, e::Any&#41;</span>
        <br data-jscall-id="72" />
        <span data-jscall-id="73">    &#64; Core 
          <a href="vscode://file/./boot.jl:489" data-jscall-id="74">./boot.jl:489</a>
        </span>
        <br data-jscall-id="75" />
        <span style="color: darkred; font-weight: bold;" data-jscall-id="76"> &#91;18&#93; include_string&#40;mapexpr::typeof&#40;identity&#41;, mod::Module, code::String, filename::String&#41;</span>
        <br data-jscall-id="77" />
        <span data-jscall-id="78">    &#64; Base 
          <a href="vscode://file/./loading.jl:2842" data-jscall-id="79">./loading.jl:2842</a>
        </span>
        <br data-jscall-id="80" />
        <span style="color: darkred; font-weight: bold;" data-jscall-id="81"> &#91;19&#93; include_string&#40;m::Module, txt::String, fname::String&#41;</span>
        <br data-jscall-id="82" />
        <span data-jscall-id="83">    &#64; Base 
          <a href="vscode://file/./loading.jl:2852" data-jscall-id="84">./loading.jl:2852</a>
        </span>
        <br data-jscall-id="85" />
        <span style="color: darkred; font-weight: bold;" data-jscall-id="86"> &#91;20&#93; inlineeval&#40;m::Module, code::String, code_line::Int64, code_column::Int64, file::String; softscope::Bool&#41;</span>
        <br data-jscall-id="87" />
        <span data-jscall-id="88">    &#64; VSCodeServer ~/.vscode/extensions/julialang.language-julia-1.149.2/scripts/packages/VSCodeServer/src/eval.jl:271</span>
        <br data-jscall-id="89" />
        <span style="color: darkred; font-weight: bold;" data-jscall-id="90"> &#91;21&#93; &#40;::VSCodeServer.var&#34;#repl_runcode_request##6#repl_runcode_request##7&#34;&#123;&#125;&#41;&#40;&#41;</span>
        <br data-jscall-id="91" />
        <span data-jscall-id="92">    &#64; VSCodeServer ~/.vscode/extensions/julialang.language-julia-1.149.2/scripts/packages/VSCodeServer/src/eval.jl:181</span>
        <br data-jscall-id="93" />
        <span style="color: darkred; font-weight: bold;" data-jscall-id="94"> &#91;22&#93; withpath&#40;f::VSCodeServer.var&#34;#repl_runcode_request##6#repl_runcode_request##7&#34;&#123;&#125;, path::String&#41;</span>
        <br data-jscall-id="95" />
        <span data-jscall-id="96">    &#64; VSCodeServer ~/.vscode/extensions/julialang.language-julia-1.149.2/scripts/packages/VSCodeServer/src/repl.jl:276</span>
        <br data-jscall-id="97" />
        <span style="color: darkred; font-weight: bold;" data-jscall-id="98"> &#91;23&#93; &#40;::VSCodeServer.var&#34;#repl_runcode_request##4#repl_runcode_request##5&#34;&#123;&#125;&#41;&#40;&#41;</span>
        <br data-jscall-id="99" />
        <span data-jscall-id="100">    &#64; VSCodeServer ~/.vscode/extensions/julialang.language-julia-1.149.2/scripts/packages/VSCodeServer/src/eval.jl:179</span>
        <br data-jscall-id="101" />
        <span style="color: darkred; font-weight: bold;" data-jscall-id="102"> &#91;24&#93; hideprompt&#40;f::VSCodeServer.var&#34;#repl_runcode_request##4#repl_runcode_request##5&#34;&#123;&#125;&#41;</span>
        <br data-jscall-id="103" />
        <span data-jscall-id="104">    &#64; VSCodeServer ~/.vscode/extensions/julialang.language-julia-1.149.2/scripts/packages/VSCodeServer/src/repl.jl:38</span>
        <br data-jscall-id="105" />
        <span style="color: darkred; font-weight: bold;" data-jscall-id="106"> &#91;25&#93; #repl_runcode_request##2</span>
        <br data-jscall-id="107" />
        <span data-jscall-id="108">    &#64; ~/.vscode/extensions/julialang.language-julia-1.149.2/scripts/packages/VSCodeServer/src/eval.jl:150 &#91;inlined&#93;</span>
        <br data-jscall-id="109" />
        <span style="color: darkred; font-weight: bold;" data-jscall-id="110"> &#91;26&#93; with_logstate&#40;f::VSCodeServer.var&#34;#repl_runcode_request##2#repl_runcode_request##3&#34;&#123;&#125;, logstate::Base.CoreLogging.LogState&#41;</span>
        <br data-jscall-id="111" />
        <span data-jscall-id="112">    &#64; Base.CoreLogging 
          <a href="vscode://file/./logging/logging.jl:540" data-jscall-id="113">./logging/logging.jl:540</a>
        </span>
        <br data-jscall-id="114" />
        <span style="color: darkred; font-weight: bold;" data-jscall-id="115"> &#91;27&#93; with_logger</span>
        <br data-jscall-id="116" />
        <span data-jscall-id="117">    &#64; 
          <a href="vscode://file/./logging/logging.jl:651" data-jscall-id="118">./logging/logging.jl:651</a> &#91;inlined&#93;
        </span>
        <br data-jscall-id="119" />
        <span style="color: darkred; font-weight: bold;" data-jscall-id="120"> &#91;28&#93; &#40;::VSCodeServer.var&#34;#repl_runcode_request##0#repl_runcode_request##1&#34;&#123;VSCodeServer.ReplRunCodeRequestParams&#125;&#41;&#40;&#41;</span>
        <br data-jscall-id="121" />
        <span data-jscall-id="122">    &#64; VSCodeServer ~/.vscode/extensions/julialang.language-julia-1.149.2/scripts/packages/VSCodeServer/src/eval.jl:263</span>
        <br data-jscall-id="123" />
        <span style="color: darkred; font-weight: bold;" data-jscall-id="124"> &#91;29&#93; &#40;::VSCodeServer.var&#34;#start_eval_backend##0#start_eval_backend##1&#34;&#41;&#40;&#41;</span>
        <br data-jscall-id="125" />
        <span data-jscall-id="126">    &#64; VSCodeServer ~/.vscode/extensions/julialang.language-julia-1.149.2/scripts/packages/VSCodeServer/src/eval.jl:34</span>
        <br data-jscall-id="127" />
      </pre>
    </div>
  </body>
</html>